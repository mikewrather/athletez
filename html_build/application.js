define(["facade","utils","collections","chrome","controller","profile","imageup","home","videopreview","game","team","registration","profilesetting","userresume","packages/site/collections/phrases","usercontrols/tag/tag","usercontrols/addgame/addgame","signup","login","usercontrols/photo-player/photo-player","usercontrols/add-club/add-club","utils/storage","usercontrols/location/views/view-location","signup/views/facebooksignup"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x){var T,N=n.ApplicationStates,C=e.$,k=e._,L=e.Backbone,A=t.lib.Channel,O=t.debug;return T=L.Router.extend({routes:{"":"defaultRoute",home:"showHome","home/":"showHome","home/:action":"initApp",profile:"showProfile","profile/":"showProfile","profile/:userid":"showProfile",usersettings:"showProfileSetting","usersettings/":"showProfileSetting",resume:"ShowUserResume","resume/":"ShowUserResume",game:"showGame","game/":"showGame","game/:id":"showGame",team:"showTeam","team/":"showTeam","team/:id":"showTeam",registration:"showRegistration","registration/":"showRegistration","registration/:action":"showRegistration",tag:"showTag","user/login":"showLogin",addgame:"showAddGame",fbconnect:"showFbreg",logout:"callLogout"},initialize:function(e){k.bindAll(this),this.addSubscribers(),i.prototype.appStates=new N,this.getPhrases()},getUserName:function(e){var t=new E("user","localStorage"),n;if(t.data)for(var r in t.data)if(r==e){n=t.data[r].user_name;break}return n?n:!1},intializeImageAndVideo:function(){this.imageUpListeners(),this.videoPreview(),this.showUsercreate(),this.showHomeRefresh(),this.showLogin()},cancelAjaxRequests:function(){if(typeof routing!="undefined"&&typeof routing.ajaxRequests!="undefined"&&routing.ajaxRequests.length)for(var e in routing.ajaxRequests)routing.ajaxRequests[e].abort()},initTriggers:function(){routing.off("photo-player-init"),routing.on("photo-player-init",function(e,t,n,r){var i=new b({index:e,userId:n,_collection:t,array:r})}),routing.off("add-school-init"),routing.on("add-school-init",function(e,t,n){var r=new w({type:n})});var e=undefined;routing.off("show_location"),routing.on("show_location",function(t,n,r,i){e=i;var s={latitude:t,longitude:n},o=new S(s);C(r).html(o.$el)}),routing.off("popup-close"),routing.on("popup-close",function(){C("#modalPopup").modal("hide"),C(".model-popup-h").remove(),e&&e()})},initialiRoutesInit:function(e,t){var n=this,r=function(){C("#modalPopup, .modal-backdrop").unbind().remove()};routing.off("app-inited"),routing.on("app-inited",function(t){r(),e(t)}),routing.off("popup-close"),routing.on("popup-close",function(){C("#modalPopup").unbind().remove()}),C(document).off("hidden.bs.modal","#modalPopup"),C(document).on("hidden.bs.modal","#modalPopup",function(){routing.trigger("popup-close")}),routing.off("add-game"),routing.on("add-game",function(e,t,n,r){var i=new m({teams_id:t,sports_id:n,users_id:r,id:e,popup:!0})})},checkForUser:function(){return!k.isUndefined(routing.userLoggedIn)&&routing.userLoggedIn?!0:!1},defaultRoute:function(){this.initApp()},initApp:function(e){this.showHome(null)},getPhrases:function(){var e=new d;e.fetch()},showFbreg:function(){fbregistration=new x,fbregistration.signupFacebook()},showHome:function(e){function n(e){t.currentController=new u({route:"",title:"Athletez"})}var t=this;this.cancelAjaxRequests(),this.loadStyles(),r(),this.initialiRoutesInit(n)},removeCurrent:function(){},showProfile:function(e){function n(n){t.currentController=new s({userId:typeof e!="undefined"?e:n,title:t.getUserName(n)})}var t=this;this.cancelAjaxRequests(),t.loadStyles(),r(),t.removeCurrent(),this.initialiRoutesInit(n)},notFound:function(e){alert("Page not found")},showTeam:function(e){function n(n){t.currentController=new l({teamId:e,title:"team page",userId:n})}var t=this;this.cancelAjaxRequests(),this.loadStyles(),r();if(!e){this.notFound("team");return}t.removeCurrent(),this.initialiRoutesInit(n)},imageUpListeners:function(){function e(e,t,n){var r=new o({route:"",url:e,attr:t,data:n})}this.addImageTrigger(e)},addImageTrigger:function(e){routing.off("add-image"),routing.on("add-image",function(t,n,r){console.log(t,n,r);if(!this.checkForUser()){C(".signup-email").trigger("click");return}e(t,n,r)})},showProfileSetting:function(e){function t(t){self.currentController=new h({id:e==undefined?t:e,title:"Profile setting"})}this.cancelAjaxRequests(),this.loadStyles(),r(),this.removeCurrent(),this.initialiRoutesInit(t)},ShowUserResume:function(e){function t(t){self.currentController=new p({id:e==undefined?t:e})}this.cancelAjaxRequests(),this.loadStyles(),r(),this.removeCurrent(),this.initialiRoutesInit(t)},imageUp:function(){function e(e){var t=new o({route:"",url:this.posturl,attr:this.attribute})}this.cancelAjaxRequests(),this.loadStyles(),this.initialiRoutesInit(e)},videoPreview:function(){function t(t,n){if(!e.checkForUser()){C(".signup-email").trigger("click");return}var r=new a({url:t,attr:n})}this.cancelAjaxRequests(),this.loadStyles();var e=this;A("add-video").subscribe(t)},showGame:function(e){function t(t){self.currentController=new f({route:"",gameId:e,title:"Game Page",userId:t})}this.cancelAjaxRequests(),this.loadStyles(),r();if(!e){this.notFound("team");return}this.removeCurrent(),this.initialiRoutesInit(t)},showRegistration:function(){function e(){self.currentController=new c({route:"",title:"Register"})}this.cancelAjaxRequests(),this.loadStyles(),r(),this.removeCurrent(),this.initialiRoutesInit(e)},showTag:function(e){function t(t){self.currentController=new v({id:e==undefined?t:e})}this.cancelAjaxRequests(),this.loadStyles(),r(),this.removeCurrent(),this.initialiRoutesInit(t)},showAddGame:function(e){function t(t){self.currentController=new m({id:e==undefined?t:e})}this.cancelAjaxRequests(),this.loadStyles(),r(),this.removeCurrent(),this.initialiRoutesInit(t)},RefreshHome:function(){r()},showHomeRefresh:function(){this.addHomeTrigger(this.initApp)},addHomeTrigger:function(e){routing.off("reload-home"),routing.on("reload-home",function(){e()})},showLogin:function(){},showUsercreate:function(){function e(){var e=new g({route:""})}this.addUserTrigger(e)},addUserTrigger:function(e){routing.off("add-user"),routing.on("add-user",function(){e()})},showRegistration:function(){function e(){var e=new c({route:"",title:"Register"})}this.cancelAjaxRequests(),this.loadStyles(),r(),this.initialiRoutesInit(e)},loadStyles:function(){A("load:css").publish([base_url+"css/bootstrap.css",base_url+"css/bootstrap-responsive.css",base_url+"css/app.css",base_url+"css/common.css",base_url+"css/jquery-ui-1.10.2.custom.css"])},addSubscribers:function(){A("load:css").subscribe(this.loadCss)},removeSubscribers:function(){A("load:css").unsubscribe(this.loadCss)},callLogout:function(){this.logout=new y,routing.trigger("Logout")},getStoredState:function(e,t){var n,r;return n=this.states.findByNameInStorage(e),k.isString(t)&&n&&n.data&&(r=n.data[t]),r||n},show:function(e){e=e||"body",C(e).removeClass("hide")},hide:function(e){e=e||"body",C(e).addClass("hide")},cssLoaded:[],loadCss:function(e){var n,r;if(!k.isArray(e))throw new Error("App method addCss expects an array");for(n=0;n<e.length;n++)r=e[n],k.isString(r)&&C.inArray(r,this.cssLoaded)<0&&(t.lib.loadCss(r),this.cssLoaded.push(r))}}),T});