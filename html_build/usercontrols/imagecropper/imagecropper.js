define(["require","text!usercontrols/imagecropper/templates/layout.html","facade","controller","views"],function(e,t){var n,r=e("facade"),i=e("controller"),s=e("views"),o=e("utils"),u=r.$,a=r._,f=o.lib.Channel,l=s.LayoutView;return n=i.extend({cssArr:["/usercontrols/imagecropper/imagecropper.css"],events:{"click button.close":"alertsomething"},initialize:function(e){console.log("init");var t=this;f("load:css").publish(this.cssArr),a.bindAll(this),console.log(e),this.image_o=e.image_o?e.image_o:"",this.image_e=e.image_e?e.image_e:"",this.modelHTML='<div id="modalPopup" class="modal imagecropper hide fade model-popup-h"><div class="modal-header"><span>Userpic Editor</span><button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button></div><div class="modal-body page-content-h"></div></div>',this.setupLayout().render(),this.handleDeferreds()},handleDeferreds:function(){},setupLayout:function(){var e=this;this.scheme=[],u(".model-popup-h").remove(),u("body").append(this.modelHTML);var n=new l({scheme:this.scheme,destination:".modal-body",template:t,displayWhen:"ready"});this.layout=n,u("#modalPopup button.close").bind("click",function(){e.notifyUpdate()});var r="/vendor/plugins/iedit2/index.html?vh=500&vw=500&sx=0&sy=0&sz=100&t=Profile%20Picture&edit=";return this.image_e!=""&&(r+="&edit="+this.image_e),this.image_o!=""&&(r+="&o="+this.image_o),u("#modalPopup iframe#cropper_iframe").attr("src",r),u("#modalPopup").modal(),this.layout},notifyUpdate:function(){f("userpic-changed").publish()}}),n});