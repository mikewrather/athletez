define(["require","text!usercontrols/imagecropper/templates/layout.html","facade","controller","models","views"],function(e,t){var n,r=e("facade"),i=e("controller"),s=e("models"),o=e("views"),u=e("utils"),a=r.$,f=r._,l=u.debug,c=u.lib.Channel,h=o.LayoutView,p=r.Backbone,d=e("user/models/basic_info");return n=i.extend({cssArr:["/usercontrols/imagecropper/imagecropper.css"],events:{"click button.close":"alertsomething"},initialize:function(e){console.log("init");var t=this;c("load:css").publish(this.cssArr),f.bindAll(this),console.log(e),this.image_o=e.image_o?e.image_o:"",this.image_e=e.image_e?e.image_e:"",this.modelHTML='<div id="modalPopup" class="modal imagecropper hide fade model-popup-h"><div class="modal-header"><span>Userpic Editor</span><button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button></div><div class="modal-body page-content-h"></div></div>',this.setupLayout().render(),this.handleDeferreds()},handleDeferreds:function(){},setupLayout:function(){var e=this;this.scheme=[],a(".model-popup-h").remove(),a("body").append(this.modelHTML);var n=new h({scheme:this.scheme,destination:".modal-body",template:t,displayWhen:"ready"});this.layout=n,a("#modalPopup button.close").bind("click",function(){e.notifyUpdate()});var r="/vendor/plugins/iedit2/index.html?vh=500&vw=500&sx=0&sy=0&sz=100&t=Profile%20Picture&edit=";return this.image_e!=""&&(r+="&edit="+this.image_e),this.image_o!=""&&(r+="&o="+this.image_o),a("#modalPopup iframe#cropper_iframe").attr("src",r),a("#modalPopup").modal(),this.layout},notifyUpdate:function(){c("userpic-changed").publish()}}),n});