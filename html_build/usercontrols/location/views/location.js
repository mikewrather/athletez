define(["require","text!usercontrols/location/templates/layout.html","facade","views","utils","vendor","usercontrols/location/models/verify-adress","usercontrols/location/models/save"],function(e,t){var n,r=e("facade"),i=e("views"),s=i.SectionView,o=e("utils"),u=o.lib.Channel,a=e("vendor"),f=e("usercontrols/location/models/verify-adress"),l=e("usercontrols/location/models/save"),c=a.Mustache,h=r.$,p=i.BaseView,d=r.Backbone,v;return d.View.extend({template:t,events:{"click .verify-address-h":"verifyAddress","click .set-address-h":"setLocation"},initialize:function(e){v=this,v.game_id=e.game_id||undefined,v.location=e,v.selectedOptions=[],v.setOptions(e),v.render()},setLocation:function(e){var t=confirm("Are you sure want to set new address?");if(t&&this.locationId){var n=new l;n.id=this.game_id,n.set({locations_id:this.locationId,id:this.game_id}),n.save(),h.when(n.request).done(function(){routing.trigger("popup-close")})}},verifyAddress:function(){var e=this,t=e.$el.find(".address-h").val();e.adressModel=new f,e.adressModel.address=t,e.adressModel.url(),e.adressModel.set({address:t}),e.adressModel.showError=function(t,n){try{e.$el.find(".set-address-h").addClass("link-disabled"),e.$el.find(".address-error-status-h").removeClass("hide").html(n.responseJSON.exec_data.error_array[0].error)}catch(r){}e.$el.find(".address-h").addClass("address-field-error").removeClass("address-verified")},e.adressModel.save({dataType:"json"}),e.$el.find(".address-h").removeClass("address-verified"),h.when(e.adressModel.request).done(function(){console.log(e.adressModel.toJSON()),e.locationId=e.adressModel.get("payload").id;if(e.locationId){e.$el.find(".address-error-status-h").addClass("hide"),e.$el.find(".address-h").removeClass("address-field-error").addClass("address-verified"),e.location.latitude=e.adressModel.get("payload").lat,e.location.latitude=e.adressModel.get("payload").lon,e.$el.find(".set-address-h").removeClass("link-disabled");var t=new google.maps.LatLng(e.adressModel.get("payload").lat,e.adressModel.get("payload").lon);e.marker.setPosition(t),e.map.panTo(t)}})},intializeMap:function(){console.log(v.location);var e=new google.maps.LatLng(v.location.latitude,v.location.longitude),t={zoom:13,center:e,scaleControl:!0,zoomControl:!0,mapTypeId:google.maps.MapTypeId.ROADMAP};this.map=new google.maps.Map(this.$el.find("#map-canvas")[0],t),this.marker=new google.maps.Marker({position:e,map:this.map}),this.marker.setMap(this.map)},render:function(){var e=this,t=c.to_html(e.template,{location:e.locaion});return h(e.el).html(t),setTimeout(function(){e.intializeMap()},1e3),this},setOptions:function(e){for(var t in e)this[t]=e[t]}})});