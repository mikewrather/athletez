define(["require","text!usercontrols/location/templates/layout.html","facade","views","utils","vendor","usercontrols/location/models/verify-adress"],function(e,t){var n,r=e("facade"),i=e("views"),s=i.SectionView,o=e("utils"),u=o.lib.Channel,a=e("vendor"),f=e("usercontrols/location/models/verify-adress"),l=a.Mustache,c=r.$,h=i.BaseView,p=r.Backbone,d;return p.View.extend({template:t,events:{"click .verify-address-h":"verifyAddress","click .set-address-h":"setLocation"},initialize:function(e){console.log(e),d=this,d.location=e,d.selectedOptions=[],d.setOptions(e),d.render()},setLocation:function(e){var t=confirm("Are you sure want to set new address?");t&&routing.trigger("popup-close")},verifyAddress:function(){var e=this,t=e.$el.find(".address-h").val(),n=new f;n.address=t,n.url(),n.set({address:t}),n.showError=function(t,n){try{e.$el.find(".set-address-h").addClass("link-disabled"),e.$el.find(".address-error-status-h").removeClass("hide").html(n.responseJSON.exec_data.error_array[0].error)}catch(r){}e.$el.find(".address-h").addClass("address-field-error").removeClass("address-verified")},n.save({dataType:"json"}),e.$el.find(".address-h").removeClass("address-verified"),c.when(n.request).done(function(){console.log(n.toJSON()),e.locationId=n.get("payload").id;if(e.locationId){e.$el.find(".address-error-status-h").addClass("hide"),e.$el.find(".address-h").removeClass("address-field-error").addClass("address-verified"),e.location.latitude=n.get("payload").lat,e.location.latitude=n.get("payload").lon,e.$el.find(".set-address-h").removeClass("link-disabled"),alert(n.get("payload").lat+"--"+n.get("payload").lon);var t=new google.maps.LatLng(n.get("payload").lat,n.get("payload").lon);e.marker.setPosition(t),e.map.panTo(t)}})},intializeMap:function(){console.log(d.location);var e=new google.maps.LatLng(d.location.latitude,d.location.longitude),t={zoom:8,center:e,scaleControl:!0,zoomControl:!0,mapTypeId:google.maps.MapTypeId.ROADMAP};this.map=new google.maps.Map(this.$el.find("#map-canvas")[0],t),this.marker=new google.maps.Marker({position:e,map:this.map}),this.marker.setMap(this.map)},render:function(){var e=this,t=l.to_html(e.template,{location:e.locaion});return c(e.el).html(t),setTimeout(function(){e.intializeMap()},1e3),this},setOptions:function(e){for(var t in e)this[t]=e[t]}})});