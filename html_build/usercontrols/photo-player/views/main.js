define(["require","text!usercontrols/photo-player/templates/player.html","facade","views","utils","vendor","votes/models/vote"],function(e,t){var n,r=e("facade"),i=e("views"),s=i.SectionView,o=e("utils"),u=o.lib.Channel,a=e("vendor"),f=a.Mustache,l=r.$,c=e("votes/models/vote");return PhotoPlayerView=s.extend({template:t,thumbTemplate:'{{#data}}<li><a href="javascript: void(0);" class="thumb-link-h" data-index="{{_index}}" title="thumb"><img src="{{_thumbnail}}" alt="{{_thumbnail}}" /></a></li>{{/data}}',events:{"click .back-arrow-h":"backButton","click .next-arrow-h":"nextButton","click .thumb-link-h":"changeImage","click .photo-player-vote-h":"vote"},initialize:function(e){this.collection=e.collection,this.id=e.id,this.index=e.index,s.prototype.initialize.call(this,e),this.setUpMainView(),this.json=this.model.toJSON(),this.render(),this.initThumbsSection(),this.loadImage(!0)},vote:function(e){if(l(e.currentTarget).hasClass("voted"))return;var t=ths,n=new c;n.userId=this.json[this.index].payload.id,n.entity_id=this.json[this.index].payload.enttypes_id,n.set({subject_type_id:n.entity_id,subject_id:n.userId}),n.save(),l.when(n.request).done(function(){t.$el.find(".photo-player-vote-h").addClass("voted")})},changeImage:function(e){var t=l(e.currentTarget);this.index=t.attr("data-index"),this.loadImage()},backButton:function(e){this.index>0&&(this.index--,this.loadImage())},nextButton:function(e){this.index<this.json.length&&(this.index++,this.loadImage())},initThumbsSection:function(){var e=this,t=this.json.length,n={};n.data=[],console.error(this.json);for(var r=0;r<t;r++){var i=this.json[r].payload,s={_enttypes_id:i.enttypes_id,_id:i.id,_index:r};switch(i.enttypes_id){case"23":s._thumbnail=i.thumbs,s._label=i.media.name,s._link="javascript: void(0);",i.media.hasOwnProperty("is_owner")&&(show_edit=i.media.is_owner);break;case"21":typeof i.types=="object"&&i.types.small_thumb&&(s._thumbnail=i.types.standard_thumb.url),s._label=i.media_obj.name,s._link="javascript: void(0);",i.media_obj.hasOwnProperty("is_owner")&&(show_edit=i.media_obj.is_owner);break;case"1":typeof i.user_picture_obj=="object"&&(s._thumbnail=i.user_picture_obj.types.small_thumb.url),s._label=i.label,s._sublabel="Coming Soon",s._link="/#profile/"+i.id,i.hasOwnProperty("is_owner")&&(show_edit=i.is_owner);break;case"8":s._detailclass="game",s._thumbnail=i.game_picture!==null?i.game_picture.types.small_thumb.url:"http://lorempixel.com/output/sports-q-c-440-440-4.jpg",s._label=i.game_day,s._link="/#game/"+i.id;var o="",u=i.teams.length,a=function(e){return e=e.toLowerCase(),e.replace(/(^([a-zA-Z\p{M}]))|([ -][a-zA-Z\p{M}])/g,function(e){return e.toUpperCase()})};for(var r=0;r<u;r++)o+="<span>",o+=a(i.teams[r].team_name),o+="</span>",r+1<i.teams.length&&(o+=" VS. ");i.hasOwnProperty("is_owner")&&(show_edit=i.is_owner),s._sublabel=o}n.data.push(s)}this.id=s._id;var l=f.to_html(this.thumbTemplate,n);this.$el.find(".thumb-image-list-h").html(l)},loadImage:function(e){var t=this,n=this.json[t.index].payload,r={_enttypes_id:n.enttypes_id,_id:n.id,_currentIndex:t.index};console.log(n);var i;switch(n.enttypes_id){case"23":r._thumbnail=n.thumbs,r._label=n.media.name,r._link="javascript: void(0);";break;case"21":typeof n.types=="object"&&n.types.large_format&&(i=n.types.large_format),r._label=n.media_obj.name,r._link="javascript: void(0);";break;case"1":typeof n.user_picture_obj=="object"&&(r._thumbnail=n.user_picture_obj.types.large_thumb.url),r._label=n.label,r._sublabel="Coming Soon",r._link="/#profile/"+n.id,n.hasOwnProperty("is_owner")&&(show_edit=n.is_owner);break;case"8":r._detailclass="game",r._thumbnail=n.game_picture!==null?n.game_picture.types.large_thumb.url:"http://lorempixel.com/output/sports-q-c-440-440-4.jpg",r._label=n.game_day,r._link="/#game/"+n.id;var s="",o=n.teams.length,u=function(e){return e=e.toLowerCase(),e.replace(/(^([a-zA-Z\p{M}]))|([ -][a-zA-Z\p{M}])/g,function(e){return e.toUpperCase()})};for(var a=0;a<o;a++)s+="<span>",s+=u(n.teams[a].team_name),s+="</span>",a+1<n.teams.length&&(s+=" VS. ");n.hasOwnProperty("is_owner")&&(show_edit=n.is_owner),r._sublabel=s}if(i!="undefined"&&i!=null){var f=parseInt(this.$el.height())*.8,l=parseInt(i.height)>380?parseInt(i.height):380;console.log(f,l,(f-l)/2);if(i.width>i.height||i.width==i.height){var c=f<l?10:(f-l)/2;this.$el.find("img").css({"max-width":"100%",top:c+"px"})}else this.$el.find("img").css({"max-height":"100%",top:"0px"});this.$el.find(".large-image-h").attr("src",i.url)}this.$el.find(".thumb-image-list-h li").removeClass("selected-photo-thumb"),this.$el.find(".thumb-link-h[data-index="+this.index+"]").parents("li").addClass("selected-photo-thumb"),console.log(r),routing.trigger("photo-player-section-reload",r._enttypes_id,r._id)},setOptions:function(e){},setUpMainView:function(){var e=this,t=f.to_html(e.template,{});l(e.$el).html(t)}}),PhotoPlayerView});