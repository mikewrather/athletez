define(["require","text!usercontrols/photo-player/templates/comments.html","text!usercontrols/tag/templates/layout.html","facade","controller","models","views","usercontrols/photo-player/collections/comments","usercontrols/photo-player/views/main","usercontrols/photo-player/views/comments","usercontrols/photo-player/collections/tags","usercontrols/photo-player/views/tags","usercontrols/photo-player/models/tags","usercontrols/tag/views/main","usercontrols/tag/models/basic_info"],function(e,t,n){var r,i=e("facade"),s=e("controller"),o=e("models"),u=e("views"),a=e("utils"),f=i.$,l=i._,c=a.debug,h=a.lib.Channel,p=u.LayoutView,d=i.Backbone,v=e("usercontrols/photo-player/collections/comments"),m=e("usercontrols/photo-player/collections/tags"),g=e("usercontrols/photo-player/views/main"),y=e("usercontrols/photo-player/views/comments"),b=e("usercontrols/photo-player/views/tags"),w=e("usercontrols/photo-player/models/tags"),E=e("usercontrols/tag/views/main"),S=e("usercontrols/tag/models/basic_info"),r=s.extend({cssArr:["/usercontrols/photo-player/photoPlayer.css"],events:{},initialize:function(e){console.log("LLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLL",e),console.log("init");var t=this;h("load:css").publish(this.cssArr),l.bindAll(this),e.id&&(this.id=e.id),this.index=e.index,e.userId&&(this.userId=e.userId),e.array&&(this.collectionArray=!0),e._collection&&(this._collection=e._collection),this.modelHTML='<div id="photoPlayerModal" class="modal photo-frame-model hide fade model-popup-h"><div class="modal-body page-content-h"><div class="photo-player-area-h photo-player"></div><div class="photo-player-right-area"><div class="right-area-header"><div class="headerinfo"></div><div class="closer"><button type="button" class="close" data-dismiss="modal" aria-hidden="true">	&times;</button></div></div><div class="teamName-area"></div><div class="tags-area-h"></div><div class="comment-area coment-area-h"></div><div class="comment-input-outer-h comment-input-outer" class="clearfix"></div><div id="image-tagging-photo"></div></div></div></div>',routing.off("photo-player-section-reload"),routing.on("photo-player-section-reload",function(e,n){t.id=n,f("#image-tagging-photo").html(""),t.setUpCommentView(e,n),t.setUpTagView(e,n)}),routing.off("comments-fetch-new-form-data"),routing.on("comments-fetch-new-form-data",function(e,n){t.setUpCommentView(e,n)}),routing.off("tags-fetch-new-form-data"),routing.on("tags-fetch-new-form-data",function(e,n){t.setUpTagView(e,n)}),this.setupLayout().render(),this.setUpMainView(),this.handleDeferreds()},handleDeferreds:function(){},setupLayout:function(){this.scheme=[],f(".model-popup-h").remove(),f("body").append(this.modelHTML);var e=new p({scheme:this.scheme,destination:"#modalPopup",template:"",displayWhen:"ready"});return this.layout=e,f("#photoPlayerModal").modal("show"),this.layout},setUpMainView:function(){var e=this;if(e.collectionArray){var t=d.Collection.extend(),n=new t;n.reset(e._collection)}else n=e._collection;var r=new g({model:n,name:"photo player",destination:".photo-player-area-h",index:e.index,user_id:e.userId||null,sports_id:e.sports_id||null,scheme:this.scheme,layout:this.layout});this.scheme.push(r),this.layout.render()},setUpTagView:function(e,t){var n=this.scheme.length;for(var r=0;r<n;r++)this.scheme[r].name==this.oldTagView&&this.scheme[r].remove();var i=this;i.oldTagView="tag section"+Math.random(),f(".tags-area-h").unbind().html(""),i.tags=new m,i.tags.id=t,i.tags.fetch(),f.when(i.tags.request).done(function(){var t=new w,n=new b({collection:i.tags,userId:i.userId,name:i.oldTagView,model:t,entity_type_id:e,destination:".tags-area-h"});i.scheme.push(n),i.layout.render()})},setUpCommentView:function(e,n){var r=this.scheme.length;for(var i=0;i<r;i++)this.scheme[i].name==this.oldView&&this.scheme[i].remove();var s=this,o;s.oldView="comment section"+Math.random(),f(".coment-area-h, .comment-input-outer-h").unbind().html(""),s.commentson=new v,s.commentson.subject_entity_type=e,s.commentson.id=n,s.commentson.fetch(),f.when(s.commentson.request).done(function(){o=new y({collection:s.commentson,userId:s.userId,name:s.oldView,_template:t,destination:".coment-area-h"}),s.scheme.push(o),s.layout.render()})},setUpOthersView:function(){},setUpTagPhotoView:function(e,t){console.log("tagtemplate",n);var r=this;this.tagViewPhoto=new E({model:new S,template:n,name:"tag-image "+(new Date).toString(),destination:"#image-tagging-photo",user_id:r.userId||null,sports_id:r.sports_id,channel:"tag-image-success-photo"}),r.scheme.push(this.tagViewPhoto),r.layout.render()},tagFunction:function(e){var t=this;alert(JSON.stringify(e))}});return r});