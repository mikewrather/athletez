define(["facade","views","utils","media/views/image-item","media/views/image-board","media/views/add-image","text!media/templates/image-list.html"],function(e,t,n,r,i,s,o){var u,a,f=e.$,l=e._,c=require("vendor"),h=n.lib.Channel,p=t.CollectionView,d=t.SectionView,v=c.Mustache;return a=p.extend(d.prototype),u=a.extend({__super__:p.prototype,template:o,_tagName:"li",_className:"image",page:0,page_limit:8,listView:".image-list",_view:r,events:{"click .see-more-h":"seeMore","click .image-outer-h":"initPhotoPlayer"},renderTemplate:function(){var e=v.to_html(this.template);return this.$el.html(e),this},initialize:function(e){e.name?this.name=e.name:this.name="image list",e.collecton&&(this.collection=e.collection),this.renderTemplate();var t=this;t.allData=this.collection.toArray(),t.seeMore(),p.prototype.initialize.call(this,e);if(!this.collection)throw new Error("ImageListView expected options.collection.");l.bindAll(this),this.addSubscribers(),this.setupBoardView(),this.setupAddView()},initPhotoPlayer:function(e){console.log(this.collection);var t=f(e.target).parents("li").index()-1;t<0&&(t=0),routing.trigger("photo-player-init",t,this.allData,this.collection.id,!0)},seeMore:function(e){var t=this.allData.length,n=this.page*this.page_limit,r=n+this.page_limit;t<=r&&this.$el.find(".see-more-h").hide(),e?this.collection.add(this.allData.slice(n,r)):this.collection.reset(this.allData.slice(n,r)),this.page++,e&&(this.addSubscribers&&this.addSubscribers(),this.setupBoardView&&this.setupBoardView(),this.setupAddView&&this.setupAddView())},childViews:{},setupAddView:function(){function r(e){t.model=e,t.render(),f(this.listView).append(t.el)}var e,t=new s({collection:this.collection}),n=this.addChildView(t);this.childViews.form=t,this.callbacks.add(function(){n()}),h("addimage:fetch").subscribe(r)},filterWithImageType:function(e){var t=this.collection;return f.each(t.models,function(t,n){n.selectImageType&&n.selectImageType(e)}),t},setupBoardView:function(){function s(e){n.model=e,n.render()}if(this.collection.size()==0)return;var e=this.filterWithImageType(this.imagetype),t,n=new i({collection:e,model:e.at(0)}),r=this.addChildView(n);this.childViews.board=n,this.callbacks.add(function(){r(),n.render(),f(this.listView).prepend(n.el)}),h("changeimage"+this.collection.id).subscribe(s)}}),u});