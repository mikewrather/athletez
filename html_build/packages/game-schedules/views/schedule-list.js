define(["vendor","facade","views","utils","schedules/views/schedule-item","utils/storage","text!schedules/templates/schedule-list.html","chrome/views/header","common/models/add","vendor/plugins/qtip/qtip"],function(e,t,n,r,i,s,o,u,a){var f,l,c=t.$,h=t._,p=r.lib.Channel,d=n.CollectionView,v=e.Mustache,m=n.SectionView;return l=d.extend(m.prototype),f=l.extend({__super__:d.prototype,id:"schedule-list",name:"schedule List",tagName:"ul",_tagName:"li",_className:"org",_view:i,events:{"click .add-game-h":"addGame","click .add-event-h":"addEvent"},showinfo:function(e){e.preventDefault(),c(e.target).parents(".game-info").length||(c(e.target).find(".game-info").hasClass("hide")?c(e.target).find(".game-info").removeClass("hide"):c(".game-info").addClass("hide"))},checkForUser:function(){return!h.isUndefined(routing.userLoggedIn)&&routing.userLoggedIn?!0:!1},getUserId:function(){if(!h.isUndefined(routing.userLoggedIn)&&routing.userLoggedIn)return routing.loggedInUserId},addRecordToCollection:function(e){var t=new addModel;t.processItemFromPayload(participants.toJSON()),_self.$el.find(".add-to-event").hide(),_self.collection.add(t)},addGame:function(e){var t=this;t.checkForUser()?t.openAddGamePopup(e):routing.trigger("showSignup",function(){t.openAddGamePopup(e)})},openAddGamePopup:function(e){var t=this;if(!h.isUndefined(this.teamRecords)&&this.teamRecords)routing.trigger("add-game",0,c("#team-h").val(),c("#sports-h").val(),t.controller.id,function(e){t.controller&&t.controller.getOrgData(),routing.trigger("common-popup-close")});else{var n=c(".selected-sport-h").data("id")||c("#sports-h").val();routing.trigger("add-game",0,c(e.currentTarget).data("team-id"),n,t.controller.id,function(e){t.controller&&t.controller.getOrgData(),routing.trigger("common-popup-close")})}},addEvent:function(e){var t=this;if(!this.checkForUser()){c("#userlogin").trigger("click");return}!h.isUndefined(this.teamRecords)&&this.teamRecords?routing.trigger("add-event",0,c("#sports-h").val(),t.controller.id,function(e){t.controller&&t.controller.getOrgData(),routing.trigger("popup-close")}):(console.log(c(".selected-sport-h").data("id")),routing.trigger("add-event",0,c(".selected-sport-h").data("id"),t.controller.id,function(e){t.controller&&t.controller.getOrgData(),routing.trigger("popup-close")}))},initialize:function(e){var t=this;p("load:css").publish(["vendor/plugins/qtip/qtip.css"]),console.log("OPTIONS",e),t.eventPage=e.eventPage||!1,t.teamRecords=e.teamRecords,t.controller=e.controller||!1,!h.isUndefined(e.teamRecords)&&e.teamRecords&&(console.log("Team Records",e.teamRecords,e),t.renderTemplate(),t.listView=".schedule-list-h",t.singleView=!0),!h.isUndefined(e.eventPage)&&e.eventPage&&(t.renderTemplate(t.eventPage),t.listView=".schedule-list-h",t.eventView=!0),d.prototype.initialize.call(t,e);if(!t.collection)throw new Error("Schedule expected options.collection.");h.bindAll(t),t.addSubscribers(),console.error(t.collection)},afterRender:function(){this.$el.find("a.team-info-h").each(function(){var e=c(this);c(this).qtip({content:e.find("div.game-info").html(),position:{my:"bottom center",at:"top center",viewport:c(window)},style:{classes:"tipsy game-info",width:"360px"},hide:{fixed:!0}})})},renderTemplate:function(e){var t=v.to_html(o,{data:this.collection.length,eventPage:e});return console.error(t),this.$el.html(t),this}}),f});