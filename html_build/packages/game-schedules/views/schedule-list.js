define(["vendor","facade","views","utils","schedules/views/schedule-item","utils/storage","text!schedules/templates/schedule-list.html","chrome/views/header","common/models/add","sportorg/models/uslgamelink","vendor/plugins/qtip/qtip-wrapper","common/views/add-description"],function(e,t,n,r,i,s,o,u,a,f){var l,c,h=t.$,p=t._,d=r.lib.Channel,v=n.CollectionView,m=require("common/views/add-description"),g=e.Mustache,y=n.SectionView;return c=v.extend(y.prototype),l=c.extend({__super__:v.prototype,id:"schedule-list",name:"schedule List",tagName:"ul",currentSection:"games",_tagName:"li",_className:"org",_view:i,events:{"click .add-game-h":"addGame","click .add-event-h":"addEvent"},showinfo:function(e){e.preventDefault(),h(e.target).parents(".game-info").length||(h(e.target).find(".game-info").hasClass("hide")?h(e.target).find(".game-info").removeClass("hide"):h(".game-info").addClass("hide"))},checkForUser:function(){return!p.isUndefined(routing.userLoggedIn)&&routing.userLoggedIn?!0:!1},getUserId:function(){if(!p.isUndefined(routing.userLoggedIn)&&routing.userLoggedIn)return routing.loggedInUserId},addRecordToCollection:function(e){var t=new addModel;t.processItemFromPayload(participants.toJSON()),_self.$el.find(".add-to-event").hide(),_self.collection.add(t)},addGame:function(e){var t=this;t.checkForUser()?t.openAddGamePopup(e):routing.trigger("showSignup",function(){t.openAddGamePopup(e)})},openAddGamePopup:function(e){var t=this;if(!p.isUndefined(this.teamRecords)&&this.teamRecords)routing.trigger("add-game",0,h("#team-h").val(),h("#sports-h").val(),t.controller.id,function(e){t.controller&&t.controller.getOrgData(),routing.trigger("common-popup-close")});else{var n=h(".selected-sport-h").data("id")||h("#sports-h").val();routing.trigger("add-game",0,h(e.currentTarget).data("team-id"),n,t.controller.id,function(e){t.controller&&t.controller.getOrgData(),routing.trigger("common-popup-close")})}},addEvent:function(e){var t=this;if(!this.checkForUser()){h("#userlogin").trigger("click");return}!p.isUndefined(this.teamRecords)&&this.teamRecords?routing.trigger("add-event",0,h("#sports-h").val(),t.controller.id,function(e){t.controller&&t.controller.getOrgData(),routing.trigger("popup-close")}):(console.log(h(".selected-sport-h").data("id")),routing.trigger("add-event",0,h(".selected-sport-h").data("id"),t.controller.id,function(e){t.controller&&t.controller.getOrgData(),routing.trigger("popup-close")}))},initialize:function(e){var t=this;d("load:css").publish(["vendor/plugins/qtip/qtip.css"]),t.eventPage=e.eventPage||!1,t.teamRecords=e.teamRecords,t.controller=e.controller||!1,!p.isUndefined(e.teamRecords)&&e.teamRecords&&(t.renderTemplate(),t.listView=".schedule-list-h",t.singleView=!0),!p.isUndefined(e.eventPage)&&e.eventPage&&(t.renderTemplate(t.eventPage),t.listView=".schedule-list-h",t.eventView=!0),v.prototype.initialize.call(t,e);if(!t.collection)throw new Error("Schedule expected options.collection.");p.bindAll(t),t.addSubscribers()},afterRender:function(){var e=this;this.$el.find("a.team-info-h").each(function(){var t=h(this);h(this).qtip2({content:t.find("div.game-info").html(),position:{my:"bottom center",at:"top center",viewport:h(window)},style:{classes:"tipsy game-info",width:"360px"},hide:{fixed:!0,delay:1e3},events:{render:function(t,n){h(n.elements.tooltip).find(".add-score").on("click",e.addScore)}}})})},addScore:function(e){e.stopPropagation();var t=h(e.target).data("uslgamelink");h(e.target).off("click",this.addScore).html('<input type="text" placeholder="00:00:00" data-uslgamelink="'+t+'" style="width:100px; margin:0px;" id="usl_result_time_'+t+'" />'+'<span id="save_result_time'+t+'" style="margin-left:8px;">save</span>').find("#save_result_time"+t).on("click",this.updateGameLink)},updateGameLink:function(e){var t=h(e.target).prev(),n=new f({id:t.data("uslgamelink"),result_time:t.val()});n.save(),h.when(n.request).done(function(e){console.log(e),t.parent().html(e.payload.result_time)})},renderTemplate:function(e){var t=g.to_html(o,{data:this.collection.length,eventPage:e});return this.$el.html(t),this}}),l});