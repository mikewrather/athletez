define(["vendor","views","utils","text!packages/fbinvite/templates/image-item.html","packages/fbinvite/models/invite","utils/storage","chrome/views/header","component/fb"],function(e,t,n,r){var i,s=e.$,o=t.BaseView,u=e.Mustache,a=require("votes/models/vote"),f=require("utils/storage"),l=require("packages/fbinvite/models/invite"),c=require("chrome/views/header"),h=require("component/fb"),p=require("common/models/entparse");return i=o.extend({tagName:"li",className:"image",events:{},initialize:function(e){console.log(e),this.template=r,this.FBoptions=e.FBoptions||{};if(e.length)for(var t in e)this[t]=e[t];if(this.FBoptions.invite_type===undefined||this.FBoptions.invite_type===null)this.FBoptions.invite_type="join";this.FBComponent=new h},checkForUser:function(){return!_.isUndefined(routing.userLoggedIn)&&routing.userLoggedIn?!0:!1},render:function(){var e=this,t=this.model.get("payload"),n=u.to_html(this.template,t);this.$el.html(n);var r="120px",i="92px";return this.$el.find(".image-item-container").mouseout(function(){s(this).find(".action-block").css({opacity:0}),s(this).find(".detail-view").css({bottom:"-"+i}),s(this).find(".detail-view.game").css({bottom:"-"+r})}),$nopic_words_div=this.$el.find(".game-tile"),$nopic_words_div.length&&($num_words=$nopic_words_div.text().length,console.log($num_words),$num_words<3?$nopic_words_div.css({"font-size":"5em",top:"90px",left:"60px"}):$num_words<5?$nopic_words_div.css({"font-size":"4em",top:"90px",left:"40px"}):$num_words<25?$nopic_words_div.css("font-size","2em"):$num_words<30?$nopic_words_div.css({"font-size":"1.7em",top:"65px"}):$num_words<40?$nopic_words_div.css({"font-size":"1.5em",top:"50px"}):$nopic_words_div.css("font-size","1em")),this.$el.find(".image-item-container").mouseover(function(){s(this).find(".detail-view").css({bottom:"0px"}),s(this).find(".action-block").css({opacity:90})}),this.$el.find(".circle").mouseover(function(){s(this).parent().find(".detail-view").css({bottom:"0px"}),s(this).parent().find(".action-block").css({opacity:90})}),this.$el.find(".invite-h").click(function(t){e.invite(t)}),this},postMessage:function(e){var t=this,n={};n.link="#acceptfbinvite/"+this.model.get("payload").id,n.name="Come join Me on Atheletez",n.picture="http://cdn.athletez.com/resources/img/athletez_logo_small.png",n.description="You have been invited to sign up for http://athletez.com",n.success=function(){t.callModel(e)},n.error=function(){alert("Some Error Occured. Please try again.")},n.to=this.model.get("payload").id,this.FBComponent.sendInvite(n)},callModel:function(e){var t=new l;t.set({fbid:this.model.get("payload").id}),console.log(this.FBoptions),this.FBoptions&&t.set({invite_type:this.FBoptions.invite_type,invite_to:{subject_id:this.FBoptions.subject_id,enttype_id:this.FBoptions.enttype_id}}),t.save(),s.when(t.request).done(function(){s(e.target).addClass("link-disabled")})},invite:function(e){e.preventDefault(),e.stopPropagation();if(!this.checkForUser()){routing.trigger("showSignup");return}this.postMessage(e)}}),i});