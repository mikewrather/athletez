define(["require","text!registration/templates/register_facebook.html","backbone","facade","views","utils","jquery.pstrength","registration/collections/fbimages","registration/views/fbimage-list"],function(e,t,n){var r,i=e("facade"),s=e("views"),o=e("utils"),u=o.lib.Channel,a=s.SectionView,f=e("registration/collections/fbimages"),l=e("registration/views/fbimage-list");return r=a.extend({id:"main-content",events:{keypress:"stopSubmit","click .change-field":"changeField","click .diff_fb_pic":"diffFBPicture","click .upload_new_image":"uploadNewImage","click .next":"nextStep"},template:t,initialize:function(e){function n(e){t.$(".picture").attr("src",e)}function r(){t.initFBPictures()}function i(){t.initUploadImage()}var t=this;if(!this.model)throw new Error("RegistrationFacebookView expected options.model.");t.parseFBData(this.model.get("payload")),a.prototype.initialize.call(this,e),u("registration-change-picture").subscribe(n),u("registration-diff-fbpicture").subscribe(r),u("registration-upload-image").subscribe(i)},childViews:{},render:function(e,t,n){a.prototype.render.call(this,e,t,n),this.$(".password").pstrength()},stopSubmit:function(e){var t=e.keyCode?e.keyCode:e.which;t==13&&e.preventDefault()},diffFBPicture:function(e){e.preventDefault(),this.initFBPictures()},uploadNewImage:function(e){e.preventDefault(),this.initUploadImage()},parseFBData:function(e){e.hs_exists=e.high_school?!0:!1,e.dob_exists=e.birthday?!0:!1,e.email_exists=e.email?!0:!1,this.model.set("payload",e)},initFBPictures:function(){var e=this;this.fbimages?(debug.log(e.fbimages.toJSON(),"else"),this.fbImageListView=new l({collection:e.fbimages.toJSON()})):(this.fbimages=new f,this.fbimages.fetch(),$.when(this.fbimages.request).done(function(){debug.log("this.fbimages are as follows"),debug.log(e.fbimages.toJSON()),this.fbImageListView=new l({collection:e.fbimages.toJSON()})}))},setupFBPictures:function(){var e=this;this.fbImageListView=new l({collection:this.fbimages});var t=this.addChildView(this.fbImageListView);this.childViews.fbImageListView=this.fbImageListView,this.callbacks.add(function(){t()}),this.fbImageListView.render(),this.$el.append(e.fbImageListView.el),$("#"+this.fbImageListView.id).dialog({width:"80%",close:e.removeListView})},removeListView:function(){this.childViews.fbImageListView.removeCropView()},initUploadImage:function(){alert("Upload Image")},changeField:function(e){e.preventDefault(),$parent=this.$(e.target).parent(),id=$parent.attr("data-name"),value=$parent.attr("data-value"),$parent.html('<input type="text" id="'+id+'" name="'+id+'" value="'+value+'"/>')},nextStep:function(e){e.preventDefault();var t=this.$(":input").serializeArray(),n=this.model.get("payload");$.each(t,function(e,t){n[t.name]=t.value});if(n["password"]==""||n["password-again"]==""){alert("Please input a password");return}if(n["password"]!=n["password-again"]){alert("Please input a password correctly");return}if(n["agree"]==null){alert("Please agree to the Terms of Service");return}this.model.attributes.id=!1,this.model.set({payload:n,id:1}),this.model.url=function(){return testpath?testpath+"/user/basics":"/api/user/basics/"+n.users_id},this.model.save({callback:"true"},{success:function(e){location.href="#usersettings",$("#RegModal").modal("hide")}})}}),r});