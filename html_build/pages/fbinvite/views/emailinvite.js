define(["vendor","views","utils","facade","text!pages/fbinvite/templates/emailinvite.html","text!pages/fbinvite/templates/emaillist.html","fbinvite/models/emailinvite"],function(e,t,n,r,i,s,o){var u=r.$,a=r._,f=t.BaseView,l=r.Backbone;return f.extend({template:i,model:new o,events:{"keyup textarea":"parseEmailList","click .send-email-invite-h":"sendInvites"},initialize:function(e){this.setOptions(e),this.data=e,this.controller=e.controller,console.log(e),e.FBOptions&&this.model.set({invite_type:e.FBOptions.invite_type,invite_to:{subject_id:e.FBOptions.subject_id,enttype_id:e.FBOptions.enttypes_id}}),this.render()},render:function(){this.$el.html(a.template(this.template,this.data))},GetEmailsFromString:function(e){var t=/([a-zA-Z0-9._-]+@[a-zA-Z0-9._-]+\.[a-zA-Z0-9._-]+)/gi;return e.match(t)},concatUnique:function(e){var t=e.concat();for(var n=0;n<t.length;++n)if(t[n]==0||t[n]==undefined||t[n]==null)t.splice(n,1);else for(var r=n+1;r<t.length;++r)(t[n]===t[r]||t[n]==0||t[n]==undefined||t[n]==null)&&t.splice(r--,1);return t},parseEmailList:function(e){var t=u(e.target).val(),n=t.split(","),r=[];for(var i=0;i<n.length;i++)r=this.concatUnique(r.concat(this.GetEmailsFromString(n[i])));this.model.set({emailList:r}),this.drawEmailList()},drawEmailList:function(e){this.$el.find("div#emailAddresses").html(a.template(s,{data:this.model.get("emailList")})),this.$el.find("button.send-email-invite-h").html("Send "+this.model.get("emailList").length+" Invites").removeAttr("disabled")},sendInvites:function(e){var t=this;u(e.target).html("Sending...").attr("disabled","disabled"),this.model.save({},{success:function(n,r){u(e.target).html("Sent"),t.$el.find("textarea").val(""),a.each(n.get("payload"),function(e){console.log(e.invite_email,t.$el.find('#emailAdresses li[data-address="'+e.invite_email+'"]')),t.$el.find('li[data-address="'+e.invite_email+'"]').addClass("sent")})},error:function(e){}})}})});