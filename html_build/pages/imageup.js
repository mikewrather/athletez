/**
 * @license RequireJS text 2.0.4 Copyright (c) 2010-2012, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/requirejs/text for details
 */

define("text",["module"],function(e){var t,n,r=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],i=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,s=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,o=typeof location!="undefined"&&location.href,u=o&&location.protocol&&location.protocol.replace(/\:/,""),a=o&&location.hostname,f=o&&(location.port||undefined),l=[],c=e.config&&e.config()||{};t={version:"2.0.4",strip:function(e){if(e){e=e.replace(i,"");var t=e.match(s);t&&(e=t[1])}else e="";return e},jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:c.createXhr||function(){var e,t,n;if(typeof XMLHttpRequest!="undefined")return new XMLHttpRequest;if(typeof ActiveXObject!="undefined")for(t=0;t<3;t+=1){n=r[t];try{e=new ActiveXObject(n)}catch(i){}if(e){r=[n];break}}return e},parseName:function(e){var t,n,r,i=!1,s=e.indexOf("."),o=e.indexOf("./")===0||e.indexOf("../")===0;return s!==-1&&(!o||s>1)?(t=e.substring(0,s),n=e.substring(s+1,e.length)):t=e,r=n||t,s=r.indexOf("!"),s!==-1&&(i=r.substring(s+1)==="strip",r=r.substring(0,s),n?n=r:t=r),{moduleName:t,ext:n,strip:i}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(e,n,r,i){var s,o,u,a=t.xdRegExp.exec(e);return a?(s=a[2],o=a[3],o=o.split(":"),u=o[1],o=o[0],(!s||s===n)&&(!o||o.toLowerCase()===r.toLowerCase())&&(!u&&!o||u===i)):!0},finishLoad:function(e,n,r,i){r=n?t.strip(r):r,c.isBuild&&(l[e]=r),i(r)},load:function(e,n,r,i){if(i.isBuild&&!i.inlineText){r();return}c.isBuild=i.isBuild;var s=t.parseName(e),l=s.moduleName+(s.ext?"."+s.ext:""),h=n.toUrl(l),p=c.useXhr||t.useXhr;!o||p(h,u,a,f)?t.get(h,function(n){t.finishLoad(e,s.strip,n,r)},function(e){r.error&&r.error(e)}):n([l],function(e){t.finishLoad(s.moduleName+"."+s.ext,s.strip,e,r)})},write:function(e,n,r,i){if(l.hasOwnProperty(n)){var s=t.jsEscape(l[n]);r.asModule(e+"!"+n,"define(function () { return '"+s+"';});\n")}},writeFile:function(e,n,r,i,s){var o=t.parseName(n),u=o.ext?"."+o.ext:"",a=o.moduleName+u,f=r.toUrl(o.moduleName+u)+".js";t.load(a,r,function(n){var r=function(e){return i(f,e)};r.asModule=function(e,t){return i.asModule(e,f,t)},t.write(e,a,r,s)},s)}};if(c.env==="node"||!c.env&&typeof process!="undefined"&&process.versions&&!!process.versions.node)n=require.nodeRequire("fs"),t.get=function(e,t){var r=n.readFileSync(e,"utf8");r.indexOf("﻿")===0&&(r=r.substring(1)),t(r)};else if(c.env==="xhr"||!c.env&&t.createXhr())t.get=function(e,n,r){var i=t.createXhr();i.open("GET",e,!0),c.onXhr&&c.onXhr(i,e),i.onreadystatechange=function(t){var s,o;i.readyState===4&&(s=i.status,s>399&&s<600?(o=new Error(e+" HTTP status: "+s),o.xhr=i,r(o)):n(i.responseText))},i.send(null)};else if(c.env==="rhino"||!c.env&&typeof Packages!="undefined"&&typeof java!="undefined")t.get=function(e,t){var n,r,i="utf-8",s=new java.io.File(e),o=java.lang.System.getProperty("line.separator"),u=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(s),i)),a="";try{n=new java.lang.StringBuffer,r=u.readLine(),r&&r.length()&&r.charAt(0)===65279&&(r=r.substring(1)),n.append(r);while((r=u.readLine())!==null)n.append(o),n.append(r);a=String(n.toString())}finally{u.close()}t(a)};return t}),define("text!imageup/templates/basic.html",[],function(){return'<!--<div id="url" class="url">URL\r\n	<select id="url_tag">\r\n		<option value="user">Users</option>\r\n		<option value="game">Games</option>\r\n		<option value="team">Teams</option>\r\n	</select>\r\n	<input type="text" name="id_tag" id="id_tag" placeholder="ID"/>\r\n</div>\r\n<a href="#imgUploadModal" role="button" class="btn" data-toggle="modal">Upload Image</a>\r\n--><div id="imgUploadModal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">\r\n\r\n	<div class="modal-header">\r\n		<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>\r\n		<h3 id="label">Image Uploader</h3>\r\n	</div>\r\n\r\n	<div class="side-panel">\r\n		<div id="main-content-img"></div>\r\n		<div id="image-tagging"></div>\r\n	</div>\r\n\r\n	<div class="main-body">\r\n		<div id="errormsg"></div>\r\n		<div id="preview"></div>\r\n	</div>\r\n\r\n</div>'}),define("text!imageup/templates/uploader.html",[],function(){return'\r\n	<div id="imageholder" class="imageholder">Drag & Drop</div>\r\n	<div align="center"><input type="file" id="image_file" class="files" name="image_file[]" multiple=""></div>\r\n	<div class="modal-footer">\r\n		<button class="btn fileuploader btn-primary" id="imageup" type="button">Upload and Finish</button>\r\n	</div>\r\n	\r\n'}),define("controller",["facade","collections","models","utils"],function(e,t,n,r){var i,s=t.ApplicationStates,o=n.EventModel,u=e._,a=e.$,f=r.lib.Channel,l=e.Backbone.Model.extend;return i=function(e){e=e||{},this.route=e.route,i.prototype.appStates?e.appStates&&(i.prototype.appStates=e.appStates):i.prototype.appStates=new s,this.route&&i.prototype.appStates&&this.getStoredState(),this.initialize(e)},i.extend=l,i.prototype={initialize:function(e){return this.triggerPublishers(),u.bindAll(this),this.handleOptions(e),this.addSubscribers(),this.handleDeferreds(),this},generateRandomNumber:function(){var e=(new Date).getTime();return e+=Math.floor(Math.random()*200+1),e},setupSections:function(){},setupScheme:function(){},setupLayout:function(){var e;return this.layout=e,this.layout},handleDeferreds:function(){var e=this;a.when(null).then(function(){})},addSubscribers:function(){},removeSubscribers:function(){},triggerPublishers:function(){},meta:{activeViews:[],viewNames:[]},handleOptions:function(e){i.prototype.handleOptions(e)},routeChange:function(e){i.prototype.routeChange(options)},addStateChangeSubscriber:null},i.prototype.data=null,i.prototype.layout=null,i.prototype.scheme=[],i.prototype.sections={},i.prototype.route=null,i.prototype.handleOptions=function(e){e&&e.useFixtures&&this.useFixturesForWebServices()},i.prototype.transitionActiveViews=function(e){var t,n=this.layout,r=this.meta.sectionName,i=this.meta.activeViews=[];e=e||this.meta.presentation,t=function(t,s){s===e&&(t.state()==="not-rendered"&&t.render(),n.transition(r,t),i.push(s))},this.iterateOverLayoutViews(t)},i.prototype.renderInActiveViews=function(){var e;e=function(e){e.state()==="not-rendered"&&(e.callbacks.add(function(){e.state("not-displayed")}),e.render())},this.iterateOverLayoutViews(e)},i.prototype.iterateOverLayoutViews=function(e){var t=this.meta.activeViews,n=this.sections,r=this.meta.viewNames,i,s,o;for(o=0;o<r.length;o++)i=r[o],u.contains(t,i)||(s=n[i],e&&u.isFunction(e)&&e(s,i))},i.prototype.routeChange=function(e,t,n){var r={data:{}},s;if(e&&!u.isString(e))throw s="Controller routeChange expects string as 1st argument.",new Error(s);this.route=e,this.layout&&(this.layout.state({route:e}),r.data=this.layout.state(),u.extend(r,t||{}),i.prototype.appStates.add(r),this.data=r.data,debug.log(r),i.prototype.appStates.save(e)),n&&u.isFunction(n)&&n(this.data),debug.log("Controller routeChange method called with: "+e)},i.prototype.getStoredState=function(){var e;if(!this.route)throw new Error("Controller does not have route property.");return e=i.prototype.appStates.findInCollectionOrStorage(this.route),this.data=e&&e.data?e.data:e,this.data},i.prototype.addStateChangeSubscriber=function(e,t){function s(r,s){var o=e,a=t,f=n,l;f.layout&&(l=f.layout.state(),l&&i.prototype.appStates.add({name:f.route,data:l,expires:new Date(Date.now()+4032e4),storage:"localStorage"})),a&&u.isFunction(a)&&a(r,s)}var n=this,r;if(!e||!u.isString(e))throw r="controller method addStateChangeSubscriber expected string as 1st argument.",new Error(r);f(e+":stateChanged").subscribe(s)},i.prototype.remove=function(){var e;this.layout&&this.layout.remove();for(e in this)delete this[e]},i.prototype.webServices={},i.prototype.useFixturesForWebServices=function(){},i}),define("media/models/image",["facade","models/base"],function(e,t){var n,r=e._;return n=t.extend({defaults:r.extend({},(new t).attributes,{payload:{image_id:0,image_path:null,image_title:null,num_votes:0},desc:"Image information",exec_data:{exec_time:0,exec_error:!1}}),processItemFromPayload:function(e,t){var n=this,r=e.payload;return n.id=Math.ceil(Math.random()*1e5),t!=undefined?n.set("payload",r[t]):n.set("payload",r),n.set("desc",e.desc),n.set("exec_data",e.exec_data),this},selectImageType:function(e){return r.each(this.get("payload").types,function(t,n){n==e&&(this.get("payload").image_path=t.url)},this),this}}),n}),define("imageup/models/basic",["facade","media/models/image"],function(e,t){var n,r=e._;return n=t.extend({}),n}),define("imageup/models/imageupload",["facade","media/models/image"],function(e,t){var n,r=e._;return ImageUploadModel=t.extend({initialize:function(e,n){t.prototype.initialize.call(e,n)}}),n}),define("imageup/models/errorshow",["facade","models/base"],function(e,t){var n,r=e._;return n=t.extend({defaults:r.extend({},(new t).attributes,{msg:null,color:null}),initialize:function(e,t){}}),n}),define("media/collections/images",["facade","collections","media/models/image","utils"],function(e,t,n,r){var i,s=t.BaseCollection,o=e._,u=r.lib.Channel;return i=s.extend({model:n,fetchSuccess:function(e,t){e.reset();var r=t.payload;for(var i in r){var s=new n;s.processItemFromPayload(t,i),s.selected_image!=undefined&&(r[i].image_path=s.selected_image),e.push(s)}e.deferred.resolve(t)}}),i}),console.log("Called"),define("imageup/collections/basics",["facade","media/collections/images","utils"],function(e,t,n){var r,i=e._,s=n.lib.Channel;return r=t.extend({url:function(){return testpath?testpath+"/user/"+this.id+"/images/":"/api/user/images/"}}),r}),define("imageup/models/preview",["facade","models/base"],function(e,t){var n,r=e._;return n=t.extend({initialize:function(e,t){}}),n}),define("text!imageup/templates/error_template.html",[],function(){return'<div class="alert {{color}}" align="center">\r\n	<button type="button" class="close" data-dismiss="alert">&times;</button>\r\n	{{msg}}\r\n</div>'}),define("imageup/views/errors",["require","text!imageup/templates/error_template.html","facade","views","utils","vendor"],function(e,t){var n,r=e("facade"),i=e("views"),s=e("utils"),o=s.lib.Channel,u=e("vendor"),a=i.SectionView,f=r.$,l=r._,c=s.debug;return n=a.extend({id:"main-content",template:t,initialize:function(e){a.prototype.initialize.call(this,e),c.log("error view")}}),n}),define("imageup/views/basic",["require","text!imageup/templates/uploader.html","facade","views","utils","vendor","imageup/models/basic","imageup/views/errors"],function(e,t){var n,r=e("facade"),i=e("views"),s=e("utils"),o=s.lib.Channel,u=e("vendor"),a=i.SectionView,f=e("imageup/models/basic"),l=e("imageup/views/errors"),c=r.$,h=r._,p=s.debug;return p.log("SectionView: ",a),n=a.extend({id:"imageuploadForm",events:{"click #imageup":"imageUploadClick","change #image_file":"imagePreview","dragover #imageholder":"drag","drop #imageholder":"drop"},template:t,data:t,initialize:function(e,t){c("#errormsg, #preview").html(""),a.prototype.initialize.call(this,e),p.log("Image upload basic view"),this.attr=t,this.files_drag=[],c("#imgUploadModal").modal("show"),c("#imgUploadModal").on("hidden",function(){routing.trigger("refresh-onImageUpload")}),c("#imgUploadModal").on("hide",function(){routing.trigger("refresh-onImageUpload")}),console.log(c(".modal-body").html())},drag:function(e){e.stopPropagation(),e.preventDefault(),e.originalEvent.dataTransfer.dropEffect="copy"},drop:function(e){var t=this;e.stopPropagation(),e.preventDefault(),c("#errormsg").hide();var n=e.originalEvent.dataTransfer.files;this.files_drag=e.originalEvent.dataTransfer.files,n.length>0&&t.showLoader(t);var r=[],i=[],s=0;for(var o=0,u;u=n[o];o++){if(!u.type.match("image.*"))continue;var a=new FileReader;a.onload=function(e){return function(r){var o="preview_"+s;s++,i.push({preview_id:o,width:"150",height:"150",filesrc:r.target.result,title:escape(e.name)}),s==n.length&&(data={data:i},c("#image_file").attr("disabled","disabled"),routing.trigger("imageup-preview",data)),t.hideLoader()}}(u),a.readAsDataURL(u)}},imagePreview:function(e){var t=this;p.log("Image preview view"),c("#preview").hide(),c("#errormsg").hide();var n=c("#image_file")[0].files;console.log(n.length),n.length>0&&t.showLoader(t);var r=[],i=0,s,o=0;for(;s=n[i];i++){if(!s.type.match("image.*"))continue;var u=new FileReader;u.onload=function(e){return function(i){var s="preview_"+o;o++,r.push({preview_id:s,width:"150",height:"150",filesrc:i.target.result,title:escape(e.name)}),o==n.length&&(data={data:r},routing.trigger("imageup-preview",data),t.hideLoader())}}(s),u.readAsDataURL(s)}},imageUploadClick:function(e){e.preventDefault();var t=this;c("#errormsg").hide(),c("#imageup").attr("disabled","disabled"),c(".closepreview").attr("disabled","disabled"),c(".rotate").attr("disabled","disabled"),console.log(c("#image_file")[0].files.length),console.log(this.files_drag.length),console.log(c(".previewimg").length);if(c(".previewimg").length==0){var n={msg:"Image Field Empty",color:"alert-error"};routing.trigger("imageup-msg",n),c("#imageup").removeAttr("disabled")}else if(this.files_drag.length>=1){var r=this.files_drag.length;jQuery.each(this.files_drag,function(e,n){var i=new FormData;if(c("#preview_"+e+"group").length>0){i.append("image_file",n),c("#preview_"+e+"rotang").val()>0?i.append("rotate",c("#preview_"+e+"rotang").val()):i.append("rotate","false");for(var s in t.attr)i.append(s,t.attr[s]);var o={dataum:i,id:e,len:r};routing.trigger("imageup-add-image",o)}}),this.files_drag=[],c("#imageup").removeAttr("disabled")}else console.log(c("#image_file")[0].files.length+"=file prasobh"),jQuery.each(c("#image_file")[0].files,function(e,n){var r=new FormData;if(c("#preview_"+e+"group").length>0){r.append("image_file",n),c("#preview_"+e+"rotang").val()>0?r.append("rotate",c("#preview_"+e+"rotang").val()):r.append("rotate","false");for(var i in t.attr)r.append(i,t.attr[i]);var s={dataum:r,id:e,len:c("#image_file")[0].files.length};routing.trigger("imageup-add-image",s)}}),c("#imageup").removeAttr("disabled")}}),n}),define("text!imageup/templates/preview_template.html",[],function(){return'{{#data}} \r\n	<div class="previewimg" id="{{preview_id}}group"align="center">\r\n		<div id="{{preview_id}}rot" class="previewrotate"><button id="{{preview_id}}pre img" value="{{preview_id}}" class="btn rotate">Rotate</button></div>\r\n		<div class="previewimgsrc" id="{{preview_id}}pre" align="center">\r\n			<img src="{{filesrc}}" class="img-polaroid" width="{{width}}" height="{{height}}" title="{{title}}" draggable="false">\r\n			<button type="button" class="close closepreview" value ="{{preview_id}}"data-dismiss="{{preview_id}}">&times;</button>\r\n			<input type="hidden" id="{{preview_id}}rotang" value="0">\r\n		</div>\r\n		<div id="{{preview_id}}" class="previewprogress"></div>\r\n	</div>\r\n{{/data}} '}),define("imageup/views/preview",["require","text!imageup/templates/preview_template.html","facade","views","utils","vendor"],function(e,t){var n,r=e("facade"),i=e("views"),s=e("utils"),o=s.lib.Channel,u=e("vendor"),a=i.SectionView,f=r.$,l=r._,c=s.debug;return n=a.extend({id:"imgpreview",template:t,events:{"click .rotate":"imageRotate","click .close":"closePreview"},initialize:function(e){a.prototype.initialize.call(this,e),c.log("preview view"),this.degree=0},imageRotate:function(e){id=e.currentTarget.id,val=e.currentTarget.value,this.degree=f("#"+val+"rotang").val(),this.degree=parseInt(this.degree)+90,this.degree>=360&&(this.degree=0),f("#"+id).css({"-webkit-transform":"rotate("+this.degree+"deg)","-moz-transform":"rotate("+this.degree+"deg)","-ms-transform":"rotate("+this.degree+"deg)","-o-transform":"rotate("+this.degree+"deg)",transform:"rotate("+this.degree+"deg)",zoom:1}),f("#"+val+"rotang").val(this.degree)},closePreview:function(e){id=e.currentTarget.value+"group";var t=document.getElementById(id);t.parentNode.removeChild(t)}}),n}),define("imageup",["require","text!imageup/templates/basic.html","text!imageup/templates/uploader.html","facade","controller","models","views","utils","imageup/models/basic","imageup/models/imageupload","imageup/models/errorshow","imageup/collections/basics","imageup/models/preview","imageup/views/basic","imageup/views/errors","imageup/views/preview"],function(e,t){var n,r=e("facade"),i=e("controller"),s=e("models"),o=e("views"),u=e("utils"),a=e("imageup/models/basic"),f=e("imageup/models/imageupload"),l=e("imageup/models/errorshow"),c=e("imageup/collections/basics"),h=e("imageup/models/preview"),p=e("imageup/views/basic"),d=e("imageup/views/errors"),v=e("imageup/views/preview"),m=o.LayoutView,g=r.$,y=r._,b=u.debug,w=u.lib.Channel,E=["/pages/imageup/imageup.css"];return n=i.extend({initialize:function(e){return w("load:css").publish(E),y.bindAll(this),this.handleOptions(e),this.init(e),this},init:function(e){this.url=e.url,this.attr=e.attr,this.count=0,b.log("Imagecontroller Init"),this.setupLayout(),this.handleDeferreds(),this.showuploader()},handleDeferreds:function(){function t(t){e.imageUpload(t)}function n(t){e.msgShowup(t)}function r(t){e.previewShowup(t)}function i(){e.rerender()}var e=this;routing.off("imageup-add-image"),routing.on("imageup-add-image",function(e){t(e)}),routing.off("imageup-msg"),routing.on("imageup-msg",function(e){n(e)}),routing.off("imageup-preview"),routing.on("imageup-preview",function(e){r(e)}),routing.off("imageup-rerender"),routing.on("imageup-rerender",function(e){i(e)})},showuploader:function(){var e=new p({name:"Add Media",model:new a,destination:"#main-content-img"},this.attr);b.log("Imagecontroller Show"),console.log(this.scheme),this.scheme.push(e),this.layout.render()},setupLayout:function(){var e;return b.log("Imagecontroller Layout"),this.scheme=[],g(".model-popup-h").remove(),g("body").append('<div id="modalPopup" class="model-popup-h"></div>'),e=new m({scheme:this.scheme,destination:"#modalPopup",template:t,displayWhen:"ready"}),this.layout=e,this.layout},previewShowup:function(e){var t=new h(e);for(var n in this.scheme)this.scheme[n].id=="imgpreview"&&delete this.scheme[n];previewShowView=new v({name:"Preview Show View",model:t,destination:"#preview",displayWhen:"ready"}),b.log("Preview View Show"),this.scheme.push(previewShowView),g("#preview").show(),routing.trigger("imageup-rerender")},rerender:function(){this.showuploader()},imageUpload:function(e){console.log(e),b.log("image uploading starts");var t=e.id,n=e.len,r=[],i="",s=this,r=e.dataum;g("#preview_"+t).html('<div class="loader image-loading-div"></div>'),g(".previewimgsrc").addClass("fade-out"),g.ajax({url:this.url,data:r,cache:!1,processData:!1,contentType:!1,type:"POST",success:function(e){g("#preview_"+t).fadeOut("slow"),g("#preview_"+t+"rot").fadeOut("slow"),routing.trigger("image-upload-success",e),b.log(e),g("imageup").attr("disabled","disabled"),s.count++,s.count==n&&(i={msg:" File Uploaded Succesfully",color:"alert-success"},routing.trigger("imageup-msg",i),g("#imageup").removeAttr("disabled"),g("#image_file").removeAttr("disabled"),g(".closepreview").removeAttr("disabled"),g(".previewimgsrc").fadeOut("slow").removeClass("fade-out"))},error:function(e){g("#preview_"+t).fadeOut("slow"),g(".previewimgsrc").removeClass("fade-out"),g("#preview_"+t).fadeIn("slow").html("<b>Upload Error!</b>"),b.log(e),i={msg:e.statusText,color:"alert-error"},routing.trigger("imageup-msg",i),g("#imageup").removeAttr("disabled"),g("#image_file").removeAttr("disabled"),g(".closepreview").removeAttr("disabled");return}})},msgShowup:function(e){for(var t in this.scheme)this.scheme[t].destination=="#errormsg"&&delete this.scheme[t];errorShowModel=new l(e),addErrorView=new d({name:"File Upload Msg",model:errorShowModel,destination:"#errormsg",displayWhen:"ready"}),b.log("Error View Show"),this.scheme.push(addErrorView),g("#errormsg").show(),routing.trigger("imageup-rerender")}}),n});