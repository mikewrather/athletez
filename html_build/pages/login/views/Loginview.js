define(["require","text!login/templates/logintemplate.html","backbone","underscore","signup","views","facade","utils","login/models/Forgotmodel","signup/views/facebooksignup"],function(e,t,n,r,i){var s,o=e("facade"),u=e("views"),a=e("utils"),f=a.lib.Channel,l=e("login/models/Forgotmodel"),c=e("signup/views/facebooksignup"),h=n.View;return SigninBasicView=h.extend({initialize:function(e){this.callback=e.callback,r.isUndefined(e.attr)||(this.attr=e.attr),this.signcontroller=new i,this.template=r.template(t),this.$el=$(e.destination),this.render()},render:function(){this.$el.html(this.template),$("#errormsg, #preview").html(""),debug.log("Image upload basic view"),$("#Loginview").modal("show"),$("#Loginview").on("hide",function(){$("div#LoginPopup").empty()}),r.isUndefined(this.attr)||(this.attr=this.setAttrPayload(this.attr),this.$el.find('input[name="username"]').val(this.attr.email),this.$el.find('input[name="password"]').val(this.attr.password),r.isUndefined(this.attr.fb_invite_id)||this.$el.find("form#login").append('<input type="hidden" name="sechash" value="'+this.attr.fb_invite_id+'" />'))},setAttrPayload:function(e){var t={},n=e.attr;return $.each(n,function(e,n){t[n.name]=n.value}),t},events:{"click button#signup":"signupUser","click .loginUser":"userLogin","click .forgot-password-h":"forgotPassword","submit .forgot-password-form-h":"forgotPasswordForm","click .log-in-link-h":"loginPageView","submit #login":"userLogin","click #fbpane":"signupFacebook"},forgotPasswordForm:function(e){e.preventDefault();var t=routing.showSpinner(".forgot-pasword-btn-h"),n=this,r=new l;r.email=$(e.target).find(".forgot-password-email-h").val(),r.save({email:r.email}),$.when(r.request).done(function(){routing.hideSpinner(t,".forgot-pasword-btn-h"),n.$el.find(".success-message").removeClass("hide"),n.$el.find(".error-message").addClass("hide"),setTimeout(function(){n.loginPageView()},3e3)}),$.when(r.request).fail(function(){routing.hideSpinner(t,".forgot-pasword-btn-h"),n.$el.find(".error-message").removeClass("hide"),n.$el.find(".success-message").addClass("hide")})},signupFacebook:function(e){e.preventDefault(),$("#RegModal").modal("hide"),headView=new c({callback:this.callback}),headView.signupFacebook()},userLogin:function(e){e.preventDefault();var t=routing.showSpinner(".loginUser"),n=this.$(":input").serializeArray(),i=[],s=this;$.each(n,function(e,t){i[t.name]=t.value});var o=$.extend({},i);this.model.save(o,{success:function(e){routing.hideSpinner(t,".loginUser"),$("#Loginview").modal("hide"),s.callback&&r.isFunction(s.callback)?(routing.trigger("common-popup-close"),App.header&&App.header.render(!0),s.callback(function(){})):window.location.href="#profile",routing.trigger("hide-landing")},error:function(e){$(".errormsg").empty(),routing.hideSpinner(t,".loginUser");var n=jQuery.parseJSON(e.request.responseText);$(".errormsg").html(n.exec_data.error_array[0].error)}})},forgotPassword:function(e){e.preventDefault(),this.$el.find(".success-message").addClass("hide"),this.$el.find(".error-message").addClass("hide"),$("#Loginview h3#label").html("Forgot Password"),$("#loginmain").addClass("hide"),$(".forgot-password-container").removeClass("hide")},loginPageView:function(){this.$el.find(".success-message").addClass("hide"),this.$el.find(".error-message").addClass("hide"),$("#Loginview h3#label").html("Login"),$("#loginmain").removeClass("hide"),$(".forgot-password-container").addClass("hide")},signupUser:function(e){e.preventDefault(),routing.trigger("common-popup-close"),routing.trigger("register-basic",this.callback)}}),SigninBasicView});