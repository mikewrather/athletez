define(["require","text!userresume/templates/references.html","text!userresume/templates/listReferences.html","facade","views","utils","vendor","userresume/collections/references","userresume/collections/sports","userresume/models/reference"],function(e,t,n){var r,i=e("facade"),s=e("views"),o=s.SectionView,u=e("utils"),a=u.lib.Channel,f=e("vendor"),l=f.Mustache,c=i.$,h=e("userresume/collections/references"),p=e("userresume/collections/sports"),d=e("userresume/models/reference"),v=o.extend({template:t,events:{"click .btn-Add-reference_h":"AddNewReference","click .btn-Save_reference_h":"SaveNewReference","click .btn-Update_reference_h":"UpdateReference","click .btn-Cancel-New":"CancelNew","click .btn-Cancel-Existing_reference_h":"CancelExisting","click .btn-remove_reference_h":"RemoveReference","click .edit_reference_h":"EditReference"},controls:{listContainer:"#section-list-references",newReferenceContainer:".section-new-reference",newReferenceControls:".section-new-controls",btnAddReferencesExisting:".btn-Add-Existing",btnAddNew:".btn-Add",btnCancelExisting:".btn-Cancel-Existing_reference_h",btnRemoveExisting:".btn-remove_reference_h",btnUpdateReferenceExisting:".btn-Update_reference_h",btnEditReference:".edit_reference_h",ddlSports:".ddl-sports-references_h",newControls:".txtReferences_h",txtName:".txt_name_h",txtDescription:".txt_description_h",txtYear:".txt_year_h",txtEmail:".txt_email_h",txtPhone:".txt_phone_h",txtRelation:".txt_relation_h",lblError:".error_h",lblSuccess:".success_h"},messages:{dataNotExistReferences:"No References entered yet.",MandatoryFields:"All Fields are Mandatory."},initialize:function(e){o.prototype.initialize.call(this,e),r=this,r.setOptions(e),this.init()},render:function(){o.prototype.render.call(this)},setOptions:function(e){this.user_id=e.user_id},init:function(){r.setupView()},setupView:function(){r.setUpMainView(),r.setUpListView()},setUpMainView:function(){var e=l.to_html(r.template,{});c(r.el).html(e)},setUpListView:function(){var e={user_id:r.user_id},t=new h(e);t.user_id=r.user_id,t.fetch(),c.when(t.request).done(function(){if(t.isError())return;r.references=t.parseAsRequired();if(r.references.length>0){var e=l.to_html(n,{data:r.references});c(r.el).find(r.controls.listContainer).html(e)}else c(r.el).find(r.controls.listContainer).html(r.messages.dataNotExistReferences)})},ClearControls:function(e){c(e.target).parents(r.controls.newReferenceContainer).find(r.controls.newControls).val(""),c(e.target).parents(r.controls.newReferenceContainer).find(r.controls.newReferenceControls).fadeOut()},AddNewReference:function(e){r.ClearControls(e);var t=c(e.target).parents(r.controls.newReferenceContainer).find(r.controls.ddlSports);c(e.target).parents(r.controls.newReferenceContainer).find(r.controls.newReferenceControls).fadeIn();if(r.sports&&r.sports.length>0){r.setDropdownOptions(r.sports,"sport_name","sport_id",t,"Select Sport");return}var n=new p;n.sport_type=1,n.sport_type_id=1,n.male=1,n.female=0,r.gender=="male"?n.male=1:r.gender=="famale"&&(n.female=0),n.fetch(),c.when(n.request).done(function(){if(n.isError())return;var e=n.toJSON();(e==null||e.length<1)&&r.$(r.controls.ddlSports).parent().find(r.controls.fieldMessage).html(r.messages.dataNotExist).stop().fadeIn(),r.sports=[];for(var i in e)r.sports.push(e[i].payload);r.sort(r.sports,"sport_name",!1),r.setDropdownOptions(r.sports,"sport_name","sport_id",t,"Select Sport")})},AddExistingReference:function(){console.log("Add Existing")},SaveReference:function(e,t){var n=c(e.target).parents(r.controls.newReferenceContainer).find(r.controls.newReferenceControls),i=c(e.target).attr("sportid")||n.find(r.controls.ddlSports).val(),s=n.find(r.controls.txtName).val(),o=n.find(r.controls.txtDescription).val(),u=n.find(r.controls.txtRelation).val(),a=n.find(r.controls.txtEmail).val(),f=n.find(r.controls.txtPhone).val();if(i==""||i<1||c.trim(s)==""||c.trim(f)==""){n.find(r.controls.lblError).html(r.messages.MandatoryFields).fadeIn();return}n.find(r.controls.lblError).html("").fadeOut();var l={users_id:r.user_id,sports_id:i,name:s,relation:u,email:a,phone:f,long_description:o},h=0;t=="update"&&(h=c(e.target).attr("referenceid"),l.id1=c(e.target).attr("referenceid"));var p=new d(l);p.users_id=r.user_id,p.reference_id=h,p.action=t,p.target=c(e.target),p.save(),c.when(p.request).done(function(){r.ClearControls(e),r.setUpListView()})},SaveNewReference:function(e){r.SaveReference(e,"save")},EditReference:function(e){c(e.target).parents(r.controls.newReferenceContainer).find(r.controls.newControls).removeAttr("disabled"),c(e.target).fadeOut(),c(e.target).parents(r.controls.newReferenceContainer).find(r.controls.btnUpdateReferenceExisting).fadeIn(),c(e.target).parents(r.controls.newReferenceContainer).find(r.controls.btnCancelExisting).fadeIn(),c(e.target).parents(r.controls.newAwardContainer).find(r.controls.btnRemoveExisting).fadeOut()},UpdateReference:function(e){r.SaveReference(e,"update")},CancelNew:function(e){r.ClearControls(e)},CancelExisting:function(e){c(e.target).fadeOut(),c(e.target).parents(r.controls.newReferenceContainer).find(r.controls.btnUpdateReferenceExisting).fadeOut(),c(e.target).parents(r.controls.newReferenceContainer).find(r.controls.btnEditReference).fadeIn(),c(e.target).parents(r.controls.newAwardContainer).find(r.controls.btnRemoveExisting).fadeIn()},RemoveReference:function(e){var t=c(e.target).attr("referenceid"),n={id1:t,reference_id:t,users_id:r.user_id},i=new d(n);i.id1=t,i.users_id=r.user_id,i.reference_id=t,i.action="delete",i.target=c(e.target),i.destroy({success:function(){r.setUpListView()}})}});return v});