define(["require","text!userresume/templates/awards.html","text!userresume/templates/listAwards.html","facade","views","utils","vendor","userresume/collections/awards","userresume/collections/sports","userresume/models/award"],function(e,t,n){var r,i=e("facade"),s=e("views"),o=s.SectionView,u=e("utils"),a=u.lib.Channel,f=e("vendor"),l=f.Mustache,c=i.$,h=e("userresume/collections/awards"),p=e("userresume/collections/sports"),d=e("userresume/models/award"),v=o.extend({template:t,events:{"click .btn-Add-award_h":"AddNewAward","click .btn-Save_award_h":"SaveNewAward","click .btn-Update_award_h":"UpdateAward","click .btn-Cancel-New":"CancelNew","click .btn-Cancel-Existing_award_h":"CancelExisting","click .btn-remove_award_h":"RemoveAward","click .edit_award_h":"EditAward"},controls:{listContainer:"#section-list-awards",newAwardContainer:".section-new-award",newAwardControls:".section-new-controls",btnAddAwardsExisting:".btn-Add-Existing",btnAddNew:".btn-Add",btnCancelExisting:".btn-Cancel-Existing_award_h",btnRemoveExisting:".btn-remove_award_h",btnUpdateAwardExisting:".btn-Update_award_h",btnEditAward:".edit_award_h",ddlSports:".ddl-sports-awards_h",newControls:".txtAwards_h",txtName:".txt_name_h",txtDescription:".txt_description_h",txtYear:".txt_year_h",lblError:".error_h",lblSuccess:".success_h"},messages:{dataNotExistAwards:"No Awards Entered Yet.",MandatoryFields:"All fields are mandatory."},initialize:function(e){o.prototype.initialize.call(this,e),r=this,r.setOptions(e),this.init()},render:function(){o.prototype.render.call(this)},setOptions:function(e){this.user_id=e.user_id},init:function(){r.setupView()},setupView:function(){r.setUpMainView(),r.setUpListView()},setUpMainView:function(){var e=l.to_html(r.template,{});c(r.el).html(e)},setUpListView:function(){var e={user_id:r.user_id},t=new h(e);t.user_id=r.user_id,t.fetch(),c.when(t.request).done(function(){if(t.isError())return;r.awards=t.parseAsRequired();if(r.awards.length>0){var e=l.to_html(n,{data:r.awards});c(r.el).find(r.controls.listContainer).html(e)}else c(r.el).find(r.controls.listContainer).html(r.messages.dataNotExistAwards)})},ClearControls:function(e){console.log(c(e.target).parents(r.controls.newAwardContainer).find(r.controls.newAwardControls)),c(e.target).parents(r.controls.newAwardContainer).find(r.controls.newControls).val(""),c(e.target).parents(r.controls.newAwardContainer).find(r.controls.newAwardControls).fadeOut()},AddNewAward:function(e){r.ClearControls(e);var t=c(e.target).parents(r.controls.newAwardContainer).find(r.controls.ddlSports);c(e.target).parents(r.controls.newAwardContainer).find(r.controls.newAwardControls).fadeIn();if(r.sports&&r.sports.length>0){r.setDropdownOptions(r.sports,"sport_name","sport_id",t,"Select Sport");return}var n=new p;n.sport_type=1,n.sport_type_id=1,n.male=1,n.female=0,r.gender=="male"?n.male=1:r.gender=="famale"&&(n.female=0),n.fetch(),c.when(n.request).done(function(){if(n.isError())return;var e=n.toJSON();(e==null||e.length<1)&&r.$(r.controls.ddlSports).parent().find(r.controls.fieldMessage).html(r.messages.dataNotExist).stop().fadeIn(),r.sports=[];for(var i in e)r.sports.push(e[i].payload);r.sort(r.sports,"sport_name",!1),r.setDropdownOptions(r.sports,"sport_name","sport_id",t,"Select Sport")})},AddExistingAward:function(){console.log("Add Existing")},SaveAward:function(e,t){var n=c(e.target).parents(r.controls.newAwardContainer).find(r.controls.newAwardControls),i=c(e.target).attr("sportid")||n.find(r.controls.ddlSports).val(),s=n.find(r.controls.txtName).val(),o=n.find(r.controls.txtYear).val(),u=n.find(r.controls.txtDescription).val();if(i==""||i<1||c.trim(s)==""||c.trim(u)==""||c.trim(o)==""){n.find(r.controls.lblError).html(r.messages.MandatoryFields).fadeIn();return}n.find(r.controls.lblError).html("").fadeOut();var a={description:u,name:s,sports_id:i,year:o,users_id:r.user_id},f=0;t=="update"&&(f=c(e.target).attr("awardid"),a.id1=c(e.target).attr("awardid"));var l=new d(a);l.users_id=r.user_id,l.award_id=f,l.action=t,l.target=c(e.target),l.save(),c.when(l.request).done(function(){r.ClearControls(e),r.setUpListView()})},SaveNewAward:function(e){r.SaveAward(e,"save")},EditAward:function(e){c(e.target).parents(r.controls.newAwardContainer).find(r.controls.newControls).removeAttr("disabled"),c(e.target).fadeOut(),c(e.target).parents(r.controls.newAwardContainer).find(r.controls.btnRemoveExisting).fadeOut(),c(e.target).parents(r.controls.newAwardContainer).find(r.controls.btnUpdateAwardExisting).fadeIn(),c(e.target).parents(r.controls.newAwardContainer).find(r.controls.btnCancelExisting).fadeIn()},UpdateAward:function(e){r.SaveAward(e,"update")},CancelNew:function(e){r.ClearControls(e)},CancelExisting:function(e){c(e.target).fadeOut(),c(e.target).parents(r.controls.newAwardContainer).find(r.controls.btnUpdateAwardExisting).fadeOut(),c(e.target).parents(r.controls.newAwardContainer).find(r.controls.btnEditAward).fadeIn(),c(e.target).parents(r.controls.newAwardContainer).find(r.controls.btnRemoveExisting).fadeIn(),c(e.target).parents(r.controls.newAwardContainer).find("textarea, input").attr("disabled","disabled")},RemoveAward:function(e){var t=c(e.target).attr("awardid"),n={id1:t,award_id:t,users_id:r.user_id},i=new d(n);i.id1=t,i.users_id=r.user_id,i.award_id=t,i.action="delete",i.target=c(e.target),i.destroy({success:function(){r.setUpListView()}})}});return v});