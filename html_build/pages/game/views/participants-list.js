define(["facade","views","utils","media/views/image-item","text!game/templates/participats-list.html","game/models/addparticipate","common/models/add"],function(e,t,n,r,i,s,o){var u,a,f=e.$,l=e._,c=require("vendor"),h=n.lib.Channel,p=t.CollectionView,d=t.SectionView,v=c.Mustache;return ParticipantsView=p.extend(d.prototype),ParticipantsView.extend({__super__:p.prototype,template:i,_tagName:"li",_className:"image",page:0,page_limit:8,listView:".image-list",_view:r,events:{"click .see-more-h":"seeMore"},renderTemplate:function(){var e=v.to_html(this.template,{target:this.target_id});return this.$el.html(e),this},addParticipant:function(){var e=new s,t=this;e.set({games_id:this.game_id,sports_id:this.sports_id}),e.save(),f.when(e.request).done(function(){var n=e.toJSON(),r=new o;r.processItemFromResponse(n.payload.usl.user),f(".add-to-event").hide(),t.collection.add(r)})},initialize:function(e){var t=this;f(document).off("click",".add-to-event"),f(document).on("click",".add-to-event",function(){if(!t.checkForUser()){routing.trigger("showSignup");return}t.addParticipant()}),f(".participants-heading-h").removeClass("hide"),e.name?this.name=e.name:this.name="image list",e.collecton&&(this.collection=e.collection),this.controller=e.controller,this.sports_id=e.sports_id,this.game_id=this.collection.id,this.renderTemplate();var n=this.collection.toArray(),r=n[0].get("payload"),i=[],s=!1;for(var o in r)routing.loggedInUserId==r[o].id&&(s=!0,f(".add-to-event").hide()),i.push({payload:r[o]});s||f(".add-to-event").show(),this.collection.reset(i),this.target_id=e.target_id,this.target_url=e.target_url,this.sport_id=e.sport_id;var t=this;t.allData=this.collection.toArray(),t.seeMore(),p.prototype.initialize.call(this,e);if(!this.collection)throw new Error("ImageListView expected options.collection.");l.bindAll(this),this.addSubscribers(),this.setupAddView()},seeMore:function(e){var t=this.allData.length,n=this.page*this.page_limit,r=n+this.page_limit;t<=r&&this.$el.find(".see-more-h").hide(),e?this.collection.add(this.allData.slice(n,r)):this.collection.reset(this.allData.slice(n,r)),this.page++,e&&(this.addSubscribers&&this.addSubscribers(),this.setupAddView&&this.setupAddView())},checkForUser:function(){return!l.isUndefined(routing.userLoggedIn)&&routing.userLoggedIn?!0:!1},childViews:{},setupAddView:function(){function r(e){t.model=e,t.render(),f(this.listView).append(t.el)}var e,t=new AddImageView({collection:this.collection}),n=this.addChildView(t);this.childViews.form=t,this.callbacks.add(function(){n()}),h("addimage:fetch").subscribe(r)},filterWithImageType:function(e){var t=this.collection;return f.each(t.models,function(t,n){n.selectImageType&&n.selectImageType(e)}),t}})});