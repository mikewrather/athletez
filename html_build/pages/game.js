define(["require","text!game/templates/layout.html","votes/views/vote","facade","controller","models","views","utils","game/models/basics","game/models/addmedia","game/collections/teamrosters","game/collections/videos","game/collections/images","game/collections/participants","game/collections/comments","game/collections/commentson","game/views/header","game/views/add-media","game/views/commenton-list","sportorg/views/teamroster-list","game/views/video-list","profile/views/image-video-list","game/views/comment-list","game/views/commenton-list","roster/views/roster","common/views/add-media-buttons","text!common/templates/add-media-buttons.html","text!common/templates/add-participants-buttons.html","game/views/participants-list-main"],function(e,t,n){var r,i=e("facade"),s=e("controller"),o=e("models"),u=e("views"),a=e("utils"),f=e("game/models/basics"),l=e("game/models/addmedia"),c=e("game/collections/teamrosters"),h=e("game/collections/videos"),p=e("game/collections/images"),d=e("game/collections/comments"),v=e("game/collections/commentson"),m=e("game/collections/participants"),g=e("game/views/header"),y=e("game/views/add-media"),b=e("sportorg/views/teamroster-list"),w=e("game/views/video-list"),E=e("profile/views/image-video-list"),S=e("game/views/comment-list"),x=e("game/views/commenton-list"),T=e("media/models/image"),N=e("roster/views/roster"),C=e("common/views/add-media-buttons"),k=e("text!common/templates/add-media-buttons.html"),L=e("text!common/templates/add-participants-buttons.html"),A=e("game/views/participants-list-main"),O=u.LayoutView,M=i.$,_=i._,D=a.debug,P=a.lib.Channel,H=[base_url+"pages/game/game.css"];return r=s.extend({rosterViewsCount:0,initialize:function(e){return P("load:css").publish(H),_.bindAll(this),this.scheme=[],e.params&&this.setParamsArray(e.params),this.handleOptions(e),this.init(),this},handleOptions:function(e){this.id=e.gameId,this.userId=e.userId},init:function(){this.setupLayout().render(),this.createData(),this.handleDeferreds(),this.handleClickEvents()},handleClickEvents:function(){M(document).off("click",".green-left-heading"),M(document).on("click",".green-left-heading",function(){M(this).hasClass("down-arrow-heading")?(M(this).removeClass("down-arrow-heading"),M(this).next().slideUp(),M(this).next().attr("id")=="commenton-wrap"&&M(this).next().next().slideUp(),M(this).parent().parent().next().slideUp()):(M(this).addClass("down-arrow-heading"),M(this).next().slideDown(),M(this).next().attr("id")=="commenton-wrap"&&M(this).next().next().slideDown(),M(this).parent().parent().next().slideDown())})},createData:function(){this.basics=new f({id:this.id}),this.basics.targetElement="#main",this.basics.fetch(),this.addmedia=new l,this.addmedia.id=this.id},handleDeferreds:function(){var e=this;M.when(this.basics.request).done(function(){e.setupHeaderView();var t=e.basics.get("payload"),n=t.enttypes_id;e.images=new p,e.images.id=e.id,e.images.targetElement="#image-wrap",e.images.fetch();var r=t.teams,i=r?r.length:0;for(var s=0;s<i;s++)e.setupRosterView(r[s].id,r[s].org_sport_link_obj.org.name,r[s].enttypes_id);e.commentson=new v,e.commentson.subject_entity_type=n,e.commentson.id=e.id,e.commentson.targetElement="#commenton-wrap",e.commentson.fetch(),console.error(e.basics.get("payload"));var o=e.basics.get("payload"),u=!_.isUndefined(o.teams)&&o.teams?o.teams.length:0;e.teamsCount=u,u||(e.participants=new m,e.participants.id=e.id,e.participants.targetElement="#roster-wrap",e.participants.fetch(),M.when(e.participants.request).done(function(){e.setupParticipantsListView()})),M.when(e.commentson.request).done(function(){e.setupCommentsOnListView()}),M.when(e.images.request).done(function(){e.setupImageListView()})})},initVoteView:function(){var e=new n({name:"vote View",destination:"#votes-area-h",model:this.basics,userId:this.id});this.scheme.push(e),this.layout.render()},setupRosterView:function(e,t,n){M("#roster_wrap_"+this.rosterViewsCount).length||M("#roster-wrap").append('<div id="roster_wrap_'+this.rosterViewsCount+'" class="clear"></div>');var r,s=i.Backbone.Collection.extend({});r=new N({model:new s,team_id:e,entityId:n,team_name:t,controllerObject:this,name:"roster images"+Math.random()*Math.random(),destination:"#roster_wrap_"+this.rosterViewsCount,teamName:this.basics.get("payload").game_name}),this.scheme.push(r),this.layout.render(),this.rosterViewsCount++},setupHeaderView:function(){var e;e=new g({model:this.basics,name:"Header",destination:"#main-header"}),this.scheme.push(e),this.layout.render()},setupAddMediaView:function(e){var t;t=new y({model:this.addmedia,name:"Add Media",destination:e,controllerObject:this}),t.game_model=this.basics,this.scheme.push(t),this.layout.render()},reloadParticipateView:function(){var e=this,t;this.participantsView&&(M(this.participantsView.destination).html(""),t=M.inArray(this.participantsView,this.scheme),~t&&this.scheme.splice(t,1)),e.participants.fetch(),M.when(e.participants.request).done(function(){e.setupParticipantsListView()})},reloadParticipants:function(){var e=this,t;this.participantsView&&(M(this.participantsView.destination).html(""),t=M.inArray(this.participantsView,this.scheme),~t&&this.scheme.splice(t,1)),e.participants.fetch(),M.when(e.participants.request).done(function(){e.setupParticipantsListView()})},setupParticipantsListView:function(){var e=this,t=new C({target:".participants-add-icons-h",heading:"PARTICIPANTS",template:L,controllerObject:e,inviteData:{invite_type:"join",subject_id:e.basics.get("payload").id,enttypes_id:e.basics.get("payload").enttypes_id},message:{event_name:e.basics.get("payload").game_name}});this.participantsView=new A({collection:this.participants,name:"participants view",controller:this,controllerObject:this,sport_id:this.basics.get("payload").sports_id,destination:"#participants_div",teamName:this.basics.get("payload").game_name}),this.scheme.push(this.participantsView),this.layout.render()},setupTeamRosterListView:function(){M("#roster_wrap_"+this.rosterViewsCount).length||M("#roster-wrap").append('<div id="#roster_wrap_'+this.rosterViewsCount+'" class="clear"></div>');var e;e=new E({collection:this.teamrosters,name:"roster images",destination:"#roster_wrap_"+this.rosterViewsCount,teamName:this.basics.get("payload").game_name}),this.scheme.push(e),this.layout.render(),this.rosterViewsCount++},setupTeamRosterSecondListView:function(){var e;e=new E({collection:this.teamrostersSecond,name:"roster roster second images",destination:"#roster-second-wrap",teamName:this.basics.get("payload").game_name}),this.scheme.push(e),this.layout.render()},setupVideoListView:function(){var e;e=new w({collection:this.videos,destination:"#video-wrap"}),this.scheme.push(e),this.layout.render()},setupImageListView:function(){var e=this,t,n=new C({target:".media-add-icons-h",heading:"PHOTO/VIDEO",template:k,page_base:"game",ent_id:e.id,sports_id:M(".sport-h").data("id"),controllerObject:e,model:e.addmedia,message:{photo:"Got Pics From this Game?",video:"Got Videos From this Game?"}});routing.off("setup-add-icons"),routing.on("setup-add-icons",function(t){e.setupAddMediaView(t)}),t=new E({collection:this.images,name:"image list",target_id:this.id,controllerObject:this,target_url:"/api/game/addimage/",sport_id:M(".sport-h").data("id"),destination:"#image-wrap",media_id:this.media_id,pageName:"game",triggerItem:"setup-add-icons",teamName:this.basics.get("payload").game_name}),this.imageListView=t,routing.off("image-upload-success"),routing.on("image-upload-success",function(t){e.updateImages(t)}),this.scheme.push(t),this.layout.render()},reloadImages:function(){var e=this,t;this.imageListView&&(M(this.imageListView.destination).html(""),t=M.inArray(this.imageListView,this.scheme),~t&&this.scheme.splice(t,1)),e.images.fetch(),M.when(e.images.request).done(function(){e.setupImageListView()})},updateImages:function(e){var t=new T;t.processItemFromPayload(e),t.selectImageType(this.imageListView.imagetype),this.imageListView.collection.add(t),this.imageListView.allData&&this.imageListView.allData.push(t.toJSON()),this.imageListView.collection.length==1&&this.reloadImages()},setupCommentListView:function(){},setupCommentsOnListView:function(){var e;e=new x({collection:this.commentson,userId:this.userId,destination:".commentson-outer-box-h",name:"games comment on view"}),this.scheme.push(e),this.layout.render()},setupLayout:function(){var e;return e=new O({scheme:this.scheme,destination:"#main",template:t,displayWhen:"ready"}),this.layout=e,this.layout}}),r});