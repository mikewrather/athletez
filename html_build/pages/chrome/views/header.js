define(["vendor","views","text!chrome/templates/header.html","chrome/models/header","registration","utils/storage"],function(e,t,n,r,i,s){var o,u=t.BaseView,a=e.$,f=e._,l=e.Mustache;return o=u.extend({tagName:"header",className:"container-fluid clearfix",initialize:function(e){this.template=n},model:new r,events:{"click .signup-facebook":"signupFacebook","click .signup-email":"signupUser","click .account clearfix a":"login"},render:function(){var e=this;return this.model.fetchSuccess=this.model.fetchError=function(t,n){var r=l.to_html(e.template,t.toJSON());e.$el.html(r),console.log(t.toJSON());var i=t.get("user_photo").types.small_thumb.url,s=t.get("user_email");e.$(".photo img").attr("src",i);var o=t.get("authorized");if(o){var u=t.get("id");e.model.saveCookie(),routing.trigger("app-inited",u)}},this.model.fetch(),this},signupFacebook:function(e){function t(){FB.login(function(e){e.authResponse?Channel("registration-with-facebook").publish():alert("Cancelled")},{scope:"email, user_birthday, user_photos"})}function n(){this.registrationController||(this.registrationController=new i({route:""})),this.registrationController.refreshPage();var e,n="facebook-jssdk",r=document.getElementsByTagName("script")[0];if(document.getElementById(n)){t();return}e=document.createElement("script"),e.id=n,e.async=!0,e.src="//connect.facebook.net/en_US/all.js",r.parentNode.insertBefore(e,r)}e.preventDefault(),window.fbAsyncInit=function(){FB.init({appId:"239430712864961",status:!0,cookie:!0,xfbml:!0,oauth:!0}),FB.getLoginStatus(function(e){e.status==="connected"?FB.api("/me",function(e){console.log(e),Channel("registration-with-facebook").publish()}):e.status==="not_authorized"?(console.log("not_authorized"),t()):t()},{scope:"email, user_birthday, user_photos"})},n()},signupUser:function(e){e.preventDefault(),routing.trigger("add-user")}}),o});