define(["require","text!profilesetting/templates/basic_info_header.html","text!profilesetting/templates/basic_info_header_edit.html","text!profilesetting/templates/basic_info_header_completed.html","profilesetting/models/basic_info","facade","views","utils","vendor","usercontrols/imagecropper/imagecropper"],function(e,t,n,r){var i,s=e("facade"),o=e("views"),u=e("profilesetting/models/basic_info"),a=o.SectionView,f=e("utils"),l=f.lib.Channel,c=e("vendor"),h=c.Mustache,p=s.$,d=e("usercontrols/imagecropper/imagecropper");return i=a.extend({id:"basic_info",template:t,events:{"click .btn-prof-setting-h":"initialize","click #edit_profile_info":"editProfile","click #change_user_pic":"changeUserpic","click #save_user_data":"saveProfileBasics"},initialize:function(e){this.initBasicView(),e.length>0&&a.prototype.initialize.call(this,e)},initBasicView:function(){var e=this;this.basicInfoModel=new u,this.basicInfoModel.fetch(),p.when(this.basicInfoModel.request).done(function(){e.basicInfoModel.set("id",e.basicInfoModel.get("payload").id),e.setupBasicView()})},setupBasicView:function(){console.log("called");var e=this,t=h.to_html(e.template,this.basicInfoModel.toJSON());console.log(t),p("#section-basics-prof-setting").html(t),p("#change_user_pic").bind("click",function(){e.changeUserpic()}),p("#edit_profile_info").bind("click",function(){e.editProfile()}),p("#save_user_data").bind("click",function(){e.saveProfileBasics()})},setOptions:function(e){if(!this.model)throw new Error("HeaderView expects option with model property.")},editProfile:function(){var e=this,t=h.to_html(n,this.basicInfoModel.toJSON());p("div#user_profile_data").html(t),p("#save_user_data").bind("click",function(){e.saveProfileBasics()})},saveProfileBasics:function(){var e=this,t={};p("div#user_profile_data").find("input").each(function(){t[p(this).attr("model-property")]=p(this).val()}),console.log(t),this.basicInfoModel.save(t,{success:function(){var t=h.to_html(r,e.basicInfoModel.toJSON());p("div#user_profile_data").html(t),p("#edit_profile_info").bind("click",function(){e.editProfile()})}})},changeUserpic:function(){var e=this.basicInfoModel.get("payload");l("userpic-changed").subscribe(function(){t.initBasicView()});var t=this,n=new d({image_o:e.user_picture_obj.pre_crop_url,image_e:e.user_picture_obj.image_path})}}),i});