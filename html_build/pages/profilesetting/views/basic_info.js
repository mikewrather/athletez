define(["require","text!profilesetting/templates/basic_info_header.html","text!profilesetting/templates/basic_info_header_edit.html","profilesetting/models/basic_info","facade","views","utils","vendor","usercontrols/imagecropper/imagecropper"],function(e,t,n){var r,i=e("facade"),s=e("views"),o=e("profilesetting/models/basic_info"),u=s.SectionView,a=e("utils"),f=a.lib.Channel,l=e("vendor"),c=l.Mustache,h=i.$,p=e("usercontrols/imagecropper/imagecropper");return r=u.extend({id:"basic_info",template:t,events:{"click .btn-prof-setting-h":"initialize","click #edit_profile_info":"editProfile","click #change_user_pic":"changeUserpic"},initialize:function(e){this.initBasicView(),e.length>0&&u.prototype.initialize.call(this,e)},initBasicView:function(){var e=this;this.basicInfoModel=new o,this.basicInfoModel.fetch(),h.when(this.basicInfoModel.request).done(function(){e.basicInfoModel.set("id",e.basicInfoModel.get("payload").id),e.setupBasicView()})},setupBasicView:function(){var e=this,t=c.to_html(e.template,this.basicInfoModel.toJSON());console.log(t),h("#section-basics-prof-setting").html(t),h("#change_user_pic").bind("click",function(){e.changeUserpic()}),h("#edit_profile_info").bind("click",function(){e.editProfile()})},setOptions:function(e){if(!this.model)throw new Error("HeaderView expects option with model property.")},editProfile:function(){var e=this,t=c.to_html(n,this.basicInfoModel.toJSON());h("div#user_profile_data").html(t),h("#save_user_data").bind("click",function(){e.saveProfileBasics()})},saveProfileBasics:function(){var e=this,t={};h("div#user_profile_data").find("input").each(function(){t[h(this).attr("model-property")]=h(this).val()}),this.basicInfoModel.save(t,{success:function(){e.initBasicView()}})},changeUserpic:function(){var e=this.basicInfoModel.get("payload");console.log(e);var t=this,n=new p({image_o:e.user_picture_obj.pre_crop_url,image_e:e.user_picture_obj.image_path});f("userpic-changed").subscribe(function(){t.initBasicView()})}}),r});