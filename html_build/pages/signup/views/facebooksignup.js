define(["vendor","views","registration","signup","signup/views/shopopup","utils/storage"],function(e,t,n,r,i,s){var o,u=t.BaseView,a=e.$,f=e._,l=e.Mustache;return o=u.extend({signupFacebook:function(e){var t=this;this.linkWithFB=e&&e=="linkWithFB"?!0:!1,this.registrationController||(this.registrationController=new n);var r=f.bind(t.getFBlogin,this);this.Fbinit(r),this.loadFBLogin()},Fbinit:function(e){var t=this;window.fbAsyncInit=function(){console.log("facebook"),FB.init({appId:App.Settings.appId,status:!0,cookie:!0,xfbml:!0,oauth:!0}),e()}},loadFBLogin:function(){this.registrationController.refreshPage();var e,t="facebook-jssdk",n=document.getElementsByTagName("script")[0];if(document.getElementById(t)){this.loginInfo=this.loginfb();return}e=document.createElement("script"),e.id=t,e.async=!0,e.src="//connect.facebook.net/en_US/all.js",n.parentNode.insertBefore(e,n)},getFBlogin:function(){var e=this;FB.getLoginStatus(function(t){t.status==="connected"?FB.api("/me",function(t){e.linkWithFB&&alert("Facebook Account linked Successfully."),routing.trigger("registration-with-facebook")}):t.status==="not_authorized"?(e.linkWithFB&&alert("There was a problem trying to establish a connection to Facebook."),console.log("not_authorized"),e.loginInfo||(e.loginInfo=e.loginfb())):e.loginInfo||(e.loginInfo=e.loginfb())},{scope:"email, user_birthday, user_photos"})},loginfb:function(){FB.login(function(e){e.authResponse?routing.trigger("registration-with-facebook"):alert("Cancelled ")},{scope:"email, user_birthday, user_photos"})},checkFBlogin:function(){FB.getLoginStatus(function(e){e.status==="connected"&&FB.api("/me",function(e){console.log(e),routing.trigger("registration-with-facebook")})},{scope:"email, user_birthday, user_photos"})}}),o});