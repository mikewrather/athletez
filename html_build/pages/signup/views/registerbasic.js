define(["require","text!signup/templates/registration.html","text!signup/templates/registration_landing.html","backbone","underscore","registration","login","views","signup/views/facebooksignup","facade","utils","signup/views/registration-basics-final","signup/models/registration-basics-final"],function(e,t,n,r,i,s,o){var u,a=e("facade"),f=e("views"),l=e("signup/views/facebooksignup"),c=e("utils"),h=c.lib.Channel,p=e("signup/views/registration-basics-final"),d=e("signup/models/registration-basics-final"),v=r.View;return u=v.extend({initialize:function(e){e.openAsaPage&&(this.openAsaPage=e.openAsaPage),this.callback=e.callback,this.registrationController=new s({route:"",callback:this.callback}),this.invite_hash=e.invite_hash?e.invite_hash:!1,console.log("Options passed to registerbasics",e),this.AcceptData=e.data?e.data:undefined,e.showOnLanding==1?this.template=i.template(n,{onlyRegister:this.openAsaPage?!0:!1,invite_hash:this.invite_hash}):this.template=i.template(t,{onlyRegister:this.openAsaPage?!0:!1,invite_hash:this.invite_hash}),this.$el=$(e.destination),$("#errormsg, #preview").html(""),v.prototype.initialize.call(this,e),this.render(),this.facebookView=new l({callback:this.callback,invite_hash:this.invite_hash})},render:function(){this.$el.html(this.template),this.AcceptData&&(this.$el.find("input[name=firstname]").val(this.AcceptData.firstname),this.$el.find("input[name=lastname]").val(this.AcceptData.lastname),this.$el.find("input[name=email]").val(this.AcceptData.email)),routing.trigger("center-landing-image",{})},events:{"click .regsubmit":"next","click #fbpane":"signupFacebook","click #reglogin a":"showLogin","click .login":"showLogin"},next:function(e){e.preventDefault();var t=$(e.target).parents("form").find("input[name=fullname]"),n=t.val(),r=/[a-zA-Z\.\_\-]$/;if(!r.test(n))return t.addClass("field-failed"),setTimeout(function(){t.removeClass("field-failed")},2e3),!1;var i=this.$(":input").serializeArray(),s=!0;$.each(this.$(":input"),function(e,t){t.value||(setTimeout(function(){$(t).addClass("field-failed"),setTimeout(function(){$(t).removeClass("field-failed")},2e3)},parseInt(e+"00")),s=!1)});try{if(this.openAsaPage&&s){routing.trigger("common-popup-close");var o={};o.height="500px",o.width="500px",o.title="The Basics",o.html='<div id="reg-cont"></div>',routing.trigger("common-popup-open",o),this.basic_type=new d;var o={model:this.basic_type,name:"Final registration",attr:{attr:i},openAsPopUp:!0,callback:this.callback,invite_hash:this.invite_hash,destination:$("#reg-cont")};this.selectRegisterBasicFinalView=new p(o)}else s&&routing.trigger("register-basic-final",i,this.callback)}catch(u){console.log(u.stack)}},signupFacebook:function(e){e.preventDefault(),$(e.target).parent().find("#label").addClass("loading").html("Connecting to Facebook..."),$("#RegModal").modal("hide"),this.facebookView.loginfb()},showLogin:function(t){t.preventDefault();var n=this.$(":input").serializeArray(),r=e("login");routing.trigger("common-popup-close"),this.logincontroller=new r({callback:this.callback,attr:{attr:n}}),routing.trigger("Login")}}),u});