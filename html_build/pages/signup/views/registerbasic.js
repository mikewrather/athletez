define(["require","text!signup/templates/registration.html","backbone","underscore","registration","views","facade","utils"],function(e,t,n,r,i){var s,o=e("facade"),u=e("views"),a=e("utils"),f=a.lib.Channel,l=n.View;return s=l.extend({initialize:function(e){this.template=r.template(t),this.$el=$(e.destination),$("#errormsg, #preview").html(""),l.prototype.initialize.call(this,e),debug.log("Image upload basic view"),$("#imgUploadModal").modal("show"),$("#imgUploadModal").on("hidden",function(){}),$("#imgUploadModal").on("hide",function(){}),this.render()},render:function(){this.$el.html(this.template)},events:{"click .regsubmit":"next","click #fbpane":"signupFacebook"},next:function(e){e.preventDefault();var t=this.$(":input").serializeArray(),n=!0;$.each(t,function(e,t){if(!t.value)return alert(t.name+" is blank"),n=!1,!1}),n&&routing.trigger("register-basic-final",t)},signupFacebook:function(e){function t(){FB.login(function(e){e.authResponse?f("registration-with-facebook").publish():alert("Cancelled")},{scope:"email, user_birthday, user_photos"})}function n(){this.registrationController||(this.registrationController=new i({route:""})),this.registrationController.refreshPage();var e,n="facebook-jssdk",r=document.getElementsByTagName("script")[0];if(document.getElementById(n)){t();return}e=document.createElement("script"),e.id=n,e.async=!0,e.src="//connect.facebook.net/en_US/all.js",r.parentNode.insertBefore(e,r)}e.preventDefault(),$("#imgUploadModal").modal("hide"),window.fbAsyncInit=function(){FB.init({appId:"239430712864961",status:!0,cookie:!0,xfbml:!0,oauth:!0}),FB.getLoginStatus(function(e){e.status==="connected"?FB.api("/me",function(e){console.log(e),f("registration-with-facebook").publish()}):e.status==="not_authorized"?(console.log("not_authorized"),t()):t()},{scope:"email, user_birthday, user_photos"})},n()},registerWithFacebook:function(e){function t(){FB.login(function(e){e.authResponse?f("registration-with-facebook").publish():alert("Cancelled")},{scope:"email, user_birthday, user_photos"})}function n(){var e,n="facebook-jssdk",r=document.getElementsByTagName("script")[0];if(document.getElementById(n)){t();return}e=document.createElement("script"),e.id=n,e.async=!0,e.src="//connect.facebook.net/en_US/all.js",r.parentNode.insertBefore(e,r)}e.preventDefault(),window.fbAsyncInit=function(){FB.init({appId:"239430712864961",status:!0,cookie:!0,xfbml:!0,oauth:!0}),FB.getLoginStatus(function(e){e.status==="connected"?FB.api("/me",function(e){f("registration-with-facebook").publish()}):e.status==="not_authorized"?t():t()},{scope:"email, user_birthday, user_photos"})},n()}}),s});