define(["require","text!team/templates/header.html","text!team/templates/sport-select.html","team/models/basics","facade","views","utils","vendor","team/collections/sports","team/views/sport-list","usercontrol/dropdown/view/dropdown","sportorg/models/org","team/collections/seasonteams","component/forms","team/collections/complevels"],function(e,t,n){var r,s=e("facade"),o=e("views"),u=e("team/models/basics"),a=e("sportorg/models/org"),f=o.SectionView,l=e("team/views/sport-list"),c=e("team/collections/sports"),h=e("usercontrol/dropdown/view/dropdown"),p=e("team/collections/seasonteams"),d=e("team/collections/complevels"),v=e("component/forms"),m=e("utils"),g=m.lib.Channel,y=e("vendor"),b=y.Mustache,w=s.$,E=s._;return r=f.extend({template:t,selectSportTemplate:n,events:{"click #editTeamLink":"openEditPopup"},initialize:function(e){this.controllerObject=e.controllerObject,f.prototype.initialize.call(this,e),E.bindAll(this)},selectSport:function(e){self.select_sport=self.$("#select-sport");var t=this.select_sport.val()},updateHeaderData:function(e){var t=this;t.model.id!=e&&(t.model.id=e,t.model.fetch(),w.when(t.model.request).done(function(){t.render();var e=t.model.get("payload"),n=e.id,r=e.org_sport_link_obj.org.name;t.controllerObject.setupRosterView(n,r),t.controllerObject.showVote()}))},showAllTeamData:function(){routing.trigger("refresh-teampage",w("#sports-h").val(),w("#team-h").val(),this.season.id)},insertOption:function(e,t){var n="",r=t.length;for(var i=0;i<r;i++)n+='<option value="'+t[i].payload.sport_id+'">'+t[i].payload.sport_name+"</option>";e.html(n)},setupSportListView:function(){function r(){t.render(),e.$el.find("#sports-info").html(t.el);var n={payload:[]},r=t.collection;if(r.length){for(i=0;i<r.length;i++)n.payload[i]=r.at(i).get("payload");var s=b.to_html(e.selectSportTemplate,n);e.$el.find("#sports-info").prepend(s)}else e.$el.find("#sports-info").html("")}var e=this,t=new l({collection:this.sports}),n=this.addChildView(t);this.childViews.sportListView=t,this.callbacks.add(function(){n()}),g("teamsports:fetch").subscribe(r)},setOptions:function(e){if(!this.model)throw new Error("HeaderView expects option with model property.")},getName:function(){var e=this.model.get("payload").org_name;return this.model.get("payload").complevels_obj.complevel_name&&(e+=" | "+this.model.get("payload").complevels_obj.complevel_name),this.model.get("payload").org_sport_link_obj.sport.sport_name&&(e+=" | "+this.model.get("payload").org_sport_link_obj.sport.sport_name),this.model.get("payload").seasons_obj.season_name&&(e+=" | "+this.model.get("payload").seasons_obj.season_name),this.model.get("payload").year&&(e+=" | "+this.model.get("payload").year),e},openEditPopup:function(){if(!this.checkForUser()){routing.trigger("showSignup");return}var e={height:"500px",width:"500px",html:'<div id="editTeamForm"></div>',title:"Edit Organization Info"};routing.trigger("common-popup-open",e),this.drawEditTeamForm()},drawEditTeamForm:function(){var e=this,t=e.model.get("payload").org_sport_link_obj.org,n=t.locations,r=new v({orgname:{form_values:{defaultValue:t.name,post_to_server:!0,serverDbField:"name",serverKey:"name"},type:"Text",fieldClass:"",attr:{placeholder:"Event Name","class":"txt-org-name"},showLable:!0,label:"Organization Name"},Location:{form_values:{defaultValue:n.full_address,serverKey:"locations_id",post_to_server:!0,serverDbField:"locations_id"},longitude:n.lon,latitude:n.lat,locationId:n.id,type:"Location",label:"Location",validators:[{type:"required",message:'Please select location and click the "Verify Address" button'}]},users_id:{form_values:{serverKey:e.users_id,post_to_server:!0,value:e.user_id},type:"Hidden"},submit:{type:"Submit",fieldClass:"button-field",attr:{value:"Save Changes"},showLable:!1,onSubmit:function(n){var r=i.commit();if(r)for(var s in r){var o=w("*[name="+s+"]"),u=o.position();o.parents(".common-modal #modalBody").animate({scrollTop:u.top},"500",function(){o.addClass("focus-error-animation"),setTimeout(function(){o.removeClass("focus-error-animation")},2e3)});break}else{if(e.formValues)var f=e.formValues.getFormValues();else var f=i.getValue();var f=e.formValues.getFormValues(),l=e,c=new a({id:t.id});console.log(c),c.set({locations_id:f.locations_id,name:f.name}),c.save({}),w.when(c.request).done(function(t){e.updateHeaderData(l.model.id),routing.trigger("common-popup-close")}),w.when(c.request).fail(function(t){var n=JSON.parse(t.responseText),r=n.exec_data.error_array;e.formValues.showServersErrors(r)})}}},button:{type:"Button",fieldClass:"button-field",attr:{value:"Cancel","class":"cancel-btn"},onClick:function(){routing.trigger("common-popup-close")},showLable:!1}},w("#editTeamForm")),i=r.form;this.formValues=r.formValues},updateHeaderData:function(e){var t=this;t.model.id=e,t.model.fetch(),w.when(t.model.request).done(function(){t.render()})},childViews:{},render:function(e,t,n){document.title=this.getName(),f.prototype.render.call(this,e,t,n)}}),r});