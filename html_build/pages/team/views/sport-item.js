define(["vendor","views","utils","text!team/templates/sport-item.html","text!team/templates/complevel-select.html","team/collections/complevels","team/views/complevel-list"],function(e,t,n,r,s){var o,u=e.$,a=t.BaseView,f=e.Mustache,l=n.lib.Channel,c=require("team/views/complevel-list"),h=require("team/collections/complevels");return o=a.extend({tagName:"li",className:"sport",rendered:!1,events:{"change #select-complevel":"selectComplevel"},initialize:function(e){function n(){if(t.rendered){t.selectComplevel();return}t.rendered=!0,t.initList()}this.template=r,this.selectComplevelTemplate=s;var t=this;this.id=e.model.collection.id,l("teamsports:select"+this.model.get("payload").sport_id).subscribe(n)},initList:function(){var e=this;this.complevels=new h,this.complevels.id=this.id,this.complevels.sport_id=this.model.get("payload").sport_id,this.complevels.fetch();var t=this.complevels.sport_id;u.when(this.complevels.request).done(function(){e.setupComplevelListView(t),l("teamcomplevels"+t+":fetch").publish(),e.select_complevel=e.$("#select-complevel"),e.selectComplevel()})},setupComplevelListView:function(e){function r(){n.render(),t.$el.find(".complevels").html(n.el);var e={payload:[]},r=n.collection;if(r.length){for(i=0;i<r.length;i++)e.payload[i]=r.at(i).get("payload");var s=f.to_html(t.selectComplevelTemplate,e);t.$el.find(".complevels").prepend(s)}else t.$el.find(".complevels").html("")}var t=this,n=new c({collection:this.complevels});l("teamcomplevels"+e+":fetch").subscribe(r)},render:function(){var e=f.to_html(this.template,this.model.toJSON());return this.$el.html(e),this},selectComplevel:function(){var e=this.select_complevel.val(),t=this.model.get("payload").sport_id;this.$(".complevel-info").stop().slideUp(),this.$(".complevel-info-"+t+"-"+e).stop().slideDown(),l("teamcomplevels:select"+t+"-"+e).publish()}}),o});