define(["facade","utils/cookies","utils/debug"],function(e,t,n){function o(e){switch(e){case"cookie":t?e=t:n.log("cookie plugin not available.");break;case"localStorage":i.localstorage?e=localStorage:n.log("Modernizr.localstorage: "+i.localstorage);break;default:i.sessionstorage?e=sessionStorage:n.log("Modernizr.sessionstorage: "+i.sessionstorage)}return e}var r,i=e.Modernizr||window.Modernizr,s=e._;return r=function(e,t){var n;if(!e||!s.isString(e))throw new Error("Store expected {String} name argument.");this.setup(e,t),n=this.storage.getItem(this.name),this.data=n&&JSON.parse(n)||{}},r.prototype.storage=sessionStorage,r.prototype.setup=function(e,t){var r=["localStorage","sessionStorage","cookie"];this.name=e,s.contains(r,t)&&(this.storage=o(t)),this.storage||(this.storage=o("cookie"),n.log("Storage option: "+t+" not available, will try to use cookies."))},s.extend(r.prototype,{save:function(e){this.storage.setItem(this.name,JSON.stringify(this.data),e);try{}catch(t){console={},console.log=function(e){}}},create:function(e){return e.id||e.set(e.idAttribute,guid()),this.data[e.id]=e,this.save(),e},read:function(e){return e.id?this.find(e):this.findAll()},update:function(e){return this.data[e.id]=e,this.save(),e},destroy:function(e){return delete this.data[e.id],delete this.storage.removeItem(this.name),this.save(),e},find:function(e){return this.data[e.id]},findAll:function(){return s.values(this.data)},_S4:function(){return((1+Math.random())*65536|0).toString(16).substring(1)},_guid:function(){var e=this;return e._S4()+e._S4()+"-"+e._S4()+"-"+e._S4()+"-"+e._S4()+"-"+e._S4()+e._S4()+e._S4()}}),r});