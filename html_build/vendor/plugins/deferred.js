(function(e){var t=[].slice;e.Deferred=function(t){var n=e.Callbacks("once memory"),r=e.Callbacks("once memory"),i=e.Callbacks("memory"),s="pending",o={resolve:n,reject:r,notify:i},u={done:n.add,fail:r.add,progress:i.add,state:function(){return s},isResolved:n.fired,isRejected:r.fired,then:function(e,t,n){return a.done(e).fail(t).progress(n),this},always:function(){return a.done.apply(a,arguments).fail.apply(a,arguments),this},pipe:function(t,n,r){return e.Deferred(function(i){e.each({done:[t,"resolve"],fail:[n,"reject"],progress:[r,"notify"]},function(t,n){var r=n[0],s=n[1],o;e.isFunction(r)?a[t](function(){o=r.apply(this,arguments),o&&e.isFunction(o.promise)?o.promise().then(i.resolve,i.reject,i.notify):i[s+"With"](this===a?i:this,[o])}):a[t](i[s])})}).promise()},promise:function(e){if(e==null)e=u;else for(var t in u)e[t]=u[t];return e}},a=u.promise({}),f;for(f in o)a[f]=o[f].fire,a[f+"With"]=o[f].fireWith;return a.done(function(){s="resolved"},r.disable,i.lock).fail(function(){s="rejected"},n.disable,i.lock),t&&t.call(a,a),a},e.when=e.fn.when=function(n){function c(e){return function(n){r[e]=arguments.length>1?t.call(arguments,0):n,--u||f.resolveWith(f,r)}}function h(e){return function(n){o[e]=arguments.length>1?t.call(arguments,0):n,f.notifyWith(l,o)}}var r=t.call(arguments,0),i=0,s=r.length,o=new Array(s),u=s,a=s,f=s<=1&&n&&e.isFunction(n.promise)?n:e.Deferred(),l=f.promise();if(s>1){for(;i<s;i++)r[i]&&r[i].promise&&e.isFunction(r[i].promise)?r[i].promise().then(c(i),f.reject,h(i)):--u;u||f.resolveWith(f,r)}else f!==n&&f.resolveWith(f,s?[n]:[]);return l}})(Zepto);