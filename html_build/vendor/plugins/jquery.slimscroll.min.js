/*! Copyright (c) 2011 Piotr Rochala (http://rocha.la)
 * Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
 * and GPL (http://www.opensource.org/licenses/gpl-license.php) licenses.
 *
 * Version: 1.1.0
 *
 */

(function(e){jQuery.fn.extend({slimScroll:function(t){var n=e.extend({width:"auto",height:"250px",size:"7px",color:"#000",position:"right",distance:"1px",start:"top",opacity:.4,alwaysVisible:!1,disableFadeOut:!1,railVisible:!1,railColor:"#333",railOpacity:.2,railDraggable:!0,railClass:"slimScrollRail",barClass:"slimScrollBar",wrapperClass:"slimScrollDiv",allowPageScroll:!1,wheelStep:20,touchScrollStep:200},t);return this.each(function(){function r(t){if(h){t=t||window.event;var r=0;t.wheelDelta&&(r=-t.wheelDelta/120),t.detail&&(r=t.detail/3),e(t.target||t.srcTarget).closest("."+n.wrapperClass).is(S.parent())&&i(r,!0),t.preventDefault&&!E&&t.preventDefault(),E||(t.returnValue=!1)}}function i(e,t,r){var i=e,s=S.outerHeight()-T.outerHeight();t&&(i=parseInt(T.css("top"))+e*parseInt(n.wheelStep)/100*T.outerHeight(),i=Math.min(Math.max(i,0),s),i=0<e?Math.ceil(i):Math.floor(i),T.css({top:i+"px"})),y=parseInt(T.css("top"))/(S.outerHeight()-T.outerHeight()),i=y*(S[0].scrollHeight-S.outerHeight()),r&&(i=e,e=i/S[0].scrollHeight*S.outerHeight(),e=Math.min(Math.max(e,0),s),T.css({top:e+"px"})),S.scrollTop(i),S.trigger("slimscrolling",~~i),u(),c()}function s(){window.addEventListener?(this.addEventListener("DOMMouseScroll",r,!1),this.addEventListener("mousewheel",r,!1)):document.attachEvent("onmousewheel",r)}function o(){g=Math.max(S.outerHeight()/S[0].scrollHeight*S.outerHeight(),w),T.css({height:g+"px"});var e=g==S.outerHeight()?"none":"block";T.css({display:e})}function u(){o(),clearTimeout(v),y==~~y&&(E=n.allowPageScroll,b!=y&&S.trigger("slimscroll",0==~~y?"top":"bottom")),b=y,g>=S.outerHeight()?E=!0:(T.stop(!0,!0).fadeIn("fast"),n.railVisible&&N.stop(!0,!0).fadeIn("fast"))}function c(){n.alwaysVisible||(v=setTimeout(function(){(!n.disableFadeOut||!h)&&!p&&!d&&(T.fadeOut("slow"),N.fadeOut("slow"))},1e3))}var h,p,d,v,m,g,y,b,w=30,E=!1,S=e(this);if(S.parent().hasClass(n.wrapperClass)){var x=S.scrollTop(),T=S.parent().find("."+n.barClass),N=S.parent().find("."+n.railClass);o();if(e.isPlainObject(t)){if("scrollTo"in t)x=parseInt(n.scrollTo);else if("scrollBy"in t)x+=parseInt(n.scrollBy);else if("destroy"in t){T.remove(),N.remove(),S.unwrap();return}i(x,!1,!0)}}else{n.height="auto"==n.height?S.parent().innerHeight():n.height,x=e("<div></div>").addClass(n.wrapperClass).css({position:"relative",overflow:"hidden",width:n.width,height:n.height}),S.css({overflow:"hidden",width:n.width,height:n.height});var N=e("<div></div>").addClass(n.railClass).css({width:n.size,height:"100%",position:"absolute",top:0,display:n.alwaysVisible&&n.railVisible?"block":"none","border-radius":n.size,background:n.railColor,opacity:n.railOpacity,zIndex:90}),T=e("<div></div>").addClass(n.barClass).css({background:n.color,width:n.size,position:"absolute",top:0,opacity:n.opacity,display:n.alwaysVisible?"block":"none","border-radius":n.size,BorderRadius:n.size,MozBorderRadius:n.size,WebkitBorderRadius:n.size,zIndex:99}),C="right"==n.position?{right:n.distance}:{left:n.distance};N.css(C),T.css(C),S.wrap(x),S.parent().append(T),S.parent().append(N),n.railDraggable&&T.draggable({axis:"y",containment:"parent",start:function(){d=!0},stop:function(){d=!1,c()},drag:function(){i(0,e(this).position().top,!1)}}),N.hover(function(){u()},function(){c()}),T.hover(function(){p=!0},function(){p=!1}),S.hover(function(){h=!0,u(),c()},function(){h=!1,c()}),S.bind("touchstart",function(e){e.originalEvent.touches.length&&(m=e.originalEvent.touches[0].pageY)}),S.bind("touchmove",function(e){e.originalEvent.preventDefault(),e.originalEvent.touches.length&&i((m-e.originalEvent.touches[0].pageY)/n.touchScrollStep,!0)}),"bottom"===n.start?(T.css({top:S.outerHeight()-T.outerHeight()}),i(0,!0)):"top"!==n.start&&(i(e(n.start).position().top,null,!0),n.alwaysVisible||T.hide()),s(),o()}}),this}}),jQuery.fn.extend({slimscroll:jQuery.fn.slimScroll})})(jQuery);