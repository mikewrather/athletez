/**
 * mOxie - multi-runtime File API & XMLHttpRequest L2 Polyfill
 * v1.0.0alpha
 *
 * Copyright 2013, Moxiecode Systems AB
 * Released under GPL License.
 *
 * License: http://www.plupload.com/license
 * Contributing: http://www.plupload.com/contributing
 *
 * Date: 2012-11-13
 */

/**
 * Basic.js
 *
 * Copyright 2013, Moxiecode Systems AB
 * Released under GPL License.
 *
 * License: http://www.plupload.com/license
 * Contributing: http://www.plupload.com/contributing
 */

/**
 * I18n.js
 *
 * Copyright 2013, Moxiecode Systems AB
 * Released under GPL License.
 *
 * License: http://www.plupload.com/license
 * Contributing: http://www.plupload.com/contributing
 */

/**
 * Mime.js
 *
 * Copyright 2013, Moxiecode Systems AB
 * Released under GPL License.
 *
 * License: http://www.plupload.com/license
 * Contributing: http://www.plupload.com/contributing
 */

/**
 * Env.js
 *
 * Copyright 2013, Moxiecode Systems AB
 * Released under GPL License.
 *
 * License: http://www.plupload.com/license
 * Contributing: http://www.plupload.com/contributing
 */

/**
 * Dom.js
 *
 * Copyright 2013, Moxiecode Systems AB
 * Released under GPL License.
 *
 * License: http://www.plupload.com/license
 * Contributing: http://www.plupload.com/contributing
 */

/**
 * Exceptions.js
 *
 * Copyright 2013, Moxiecode Systems AB
 * Released under GPL License.
 *
 * License: http://www.plupload.com/license
 * Contributing: http://www.plupload.com/contributing
 */

/**
 * EventTarget.js
 *
 * Copyright 2013, Moxiecode Systems AB
 * Released under GPL License.
 *
 * License: http://www.plupload.com/license
 * Contributing: http://www.plupload.com/contributing
 */

/**
 * Encode.js
 *
 * Copyright 2013, Moxiecode Systems AB
 * Released under GPL License.
 *
 * License: http://www.plupload.com/license
 * Contributing: http://www.plupload.com/contributing
 */

/**
 * Runtime.js
 *
 * Copyright 2013, Moxiecode Systems AB
 * Released under GPL License.
 *
 * License: http://www.plupload.com/license
 * Contributing: http://www.plupload.com/contributing
 */

/**
 * RuntimeClient.js
 *
 * Copyright 2013, Moxiecode Systems AB
 * Released under GPL License.
 *
 * License: http://www.plupload.com/license
 * Contributing: http://www.plupload.com/contributing
 */

/**
 * Blob.js
 *
 * Copyright 2013, Moxiecode Systems AB
 * Released under GPL License.
 *
 * License: http://www.plupload.com/license
 * Contributing: http://www.plupload.com/contributing
 */

/**
 * File.js
 *
 * Copyright 2013, Moxiecode Systems AB
 * Released under GPL License.
 *
 * License: http://www.plupload.com/license
 * Contributing: http://www.plupload.com/contributing
 */

/**
 * FileInput.js
 *
 * Copyright 2013, Moxiecode Systems AB
 * Released under GPL License.
 *
 * License: http://www.plupload.com/license
 * Contributing: http://www.plupload.com/contributing
 */

/**
 * FileDrop.js
 *
 * Copyright 2013, Moxiecode Systems AB
 * Released under GPL License.
 *
 * License: http://www.plupload.com/license
 * Contributing: http://www.plupload.com/contributing
 */

/**
 * RuntimeTarget.js
 *
 * Copyright 2013, Moxiecode Systems AB
 * Released under GPL License.
 *
 * License: http://www.plupload.com/license
 * Contributing: http://www.plupload.com/contributing
 */

/**
 * FileReader.js
 *
 * Copyright 2013, Moxiecode Systems AB
 * Released under GPL License.
 *
 * License: http://www.plupload.com/license
 * Contributing: http://www.plupload.com/contributing
 */

/**
 * Url.js
 *
 * Copyright 2013, Moxiecode Systems AB
 * Released under GPL License.
 *
 * License: http://www.plupload.com/license
 * Contributing: http://www.plupload.com/contributing
 */

/**
 * FileReaderSync.js
 *
 * Copyright 2013, Moxiecode Systems AB
 * Released under GPL License.
 *
 * License: http://www.plupload.com/license
 * Contributing: http://www.plupload.com/contributing
 */

/**
 * FormData.js
 *
 * Copyright 2013, Moxiecode Systems AB
 * Released under GPL License.
 *
 * License: http://www.plupload.com/license
 * Contributing: http://www.plupload.com/contributing
 */

/**
 * XMLHttpRequest.js
 *
 * Copyright 2013, Moxiecode Systems AB
 * Released under GPL License.
 *
 * License: http://www.plupload.com/license
 * Contributing: http://www.plupload.com/contributing
 */

/**
 * Transporter.js
 *
 * Copyright 2013, Moxiecode Systems AB
 * Released under GPL License.
 *
 * License: http://www.plupload.com/license
 * Contributing: http://www.plupload.com/contributing
 */

/**
 * JSON.js
 *
 * Copyright 2013, Moxiecode Systems AB
 * Released under GPL License.
 *
 * License: http://www.plupload.com/license
 * Contributing: http://www.plupload.com/contributing
 */

/**
 * Image.js
 *
 * Copyright 2013, Moxiecode Systems AB
 * Released under GPL License.
 *
 * License: http://www.plupload.com/license
 * Contributing: http://www.plupload.com/contributing
 */

/**
 * Events.js
 *
 * Copyright 2013, Moxiecode Systems AB
 * Released under GPL License.
 *
 * License: http://www.plupload.com/license
 * Contributing: http://www.plupload.com/contributing
 */

/**
 * BinaryReader.js
 *
 * Copyright 2013, Moxiecode Systems AB
 * Released under GPL License.
 *
 * License: http://www.plupload.com/license
 * Contributing: http://www.plupload.com/contributing
 */

/**
 * JPEGHeaders.js
 *
 * Copyright 2013, Moxiecode Systems AB
 * Released under GPL License.
 *
 * License: http://www.plupload.com/license
 * Contributing: http://www.plupload.com/contributing
 */

/**
 * ExifParser.js
 *
 * Copyright 2013, Moxiecode Systems AB
 * Released under GPL License.
 *
 * License: http://www.plupload.com/license
 * Contributing: http://www.plupload.com/contributing
 */

/**
 * JPEG.js
 *
 * Copyright 2013, Moxiecode Systems AB
 * Released under GPL License.
 *
 * License: http://www.plupload.com/license
 * Contributing: http://www.plupload.com/contributing
 */

/**
 * PNG.js
 *
 * Copyright 2013, Moxiecode Systems AB
 * Released under GPL License.
 *
 * License: http://www.plupload.com/license
 * Contributing: http://www.plupload.com/contributing
 */

/**
 * ImageInfo.js
 *
 * Copyright 2013, Moxiecode Systems AB
 * Released under GPL License.
 *
 * License: http://www.plupload.com/license
 * Contributing: http://www.plupload.com/contributing
 */

/**
(The MIT License)

Copyright (c) 2012 Shinichi Tomita <shinichi.tomita@gmail.com>;

Permission is hereby granted, free of charge, to any person obtaining
a copy of this software and associated documentation files (the
'Software'), to deal in the Software without restriction, including
without limitation the rights to use, copy, modify, merge, publish,
distribute, sublicense, and/or sell copies of the Software, and to
permit persons to whom the Software is furnished to do so, subject to
the following conditions:

The above copyright notice and this permission notice shall be
included in all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED 'AS IS', WITHOUT WARRANTY OF ANY KIND,
EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.
IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY
CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT,
TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE
SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
*/

/**
 * Mega pixel image rendering library for iOS6 Safari
 *
 * Fixes iOS6 Safari's image file rendering issue for large size image (over mega-pixel),
 * which causes unexpected subsampling when drawing it in canvas.
 * By using this library, you can safely render the image with proper stretching.
 *
 * Copyright (c) 2012 Shinichi Tomita <shinichi.tomita@gmail.com>
 * Released under the MIT license
 */

/**
 * RunTime.js
 *
 * Copyright 2013, Moxiecode Systems AB
 * Released under GPL License.
 *
 * License: http://www.plupload.com/license
 * Contributing: http://www.plupload.com/contributing
 */

/**
 * o.js
 *
 * Copyright 2013, Moxiecode Systems AB
 * Released under GPL License.
 *
 * License: http://www.plupload.com/license
 * Contributing: http://www.plupload.com/contributing
 */

(function(e,t){function r(e,t){var r,i=[];for(var s=0;s<e.length;++s){r=n[e[s]]||o(e[s]);if(!r)throw"module definition dependecy not found: "+e[s];i.push(r)}t.apply(null,i)}function i(e,i,s){if(typeof e!="string")throw"invalid module definition, module id must be defined and be a string";if(i===t)throw"invalid module definition, dependencies must be specified";if(s===t)throw"invalid module definition, definition function must be specified";r(i,function(){n[e]=s.apply(null,arguments)})}function s(e){return!!n[e]}function o(t){var n=e,r=t.split(/[.\/]/);for(var i=0;i<r.length;++i){if(!n[r[i]])return;n=n[r[i]]}return n}function u(r){for(var i=0;i<r.length;i++){var s=e,o=r[i],u=o.split(/[.\/]/);for(var a=0;a<u.length-1;++a)s[u[a]]===t&&(s[u[a]]={}),s=s[u[a]];s[u[u.length-1]]=n[o]}}var n={};i("moxie/core/utils/Basic",[],function(){var e=function(e){var t;return e===t?"undefined":e===null?"null":e.nodeType?"node":{}.toString.call(e).match(/\s([a-z|A-Z]+)/)[1].toLowerCase()},t=function(r){var i;return n(arguments,function(o,u){u>0&&n(o,function(n,o){n!==i&&(e(r[o])!==e(n)||!~s(e(n),["array","object"])?r[o]=n:t(r[o],n))})}),r},n=function(e,t){var n,r,i,s;if(e){try{n=e.length}catch(o){n=s}if(n===s){for(r in e)if(e.hasOwnProperty(r)&&t(e[r],r)===!1)return}else for(i=0;i<n;i++)if(t(e[i],i)===!1)return}},r=function(t){var n;if(!t||e(t)!=="object")return!0;for(n in t)return!1;return!0},i=function(t,n){function s(r){e(t[r])==="function"&&t[r](function(e){++r<i&&!e?s(r):n(e)})}var r=0,i=t.length;e(n)!=="function"&&(n=function(){}),(!t||!t.length)&&n(),s(r)},s=function(e,t){if(t){if(Array.prototype.indexOf)return Array.prototype.indexOf.call(t,e);for(var n=0,r=t.length;n<r;n++)if(t[n]===e)return n}return-1},o=function(t,n){var r=[];e(t)!=="array"&&(t=[t]),e(n)!=="array"&&(n=[n]);for(var i in t)s(t[i],n)===-1&&r.push(t[i]);return r.length?r:!1},u=function(e,t){var r=[];return n(e,function(e){s(e,t)!==-1&&r.push(e)}),r.length?r:null},a=function(e){var t,n=[];for(t=0;t<e.length;t++)n[t]=e[t];return n},f=function(){var e=0;return function(t){var n=(new Date).getTime().toString(32),r;for(r=0;r<5;r++)n+=Math.floor(Math.random()*65535).toString(32);return(t||"o_")+n+(e++).toString(32)}}(),l=function(e){return e?String.prototype.trim?String.prototype.trim.call(e):e.toString().replace(/^\s*/,"").replace(/\s*$/,""):e},c=function(e){if(typeof e!="string")return e;var t={t:1099511627776,g:1073741824,m:1048576,k:1024},n;return e=/^([0-9]+)([mgk]?)$/.exec(e.toLowerCase().replace(/[^0-9mkg]/g,"")),n=e[2],e=+e[1],t.hasOwnProperty(n)&&(e*=t[n]),e};return{guid:f,typeOf:e,extend:t,each:n,isEmptyObj:r,inSeries:i,inArray:s,arrayDiff:o,arrayIntersect:u,toArray:a,trim:l,parseSizeStr:c}}),i("moxie/core/I18n",["moxie/core/utils/Basic"],function(e){var t={};return{addI18n:function(n){return e.extend(t,n)},translate:function(e){return t[e]||e},_:function(e){return this.translate(e)},sprintf:function(t){var n=[].slice.call(arguments,1),r="";return e.each(t.split(/%[a-z]/),function(e){r+=e,n.length&&(r+=n.shift())}),r}}}),i("moxie/core/utils/Mime",["moxie/core/utils/Basic","moxie/core/I18n"],function(e,t){var n="application/msword,doc dot,application/pdf,pdf,application/pgp-signature,pgp,application/postscript,ps ai eps,application/rtf,rtf,application/vnd.ms-excel,xls xlb,application/vnd.ms-powerpoint,ppt pps pot,application/zip,zip,application/x-shockwave-flash,swf swfl,application/vnd.openxmlformats-officedocument.wordprocessingml.document,docx,application/vnd.openxmlformats-officedocument.wordprocessingml.template,dotx,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,xlsx,application/vnd.openxmlformats-officedocument.presentationml.presentation,pptx,application/vnd.openxmlformats-officedocument.presentationml.template,potx,application/vnd.openxmlformats-officedocument.presentationml.slideshow,ppsx,application/x-javascript,js,application/json,json,audio/mpeg,mp3 mpga mpega mp2,audio/x-wav,wav,audio/mp4,m4a,audio/ogg,oga ogg,audio/aiff,aiff aif,audio/flac,flac,audio/aac,aac,audio/ac3,ac3,audio/x-ms-wma,wma,image/bmp,bmp,image/gif,gif,image/jpeg,jpg jpeg jpe,image/photoshop,psd,image/png,png,image/svg+xml,svg svgz,image/tiff,tiff tif,text/plain,asc txt text diff log,text/html,htm html xhtml,text/css,css,text/csv,csv,text/rtf,rtf,video/mpeg,mpeg mpg mpe m2v,video/quicktime,qt mov,video/mp4,mp4,video/x-m4v,m4v,video/x-flv,flv,video/x-ms-wmv,wmv,video/avi,avi,video/webm,webm,video/3gpp,3gpp 3gp,video/3gpp2,3g2,video/vnd.rn-realvideo,rv,video/ogg,ogv,video/x-matroska,mkv,application/vnd.oasis.opendocument.formula-template,otf,application/octet-stream,exe",r={mimes:{},extensions:{},addMimeType:function(e){var t=e.split(/,/),n,r,i;for(n=0;n<t.length;n+=2){i=t[n+1].split(/ /);for(r=0;r<i.length;r++)this.mimes[i[r]]=t[n];this.extensions[t[n]]=i}},extList2mimes:function(t,n){var r=this,i,s,o,u,a=[];for(s=0;s<t.length;s++){i=t[s].extensions.split(/\s*,\s*/);for(o=0;o<i.length;o++){if(i[o]==="*")return[];u=r.mimes[i[o]];if(!u){if(!n||!/^\w+$/.test(i[o]))return[];a.push("."+i[o])}else e.inArray(u,a)===-1&&a.push(u)}}return a},mimes2extList:function(n){var r=this,i=[],s=[];return n=e.trim(n).split(/\s*,\s*/),n!=="*"&&e.each(n,function(t){var n=t.match(/^(\w+)\/(\*|\w+)$/);n&&(n[2]==="*"?e.each(r.extensions,function(e,t){(new RegExp("^"+n[1]+"/")).test(t)&&[].push.apply(i,r.extensions[t])}):r.extensions[t]&&[].push.apply(i,r.extensions[t]))}),s.push({title:t.translate("Files"),extensions:i.length?i.join(","):"*"}),s.mimes=n,s},getFileExtension:function(e){var t=e&&e.match(/\.([^.]+)$/);return t?t[1].toLowerCase():""},getFileMime:function(e){return this.mimes[this.getFileExtension(e)]||""}};return r.addMimeType(n),r}),i("moxie/core/utils/Env",["moxie/core/utils/Basic"],function(e){function i(e){var t,n;for(var i=0;i<e.length;i++){t=e[i].s1,n=e[i].prop,r=e[i].sv||e[i].id;if(t){if(t.indexOf(e[i].s2)!=-1)return e[i].id}else if(n)return e[i].id}}function s(e){var t=e.indexOf(r);if(t==-1)return;return parseFloat(e.substring(t+r.length+1))}var t=[{s1:navigator.userAgent,s2:"Android",id:"Android Browser",sv:"Version"},{s1:navigator.userAgent,s2:"Chrome",id:"Chrome"},{s1:navigator.vendor,s2:"Apple",id:"Safari",sv:"Version"},{prop:window.opera&&window.opera.buildNumber,id:"Opera",sv:"Version"},{s1:navigator.vendor,s2:"KDE",id:"Konqueror"},{s1:navigator.userAgent,s2:"Firefox",id:"Firefox"},{s1:navigator.vendor,s2:"Camino",id:"Camino"},{s1:navigator.userAgent,s2:"Netscape",id:"Netscape"},{s1:navigator.userAgent,s2:"MSIE",id:"IE",sv:"MSIE"},{s1:navigator.userAgent,s2:"Gecko",id:"Mozilla",sv:"rv"}],n=[{s1:navigator.platform,s2:"Win",id:"Windows"},{s1:navigator.platform,s2:"Mac",id:"Mac"},{s1:navigator.userAgent,s2:"iPhone",id:"iOS"},{s1:navigator.userAgent,s2:"iPad",id:"iOS"},{s1:navigator.userAgent,s2:"Android",id:"Android"},{s1:navigator.platform,s2:"Linux",id:"Linux"}],r,o=function(){var t={define_property:function(){return!1}(),create_canvas:function(){var e=document.createElement("canvas");return!!e.getContext&&!!e.getContext("2d")}(),return_response_type:function(t){try{if(e.inArray(t,["","text","document"])!==-1)return!0;if(window.XMLHttpRequest){var n=new XMLHttpRequest;n.open("get","/");if("responseType"in n)return n.responseType=t,n.responseType!==t?!1:!0}}catch(r){}return!1},use_data_uri:function(){var e=new Image;return e.onload=function(){t.use_data_uri=e.width===1&&e.height===1},setTimeout(function(){e.src="data:image/gif;base64,R0lGODlhAQABAIAAAP8AAAAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw=="},1),!1}(),use_data_uri_over32kb:function(){return t.use_data_uri&&(u.browser!=="IE"||u.version>=9)},use_data_uri_of:function(e){return t.use_data_uri&&e<33e3||t.use_data_uri_over32kb()},use_fileinput:function(){var e=document.createElement("input");return e.setAttribute("type","file"),!e.disabled}};return function(n){var r=[].slice.call(arguments);return r.shift(),e.typeOf(t[n])==="function"?t[n].apply(this,r):!!t[n]}}(),u={can:o,browser:i(t),version:s(navigator.userAgent)||s(navigator.appVersion),OS:i(n),swf_url:"../flash/Moxie.swf",xap_url:"../silverlight/Moxie.xap",global_event_dispatcher:"moxie.core.EventTarget.instance.dispatchEvent"};return u}),i("moxie/core/utils/Dom",["moxie/core/utils/Env"],function(e){var t=function(e){return typeof e!="string"?e:document.getElementById(e)},n=function(e,t){var n;return e.className===""?!1:(n=new RegExp("(^|\\s+)"+t+"(\\s+|$)"),n.test(e.className))},r=function(e,t){n(e,t)||(e.className=e.className===""?t:e.className.replace(/\s+$/,"")+" "+t)},i=function(e,t){var n=new RegExp("(^|\\s+)"+t+"(\\s+|$)");e.className=e.className.replace(n,function(e,t,n){return t===" "&&n===" "?" ":""})},s=function(e,t){if(e.currentStyle)return e.currentStyle[t];if(window.getComputedStyle)return window.getComputedStyle(e,null)[t]},o=function(t,n){function f(e){var t,n,r=0,i=0;return e&&(n=e.getBoundingClientRect(),t=o.compatMode==="CSS1Compat"?o.documentElement:o.body,r=n.left+t.scrollLeft,i=n.top+t.scrollTop),{x:r,y:i}}var r=0,i=0,s,o=document,u,a;t=t,n=n||o.body;if(t&&t.getBoundingClientRect&&e.browser==="IE"&&(!o.documentMode||o.documentMode<8))return u=f(t),a=f(n),{x:u.x-a.x,y:u.y-a.y};s=t;while(s&&s!=n&&s.nodeType)r+=s.offsetLeft||0,i+=s.offsetTop||0,s=s.offsetParent;s=t.parentNode;while(s&&s!=n&&s.nodeType)r-=s.scrollLeft||0,i-=s.scrollTop||0,s=s.parentNode;return{x:r,y:i}},u=function(e){return{w:e.offsetWidth||e.clientWidth,h:e.offsetHeight||e.clientHeight}};return{get:t,hasClass:n,addClass:r,removeClass:i,getStyle:s,getPos:o,getSize:u}}),i("moxie/core/Exceptions",["moxie/core/utils/Basic"],function(e){function t(e,t){var n;for(n in e)if(e[n]===t)return n;return null}return{RuntimeError:function(){function r(e){this.code=e,this.name=t(n,e),this.message=this.name+": RuntimeError "+this.code}var n={NOT_INIT_ERR:1,NOT_SUPPORTED_ERR:9,JS_ERR:4};return e.extend(r,n),r.prototype=Error.prototype,r}(),OperationNotAllowedException:function(){function t(e){this.code=e,this.name="OperationNotAllowedException"}return e.extend(t,{NOT_ALLOWED_ERR:1}),t.prototype=Error.prototype,t}(),ImageError:function(){function r(e){this.code=e,this.name=t(n,e),this.message=this.name+": ImageError "+this.code}var n={WRONG_FORMAT:1,MAX_RESOLUTION_ERR:2};return e.extend(r,n),r.prototype=Error.prototype,r}(),FileException:function(){function r(e){this.code=e,this.name=t(n,e),this.message=this.name+": FileException "+this.code}var n={NOT_FOUND_ERR:1,SECURITY_ERR:2,ABORT_ERR:3,NOT_READABLE_ERR:4,ENCODING_ERR:5,NO_MODIFICATION_ALLOWED_ERR:6,INVALID_STATE_ERR:7,SYNTAX_ERR:8};return e.extend(r,n),r.prototype=Error.prototype,r}(),DOMException:function(){function r(e){this.code=e,this.name=t(n,e),this.message=this.name+": DOMException "+this.code}var n={INDEX_SIZE_ERR:1,DOMSTRING_SIZE_ERR:2,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,INVALID_CHARACTER_ERR:5,NO_DATA_ALLOWED_ERR:6,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INUSE_ATTRIBUTE_ERR:10,INVALID_STATE_ERR:11,SYNTAX_ERR:12,INVALID_MODIFICATION_ERR:13,NAMESPACE_ERR:14,INVALID_ACCESS_ERR:15,VALIDATION_ERR:16,TYPE_MISMATCH_ERR:17,SECURITY_ERR:18,NETWORK_ERR:19,ABORT_ERR:20,URL_MISMATCH_ERR:21,QUOTA_EXCEEDED_ERR:22,TIMEOUT_ERR:23,INVALID_NODE_TYPE_ERR:24,DATA_CLONE_ERR:25};return e.extend(r,n),r.prototype=Error.prototype,r}(),EventException:function(){function t(e){this.code=e,this.name="EventException"}return e.extend(t,{UNSPECIFIED_EVENT_TYPE_ERR:0}),t.prototype=Error.prototype,t}()}}),i("moxie/core/EventTarget",["moxie/core/Exceptions","moxie/core/utils/Basic"],function(e,t){function n(){var n={};t.extend(this,{uid:null,init:function(){this.uid||(this.uid=t.guid("uid_"))},addEventListener:function(e,r,i,s){var o=this,u;e=t.trim(e);if(/\s/.test(e)){t.each(e.split(/\s+/),function(e){o.addEventListener(e,r,i,s)});return}e=e.toLowerCase(),i=parseInt(i,10)||0,u=n[this.uid]&&n[this.uid][e]||[],u.push({fn:r,priority:i,scope:s||this}),n[this.uid]||(n[this.uid]={}),n[this.uid][e]=u},hasEventListener:function(e){return e?!!n[this.uid]&&!!n[this.uid][e]:!!n[this.uid]},removeEventListener:function(e,r){e=e.toLowerCase();var i=n[this.uid]&&n[this.uid][e],s;if(i){if(r){for(s=i.length-1;s>=0;s--)if(i[s].fn===r){i.splice(s,1);break}}else i=[];i.length||(delete n[this.uid][e],t.isEmptyObj(n[this.uid])&&delete n[this.uid])}},removeAllEventListeners:function(){n[this.uid]&&delete n[this.uid]},dispatchEvent:function(r){var i,s,o,u,a={};if(t.typeOf(r)!=="string"){u=r;if(t.typeOf(u.type)!=="string")throw new e.EventException(e.EventException.UNSPECIFIED_EVENT_TYPE_ERR);r=u.type,u.total&&u.loaded&&(a.total=u.total,a.loaded=u.loaded),a.async=u.async||!1}r.indexOf("::")!==-1?function(e){i=e[0],r=e[1]}(r.split("::")):i=this.uid,r=r.toLowerCase(),s=n[i]&&n[i][r];if(s){s.sort(function(e,t){return t.priority-e.priority}),o=[].slice.call(arguments),o.shift(),a.type=r,o.unshift(a);var f=[];t.each(s,function(e){o[0].target=e.scope,a.async?f.push(function(t){setTimeout(function(){t(e.fn.apply(e.scope,o)===!1)},1)}):f.push(function(t){t(e.fn.apply(e.scope,o)===!1)})}),f.length&&t.inSeries(f)}return!0},bind:function(){this.addEventListener.apply(this,arguments)},unbind:function(){this.removeEventListener.apply(this,arguments)},unbindAll:function(){this.removeAllEventListeners.apply(this,arguments)},trigger:function(){this.dispatchEvent.apply(this,arguments)},convertEventPropsToHandlers:function(e){var n;t.typeOf(e)!=="array"&&(e=[e]);for(var r=0;r<e.length;r++)n="on"+e[r],t.typeOf(this[n])==="function"?this.addEventListener(e[r],this[n]):t.typeOf(this[n])==="undefined"&&(this[n]=null)}})}return n.instance=new n,n}),i("moxie/core/utils/Encode",[],function(){var e=function(e){return unescape(encodeURIComponent(e))},t=function(e){return decodeURIComponent(escape(e))},n=function(e,n){if(typeof window.atob=="function")return n?t(window.atob(e)):window.atob(e);var r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",i,s,o,u,a,f,l,c,h=0,p=0,d="",v=[];if(!e)return e;e+="";do u=r.indexOf(e.charAt(h++)),a=r.indexOf(e.charAt(h++)),f=r.indexOf(e.charAt(h++)),l=r.indexOf(e.charAt(h++)),c=u<<18|a<<12|f<<6|l,i=c>>16&255,s=c>>8&255,o=c&255,f==64?v[p++]=String.fromCharCode(i):l==64?v[p++]=String.fromCharCode(i,s):v[p++]=String.fromCharCode(i,s,o);while(h<e.length);return d=v.join(""),n?t(d):d},r=function(t,n){n&&e(t);if(typeof window.btoa=="function")return window.btoa(t);var r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",i,s,o,u,a,f,l,c,h=0,p=0,d="",v=[];if(!t)return t;do i=t.charCodeAt(h++),s=t.charCodeAt(h++),o=t.charCodeAt(h++),c=i<<16|s<<8|o,u=c>>18&63,a=c>>12&63,f=c>>6&63,l=c&63,v[p++]=r.charAt(u)+r.charAt(a)+r.charAt(f)+r.charAt(l);while(h<t.length);d=v.join("");var m=t.length%3;return(m?d.slice(0,m-3):d)+"===".slice(m||3)};return{utf8_encode:e,utf8_decode:t,atob:n,btoa:r}}),i("moxie/runtime/Runtime",["moxie/core/utils/Basic","moxie/core/utils/Dom","moxie/core/EventTarget"],function(e,t,n){function s(n,r,o,u,a){function h(t,r){var i=null,s=n&&n.required_caps;r=r||"browser";if(this.mode!==null)return this.mode;s&&!e.isEmptyObj(t)&&(e.each(s,function(n,r){if(t.hasOwnProperty(r)){var s=t[r](n);typeof s=="string"&&(s=[s]);if(!i)i=s;else if(!(i=e.arrayIntersect(i,s)))return i=!1}}),i?this.mode=e.inArray(r,i)!==-1?r:i[0]:i===!1&&(this.mode=!1)),this.mode===null&&(this.mode=r),this.mode&&s&&!this.can(s)&&(this.mode=!1)}var f=this,l,c=e.guid(r+"_");i[c]=this,o=e.extend({access_binary:!1,access_image_binary:!1,display_media:!1,do_cors:!1,drag_and_drop:!1,filter_by_extension:!0,resize_image:!1,report_upload_progress:!1,return_response_headers:!1,return_response_type:!1,return_status_code:!0,send_custom_headers:!1,select_file:!1,select_folder:!1,select_multiple:!0,send_binary_string:!1,send_browser_cookies:!0,send_multipart:!0,slice_blob:!1,stream_upload:!1,summon_file_dialog:!1,upload_filesize:!0,use_http_method:!0},o),l=function(){var t={};return{exec:function(e,n,r,i){if(l[n]){t[e]||(t[e]={context:this,instance:new l[n]});if(t[e].instance[r])return t[e].instance[r].apply(this,i)}},removeInstance:function(e){delete t[e]},removeAllInstances:function(){var n=this;e.each(t,function(t,r){e.typeOf(t.instance.destroy)==="function"&&t.instance.destroy.call(t.context),n.removeInstance(r)})}}}(),e.extend(this,{initialized:!1,uid:c,type:r,mode:null,shimid:c+"_container",clients:0,options:n,can:function(t,n){var r=arguments[2]||o;e.typeOf(t)==="string"&&e.typeOf(n)==="undefined"&&(t=s.parseCaps(t));if(e.typeOf(t)==="object"){for(var i in t)if(!this.can(i,t[i],r))return!1;return!0}return e.typeOf(r[t])==="function"?r[t].call(this,n):n===r[t]},getShimContainer:function(){var n,r=t.get(this.shimid);return r||(n=this.options.container?t.get(this.options.container):document.body,r=document.createElement("div"),r.id=this.shimid,r.className="moxie-shim moxie-shim-"+this.type,e.extend(r.style,{position:"absolute",top:"0px",left:"0px",width:"1px",height:"1px",overflow:"hidden"}),n.appendChild(r),n=null),r},getShim:function(){return l},shimExec:function(e,t){var n=[].slice.call(arguments,2);return f.getShim().exec.call(this,this.uid,e,t,n)},exec:function(e,t){var n=[].slice.call(arguments,2);return f[e]&&f[e][t]?f[e][t].apply(this,n):f.shimExec.apply(this,arguments)},destroy:function(){if(!f)return;var e=t.get(this.shimid);e&&e.parentNode.removeChild(e),l&&l.removeAllInstances(),this.unbindAll(),delete i[this.uid],this.uid=null,c=f=l=e=null}}),h.call(this,u,a)}var r={},i={};return s.order="html5,flash,silverlight,html4",s.getRuntime=function(e){return i[e]?i[e]:!1},s.addConstructor=function(e,t){t.prototype=n.instance,r[e]=t},s.getConstructor=function(e){return r[e]||null},s.getInfo=function(e){var t=s.getRuntime(e);return t?{uid:t.uid,type:t.type,can:function(){return t.can.apply(t,arguments)}}:null},s.parseCaps=function(t){var n={};return e.typeOf(t)!=="string"?t||{}:(e.each(t.split(","),function(e){n[e]=!0}),n)},s.can=function(e,t){var n,r=s.getConstructor(e),i;return r?(n=new r({required_caps:t}),i=n.mode,n.destroy(),!!i):!1},s.thatCan=function(e,t){var n=(t||s.order).split(/\s*,\s*/);for(var r in n)if(s.can(n[r],e))return n[r];return null},s.capTrue=function(){return!0},s.capFalse=function(){return!1},s.capTest=function(e){return function(){return!!e}},s}),i("moxie/runtime/RuntimeClient",["moxie/core/Exceptions","moxie/core/utils/Basic","moxie/runtime/Runtime"],function(e,t,n){return function(){var i;t.extend(this,{connectRuntime:function(r){function u(t){var o,a;if(!t.length){s.trigger("RuntimeError",new e.RuntimeError(e.RuntimeError.NOT_INIT_ERR)),i=null;return}o=t.shift(),a=n.getConstructor(o);if(!a){u(t);return}i=new a(r),i.bind("Init",function(){i.initialized=!0,setTimeout(function(){i.clients++,s.trigger("RuntimeInit",i)},1)}),i.bind("Error",function(){i.destroy(),u(t)});if(!i.mode){i.trigger("Error");return}i.init()}var s=this,o;t.typeOf(r)==="string"?o=r:t.typeOf(r.ruid)==="string"&&(o=r.ruid);if(o){i=n.getRuntime(o);if(i)return i.clients++,i;throw new e.RuntimeError(e.RuntimeError.NOT_INIT_ERR)}u((r.runtime_order||n.order).split(/\s*,\s*/))},getRuntime:function(){return i&&i.uid?i:(i=null,null)},disconnectRuntime:function(){i&&--i.clients<=0&&(i.destroy(),i=null)}})}}),i("moxie/file/Blob",["moxie/core/utils/Basic","moxie/core/utils/Encode","moxie/runtime/RuntimeClient"],function(e,t,n){function i(s,o){function u(t,n,s){var o,u=r[this.uid];return e.typeOf(u)!=="string"||!u.length?null:(o=new i(null,{type:s,size:n-t}),o.detach(u.substr(t,o.size)),o)}n.call(this),s&&this.connectRuntime(s),o?e.typeOf(o)==="string"&&(o={data:o}):o={},e.extend(this,{uid:o.uid||e.guid("uid_"),ruid:s,size:o.size||0,type:o.type||"",slice:function(e,t,n){return this.isDetached()?u.apply(this,arguments):this.getRuntime().exec.call(this,"Blob","slice",this.getSource(),e,t,n)},getSource:function(){return r[this.uid]?r[this.uid]:null},detach:function(e){this.ruid&&(this.getRuntime().exec.call(this,"Blob","destroy",r[this.uid]),this.disconnectRuntime(),this.ruid=null),e=e||"";var n=e.match(/^data:([^;]*);base64,/);n&&(this.type=n[1],e=t.atob(e.substring(e.indexOf("base64,")+7))),this.size=e.length,r[this.uid]=e},isDetached:function(){return!this.ruid&&e.typeOf(r[this.uid])==="string"},destroy:function(){this.detach(),delete r[this.uid]}}),o.data?this.detach(o.data):r[this.uid]=o}var r={};return i}),i("moxie/file/File",["moxie/core/utils/Basic","moxie/core/utils/Mime","moxie/file/Blob"],function(e,t,n){function r(r,i){var s,o;i||(i={}),i.type&&i.type!==""?o=i.type:o=t.getFileMime(i.name);if(i.name)s=i.name.replace(/\\/g,"/"),s=s.substr(s.lastIndexOf("/")+1);else{var u=o.split("/")[0];s=e.guid((u!==""?u:"file")+"_"),t.extensions[o]&&(s+="."+t.extensions[o][0])}n.apply(this,arguments),e.extend(this,{type:o||"",name:s||e.guid("file_"),lastModifiedDate:i.lastModifiedDate||(new Date).toLocaleString()})}return r.prototype=n.prototype,r}),i("moxie/file/FileInput",["moxie/core/utils/Basic","moxie/core/utils/Mime","moxie/core/utils/Dom","moxie/core/Exceptions","moxie/core/EventTarget","moxie/core/I18n","moxie/file/File","moxie/runtime/Runtime","moxie/runtime/RuntimeClient"],function(e,t,n,r,i,s,o,u,a){function l(i){var l=this,c,h,p;e.inArray(e.typeOf(i),["string","node"])!==-1&&(i={browse_button:i}),h=n.get(i.browse_button);if(!h)throw new r.DOMException(r.DOMException.NOT_FOUND_ERR);p={accept:[{title:s.translate("All Files"),extensions:"*"}],name:"file",multiple:!1,required_caps:!1,container:h.parentNode||document.body},i=e.extend({},p,i),typeof i.required_caps=="string"&&(i.required_caps=u.parseCaps(i.required_caps)),typeof i.accept=="string"&&(i.accept=t.mimes2extList(i.accept)),c=n.get(i.container),c||(c=document.body),n.getStyle(c,"position")==="static"&&(c.style.position="relative"),c=h=null,a.call(l),e.extend(l,{uid:e.guid("uid_"),ruid:null,files:null,init:function(){l.convertEventPropsToHandlers(f),l.bind("RuntimeInit",function(t,r){l.ruid=r.uid,l.bind("Ready",function(){l.trigger("Refresh")},999),l.bind("Change",function(){var t=r.exec.call(l,"FileInput","getFiles");l.files=[],e.each(t,function(e){l.files.push(new o(l.ruid,e))})},999),l.bind("Refresh",function(){var t,s,o,u;o=n.get(i.browse_button),u=n.get(r.shimid),o&&(t=n.getPos(o,n.get(i.container)),s=n.getSize(o),u&&e.extend(u.style,{top:t.y+"px",left:t.x+"px",width:s.w+"px",height:s.h+"px"})),u=o=null}),r.exec.call(l,"FileInput","init",i)}),l.connectRuntime(e.extend({},i,{required_caps:{select_file:!0}}))},disable:function(t){var n=this.getRuntime();n&&n.exec.call(this,"FileInput","disable",e.typeOf(t)==="undefined"?!0:t)},refresh:function(){l.trigger("Refresh")},destroy:function(){var t=this.getRuntime();t&&(t.exec.call(this,"FileInput","destroy"),this.disconnectRuntime()),e.typeOf(this.files)==="array"&&e.each(this.files,function(e){e.destroy()}),this.files=null}})}var f=["ready","change","cancel","mouseenter","mouseleave","mousedown","mouseup"];return l.prototype=i.instance,l}),i("moxie/file/FileDrop",["moxie/core/I18n","moxie/core/utils/Dom","moxie/core/Exceptions","moxie/core/utils/Basic","moxie/file/File","moxie/runtime/RuntimeClient","moxie/core/EventTarget","moxie/core/utils/Mime"],function(e,t,n,r,i,s,o,u){function f(n){var o=this,f;typeof n=="string"&&(n={drop_zone:n}),f={accept:[{title:e.translate("All Files"),extensions:"*"}],required_caps:{drag_and_drop:!0}},n=typeof n=="object"?r.extend({},f,n):f,n.container=t.get(n.drop_zone)||document.body,t.getStyle(n.container,"position")==="static"&&(n.container.style.position="relative"),typeof n.accept=="string"&&(n.accept=u.mimes2extList(n.accept)),s.call(o),r.extend(o,{uid:r.guid("uid_"),ruid:null,files:null,init:function(){o.convertEventPropsToHandlers(a),o.bind("RuntimeInit",function(e,t){o.ruid=t.uid,o.bind("Drop",function(){var e=t.exec.call(o,"FileDrop","getFiles");o.files=[],r.each(e,function(e){o.files.push(new i(o.ruid,e))})},999),t.exec.call(o,"FileDrop","init",n),o.dispatchEvent("ready")}),o.connectRuntime(n)},destroy:function(){var e=this.getRuntime();e&&(e.exec.call(this,"FileDrop","destroy"),this.disconnectRuntime()),this.files=null}})}var a=["ready","dragenter","dragleave","drop","error"];return f.prototype=o.instance,f}),i("moxie/runtime/RuntimeTarget",["moxie/core/utils/Basic","moxie/runtime/RuntimeClient","moxie/core/EventTarget"],function(e,t,n){function r(){this.uid=e.guid("uid_"),t.call(this),this.destroy=function(){this.disconnectRuntime(),this.unbindAll()}}return r.prototype=n.instance,r}),i("moxie/file/FileReader",["moxie/core/utils/Basic","moxie/core/utils/Encode","moxie/core/Exceptions","moxie/core/EventTarget","moxie/file/Blob","moxie/file/File","moxie/runtime/RuntimeTarget"],function(e,t,n,r,i,s,o){function a(){function f(e,f){function l(e){r.readyState=a.DONE,r.error=e,r.trigger("error"),c()}function c(){s.destroy(),s=null,r.trigger("loadend")}function h(t){s.bind("Error",function(e,t){l(t)}),s.bind("Progress",function(e){r.result=t.exec.call(s,"FileReader","getResult"),r.trigger(e)}),s.bind("Load",function(e){r.readyState=a.DONE,r.result=t.exec.call(s,"FileReader","getResult"),r.trigger(e),c()}),t.exec.call(s,"FileReader","read",e,f)}s=new o,this.convertEventPropsToHandlers(u);if(this.readyState===a.LOADING)return l(new n.DOMException(n.DOMException.INVALID_STATE_ERR));this.readyState=a.LOADING,this.trigger("loadstart");if(f instanceof i)if(f.isDetached()){var p=f.getSource();switch(e){case"readAsText":case"readAsBinaryString":this.result=p;break;case"readAsDataURL":this.result="data:"+f.type+";base64,"+t.btoa(p)}this.readyState=a.DONE,this.trigger("load"),c()}else h(s.connectRuntime(f.ruid));else l(new n.DOMException(n.DOMException.NOT_FOUND_ERR))}var r=this,s;e.extend(this,{uid:e.guid("uid_"),readyState:a.EMPTY,result:null,error:null,readAsBinaryString:function(e){f.call(this,"readAsBinaryString",e)},readAsDataURL:function(e){f.call(this,"readAsDataURL",e)},readAsText:function(e){f.call(this,"readAsText",e)},abort:function(){this.result=null;if(e.inArray(this.readyState,[a.EMPTY,a.DONE])!==-1)return;this.readyState===a.LOADING&&(this.readyState=a.DONE),s&&s.getRuntime().exec.call(this,"FileReader","abort"),this.trigger("abort"),this.trigger("loadend")},destroy:function(){this.abort(),s&&(s.getRuntime().exec.call(this,"FileReader","destroy"),s.disconnectRuntime()),r=s=null}})}var u=["loadstart","progress","load","abort","error","loadend"];return a.EMPTY=0,a.LOADING=1,a.DONE=2,a.prototype=r.instance,a}),i("moxie/core/utils/Url",[],function(){var e=function(e){var t=["source","scheme","authority","userInfo","user","pass","host","port","relative","path","directory","file","query","fragment"],n=t.length,r={http:80,https:443},i={},s=/^(?:([^:\/?#]+):)?(?:\/\/()(?:(?:()(?:([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?))?()(?:(()(?:(?:[^?#\/]*\/)*)()(?:[^?#]*))(?:\\?([^#]*))?(?:#(.*))?)/,o=s.exec(e||"");while(n--)o[n]&&(i[t[n]]=o[n]);if(/^[^\/]/.test(i.path)&&!i.scheme){var u=document.location.pathname;/(\/|\/[^\.]+)$/.test(u)||(u=u.replace(/[^\/]+$/,"")),i.host=document.location.hostname,i.path=u+(i.path||"")}return i.scheme||(i.scheme=document.location.protocol.replace(/:$/,"")),i.host||(i.host=document.location.hostname),i.port||(i.port=document.location.port||r[i.scheme]||80),i.port=parseInt(i.port,10),i.path||(i.path="/"),delete i.source,i},t=function(t){var n={http:80,https:443},r=e(t);return r.scheme+"://"+r.host+(r.port!==n[r.scheme]?":"+r.port:"")+r.path+(r.query?r.query:"")},n=function(t){function n(e){return[e.scheme,e.host,e.port].join("/")}return typeof t=="string"&&(t=e(t)),n(e())===n(t)};return{parseUrl:e,resolveUrl:t,hasSameOrigin:n}}),i("moxie/file/FileReaderSync",["moxie/core/utils/Basic","moxie/runtime/RuntimeClient","moxie/core/utils/Encode"],function(e,t,n){return function(){function r(e,t){if(!t.isDetached()){var u=this.connectRuntime(t.ruid).exec.call(this,"FileReaderSync","read",e,t);return this.disconnectRuntime(),u}var r=t.getSource();switch(e){case"readAsBinaryString":return r;case"readAsDataURL":return"data:"+t.type+";base64,"+n.btoa(r);case"readAsText":var i="";for(var s=0,o=r.length;s<o;s++)i+=String.fromCharCode(r[s]);return i}}t.call(this),e.extend(this,{uid:e.guid("uid_"),readAsBinaryString:function(e){return r.call(this,"readAsBinaryString",e)},readAsDataURL:function(e){return r.call(this,"readAsDataURL",e)},readAsText:function(e){return r.call(this,"readAsText",e)}})}}),i("moxie/xhr/FormData",["moxie/core/Exceptions","moxie/core/utils/Basic","moxie/file/Blob"],function(e,t,n){function r(){var e,r={},i="";t.extend(this,{append:function(i,s){var o=this,u=t.typeOf(s);s instanceof n?(e&&delete r[e],e=i,r[i]=[s]):"array"===u?(i+="[]",t.each(s,function(e){o.append.call(o,i,e)})):"object"===u?t.each(s,function(e,t){o.append.call(o,i+"["+t+"]",e)}):(s=s.toString(),r[i]||(r[i]=[]),r[i].push(s))},hasBlob:function(){return!!e},getBlob:function(){return r[e]&&r[e][0]||null},getBlobName:function(){return e||null},each:function(e){t.each(r,function(n,r){t.each(n,function(t){e(t,r)})})},destroy:function(){e=null,i="",r={}}})}return r}),i("moxie/xhr/XMLHttpRequest",["moxie/core/utils/Basic","moxie/core/Exceptions","moxie/core/EventTarget","moxie/core/utils/Encode","moxie/core/utils/Url","moxie/runtime/Runtime","moxie/runtime/RuntimeTarget","moxie/file/Blob","moxie/file/FileReaderSync","moxie/xhr/FormData","moxie/core/utils/Env","moxie/core/utils/Mime"],function(e,t,n,r,i,s,o,u,a,f,l,c){function p(){this.uid=e.guid("uid_")}function g(){function I(e,t){if(!a.hasOwnProperty(e))return;if(arguments.length===1)return l.can("define_property")?a[e]:n[e];l.can("define_property")?a[e]=t:n[e]=t}function q(t){function r(){B.destroy(),B=null,n.dispatchEvent("loadend"),n=null}function i(i){B.bind("LoadStart",function(e){I("readyState",g.LOADING),n.dispatchEvent("readystatechange"),n.dispatchEvent(e),k&&n.upload.dispatchEvent(e)}),B.bind("Progress",function(e){I("readyState")!==g.LOADING&&(I("readyState",g.LOADING),n.dispatchEvent("readystatechange")),n.dispatchEvent(e)}),B.bind("UploadProgress",function(e){k&&n.upload.dispatchEvent({type:"progress",lengthComputable:!1,total:e.total,loaded:e.loaded})}),B.bind("Load",function(t){I("readyState",g.DONE),I("status",Number(i.exec.call(B,"XMLHttpRequest","getStatus")||0)),I("statusText",h[I("status")]||""),I("response",i.exec.call(B,"XMLHttpRequest","getResponse",I("responseType"))),~e.inArray(I("responseType"),["text",""])?I("responseText",I("response")):I("responseType")==="document"&&I("responseXML",I("response")),j=i.exec.call(B,"XMLHttpRequest","getAllResponseHeaders"),n.dispatchEvent("readystatechange"),I("status")>0?(k&&n.upload.dispatchEvent(t),n.dispatchEvent(t)):(A=!0,n.dispatchEvent("error")),r()}),B.bind("Abort",function(e){n.dispatchEvent(e),r()}),B.bind("Error",function(e){A=!0,I("readyState",g.DONE),n.dispatchEvent("readystatechange"),L=!0,n.dispatchEvent(e),r()}),i.exec.call(B,"XMLHttpRequest","send",{url:m,method:y,async:v,user:w,password:E,headers:b,mimeType:T,encoding:S,responseType:n.responseType,withCredentials:n.withCredentials,options:H},t)}var n=this;M=(new Date).getTime(),B=new o,typeof H.required_caps=="string"&&(H.required_caps=s.parseCaps(H.required_caps)),H.required_caps=e.extend({},H.required_caps,{return_response_type:n.responseType}),t instanceof f&&(H.required_caps.send_multipart=!0),O||(H.required_caps.do_cors=!0),H.ruid?i(B.connectRuntime(H)):(B.bind("RuntimeInit",function(e,t){i(t)}),B.bind("RuntimeError",function(e,t){n.dispatchEvent("RuntimeError",t)}),B.connectRuntime(H))}function R(){I("responseText",""),I("responseXML",null),I("response",null),I("status",0),I("statusText",""),M=_=null}var n=this,a={timeout:0,readyState:g.UNSENT,withCredentials:!1,status:0,statusText:"",responseType:"",responseXML:null,responseText:null,response:null},v=!0,m,y,b={},w,E,S=null,T=null,N=!1,C=!1,k=!1,L=!1,A=!1,O=!1,M,_,D=null,P=null,H={},B,j="",F;e.extend(this,a,{uid:e.guid("uid_"),upload:new p,open:function(n,s,o,u,a){var f;if(!n||!s)throw new t.DOMException(t.DOMException.SYNTAX_ERR);if(/[\u0100-\uffff]/.test(n)||r.utf8_encode(n)!==n)throw new t.DOMException(t.DOMException.SYNTAX_ERR);!~e.inArray(n.toUpperCase(),["CONNECT","DELETE","GET","HEAD","OPTIONS","POST","PUT","TRACE","TRACK"])||(y=n.toUpperCase());if(!!~e.inArray(y,["CONNECT","TRACE","TRACK"]))throw new t.DOMException(t.DOMException.SECURITY_ERR);s=r.utf8_encode(s),f=i.parseUrl(s),O=i.hasSameOrigin(f),m=i.resolveUrl(s);if((u||a)&&!O)throw new t.DOMException(t.DOMException.INVALID_ACCESS_ERR);w=u||f.user,E=a||f.pass,v=o||!0;if(v===!1&&(I("timeout")||I("withCredentials")||I("responseType")!==""))throw new t.DOMException(t.DOMException.INVALID_ACCESS_ERR);N=!v,C=!1,b={},R.call(this),I("readyState",g.OPENED),this.convertEventPropsToHandlers(["readystatechange"]),this.dispatchEvent("readystatechange")},setRequestHeader:function(n,i){var s=["accept-charset","accept-encoding","access-control-request-headers","access-control-request-method","connection","content-length","cookie","cookie2","content-transfer-encoding","date","expect","host","keep-alive","origin","referer","te","trailer","transfer-encoding","upgrade","user-agent","via"];if(I("readyState")!==g.OPENED||C)throw new t.DOMException(t.DOMException.INVALID_STATE_ERR);if(/[\u0100-\uffff]/.test(n)||r.utf8_encode(n)!==n)throw new t.DOMException(t.DOMException.SYNTAX_ERR);return n=e.trim(n).toLowerCase(),!!~e.inArray(n,s)||/^(proxy\-|sec\-)/.test(n)?!1:(b[n]?b[n]+=", "+i:b[n]=i,!0)},getAllResponseHeaders:function(){return j||""},getResponseHeader:function(t){t=t.toLowerCase();if(A||!!~e.inArray(t,["set-cookie","set-cookie2"]))return null;if(j&&j!==""){F||(F={},e.each(j.split(/\r\n/),function(t){var n=t.split(/:\s+/);n.length===2&&(n[0]=e.trim(n[0]),F[n[0].toLowerCase()]={header:n[0],value:e.trim(n[1])})}));if(F.hasOwnProperty(t))return F[t].header+": "+F[t].value}return null},overrideMimeType:function(n){var r,i;if(!!~e.inArray(I("readyState"),[g.LOADING,g.DONE]))throw new t.DOMException(t.DOMException.INVALID_STATE_ERR);n=e.trim(n.toLowerCase()),/;/.test(n)&&(r=n.match(/^([^;]+)(?:;\scharset\=)?(.*)$/))&&(n=r[1],r[2]&&(i=r[2]));if(!c.mimes[n])throw new t.DOMException(t.DOMException.SYNTAX_ERR);D=n,P=i},send:function(n,i){e.typeOf(i)==="string"?H={ruid:i}:i?H=i:H={},this.convertEventPropsToHandlers(d),this.upload.convertEventPropsToHandlers(d);if(this.readyState!==g.OPENED||C)throw new t.DOMException(t.DOMException.INVALID_STATE_ERR);if(n instanceof u)H.ruid=n.ruid,T=n.type||"application/octet-stream";else if(n instanceof f){if(n.hasBlob()){var s=n.getBlob();H.ruid=s.ruid,T=s.type||"application/octet-stream"}}else typeof n=="string"&&(S="UTF-8",T="text/plain;charset=UTF-8",n=r.utf8_encode(n));this.withCredentials||(this.withCredentials=H.required_caps&&H.required_caps.send_browser_cookies&&!O),k=!N&&this.upload.hasEventListener(),A=!1,L=!n,N||(C=!0,!L),q.call(this,n)},abort:function(){A=!0,N=!1;if(!~e.inArray(I("readyState"),[g.UNSENT,g.OPENED,g.DONE])){I("readyState",g.DONE),C=!1;if(!B)throw new t.DOMException(t.DOMException.INVALID_STATE_ERR);B.getRuntime().exec.call(B,"XMLHttpRequest","abort",L),L=!0}else I("readyState",g.UNSENT)},destroy:function(){B&&(e.typeOf(B.destroy)==="function"&&B.destroy(),B=null),this.unbindAll(),this.upload&&(this.upload.unbindAll(),this.upload=null)}})}var h={100:"Continue",101:"Switching Protocols",102:"Processing",200:"OK",201:"Created",202:"Accepted",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",207:"Multi-Status",226:"IM Used",300:"Multiple Choices",301:"Moved Permanently",302:"Found",303:"See Other",304:"Not Modified",305:"Use Proxy",306:"Reserved",307:"Temporary Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Request Entity Too Large",414:"Request-URI Too Long",415:"Unsupported Media Type",416:"Requested Range Not Satisfiable",417:"Expectation Failed",422:"Unprocessable Entity",423:"Locked",424:"Failed Dependency",426:"Upgrade Required",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Timeout",505:"HTTP Version Not Supported",506:"Variant Also Negotiates",507:"Insufficient Storage",510:"Not Extended"};p.prototype=n.instance;var d=["loadstart","progress","abort","error","load","timeout","loadend"],v=1,m=2;return g.UNSENT=0,g.OPENED=1,g.HEADERS_RECEIVED=2,g.LOADING=3,g.DONE=4,g.prototype=n.instance,g}),i("moxie/runtime/Transporter",["moxie/core/utils/Basic","moxie/core/utils/Encode","moxie/runtime/RuntimeClient","moxie/core/EventTarget"],function(e,t,n,r){function i(){function l(){u=a=0,o=this.result=null}function c(t,n){var r=this;s=n,r.bind("TransportingProgress",function(t){a=t.loaded,a<u&&e.inArray(r.state,[i.IDLE,i.DONE])===-1&&h.call(r)},999),r.bind("TransportingComplete",function(){a=u,r.state=i.DONE,o=null,r.result=s.exec.call(r,"Transporter","getAsBlob",t||"")},999),r.state=i.BUSY,r.trigger("TransportingStarted"),h.call(r)}function h(){var e=this,n,r=u-a;f>r&&(f=r),n=t.btoa(o.substr(a,f)),s.exec.call(e,"Transporter","receive",n,u)}var r,s,o,u,a,f;n.call(this),e.extend(this,{uid:e.guid("uid_"),state:i.IDLE,result:null,transport:function(t,n,i){var s=this;i=e.extend({chunk_size:204798},i);if(r=i.chunk_size%3)i.chunk_size+=3-r;f=i.chunk_size,l.call(this),o=t,u=t.length;if(e.typeOf(i)==="string"||i.ruid)c.call(s,n,this.connectRuntime(i));else{var a=function(e,t){s.unbind("RuntimeInit",a),c.call(s,n,t)};this.bind("RuntimeInit",a),this.connectRuntime(i)}},abort:function(){var e=this;e.state=i.IDLE,s&&(s.exec.call(e,"Transporter","clear"),e.trigger("TransportingAborted")),l.call(e)},destroy:function(){this.unbindAll(),s=null,this.disconnectRuntime(),l.call(this)}})}return i.IDLE=0,i.BUSY=1,i.DONE=2,i.prototype=r.instance,i}),i("moxie/core/JSON",[],function(){return!!window.JSON&&JSON.parse||function(){var e,n,r={'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:"\n",r:"\r",t:"	"},i,s=function(t){throw{name:"SyntaxError",message:t,at:e,text:i}},o=function(t){return t&&t!==n&&s("Expected '"+t+"' instead of '"+n+"'"),n=i.charAt(e),e+=1,n},u=function(){var e,t="";n==="-"&&(t="-",o("-"));while(n>="0"&&n<="9")t+=n,o();if(n==="."){t+=".";while(o()&&n>="0"&&n<="9")t+=n}if(n==="e"||n==="E"){t+=n,o();if(n==="-"||n==="+")t+=n,o();while(n>="0"&&n<="9")t+=n,o()}e=+t;if(!!isFinite(e))return e;s("Bad number")},a=function(){var e,t,i="",u;if(n==='"')while(o()){if(n==='"')return o(),i;if(n==="\\"){o();if(n==="u"){u=0;for(t=0;t<4;t+=1){e=parseInt(o(),16);if(!isFinite(e))break;u=u*16+e}i+=String.fromCharCode(u)}else{if(typeof r[n]!="string")break;i+=r[n]}}else i+=n}s("Bad string")},f=function(){while(n&&n<=" ")o()},l=function(){switch(n){case"t":return o("t"),o("r"),o("u"),o("e"),!0;case"f":return o("f"),o("a"),o("l"),o("s"),o("e"),!1;case"n":return o("n"),o("u"),o("l"),o("l"),null}s("Unexpected '"+n+"'")},c,h=function(){var e=[];if(n==="["){o("["),f();if(n==="]")return o("]"),e;while(n){e.push(c()),f();if(n==="]")return o("]"),e;o(","),f()}}s("Bad array")},p=function(){var e,t={};if(n==="{"){o("{"),f();if(n==="}")return o("}"),t;while(n){e=a(),f(),o(":"),Object.hasOwnProperty.call(t,e)&&s('Duplicate key "'+e+'"'),t[e]=c(),f();if(n==="}")return o("}"),t;o(","),f()}}s("Bad object")};return c=function(){f();switch(n){case"{":return p();case"[":return h();case'"':return a();case"-":return u();default:return n>="0"&&n<="9"?u():l()}},function(r,o){var u;return i=r,e=0,n=" ",u=c(),f(),n&&s("Syntax error"),typeof o=="function"?function a(e,n){var r,i,s=e[n];if(s&&typeof s=="object")for(r in s)Object.prototype.hasOwnProperty.call(s,r)&&(i=a(s,r),i!==t?s[r]=i:delete s[r]);return o.call(e,n,s)}({"":u},""):u}}()}),i("moxie/image/Image",["moxie/core/utils/Basic","moxie/core/utils/Dom","moxie/core/Exceptions","moxie/file/FileReaderSync","moxie/xhr/XMLHttpRequest","moxie/runtime/Runtime","moxie/runtime/RuntimeClient","moxie/runtime/Transporter","moxie/core/utils/Env","moxie/core/EventTarget","moxie/file/Blob","moxie/file/File","moxie/core/utils/Encode","moxie/core/JSON"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p){function v(){function r(t){t||(t=this.getRuntime().exec.call(this,"Image","getInfo"));if(t)if(e.typeOf(t.meta)==="string")try{this.meta=p(t.meta)}catch(n){}else this.meta=t.meta;e.extend(this,{size:parseInt(t.size,10),width:parseInt(t.width,10),height:parseInt(t.height,10),type:t.type}),this.name===""&&(this.name=t.name)}function f(t){var r=e.typeOf(t);try{if(t instanceof v){if(!t.size)throw new n.DOMException(n.DOMException.INVALID_STATE_ERR);m.apply(this,arguments)}else if(t instanceof l){if(!~e.inArray(t.type,["image/jpeg","image/png"]))throw new n.ImageError(n.ImageError.WRONG_FORMAT);g.apply(this,arguments)}else if(e.inArray(r,["blob","file"])!==-1)f.call(this,new c(null,t),arguments[1]);else if(r==="string")/^data:[^;]*;base64,/.test(t)?f.call(this,new l(null,{data:t}),arguments[1]):y.apply(this,arguments);else{if(r!=="node"||t.nodeName.toLowerCase()!=="img")throw new n.DOMException(n.DOMException.TYPE_MISMATCH_ERR);f.call(this,t.src,arguments[1])}}catch(i){this.trigger("error",i)}}function m(t,n){var r=this.connectRuntime(t.ruid);this.ruid=r.uid,r.exec.call(this,"Image","loadFromImage",t,e.typeOf(n)==="undefined"?!0:n)}function g(t,n){function i(e){r.ruid=e.uid,e.exec.call(r,"Image","loadFromBlob",t)}var r=this;r.name=t.name||"",t.isDetached()?(this.bind("RuntimeInit",function(e,t){i(t)}),n&&typeof n.required_caps=="string"&&(n.required_caps=s.parseCaps(n.required_caps)),this.connectRuntime(e.extend({required_caps:{access_image_binary:!0,resize_image:!0}},n))):i(this.connectRuntime(t.ruid))}function y(e,t){var n=this,r;r=new i,r.open("get",e),r.responseType="blob",r.onprogress=function(e){n.trigger(e)},r.onload=function(){g.call(n,r.response,!0)},r.onerror=function(e){n.trigger(e)},r.onloadend=function(){r.destroy()},r.bind("RuntimeError",function(e,t){n.trigger("RuntimeError",t)}),r.send(null,t)}o.call(this),e.extend(this,{uid:e.guid("uid_"),ruid:null,name:"",size:0,width:0,height:0,type:"",meta:{},clone:function(){this.load.apply(this,arguments)},load:function(){this.bind("Load Resize",function(){r.call(this)},999),this.convertEventPropsToHandlers(d),f.apply(this,arguments)},downsize:function(t,r,i,s){try{if(!this.size)throw new n.DOMException(n.DOMException.INVALID_STATE_ERR);if(this.width>v.MAX_RESIZE_WIDTH||this.height>v.MAX_RESIZE_HEIGHT)throw new n.ImageError(n.ImageError.MAX_RESOLUTION_ERR);if(!t&&!r||e.typeOf(i)==="undefined")i=!1;t=t||this.width,r=r||this.height,s=e.typeOf(s)==="undefined"?!0:!!s,this.getRuntime().exec.call(this,"Image","downsize",t,r,i,s)}catch(o){this.trigger("error",o)}},crop:function(e,t,n){this.downsize(e,t,!0,n)},getAsCanvas:function(){if(!a.can("create_canvas"))throw new n.RuntimeError(n.RuntimeError.NOT_SUPPORTED_ERR);var e=this.connectRuntime(this.ruid);return e.exec.call(this,"Image","getAsCanvas")},getAsBlob:function(e,t){if(!this.size)throw new n.DOMException(n.DOMException.INVALID_STATE_ERR);return e||(e="image/jpeg"),e==="image/jpeg"&&!t&&(t=90),this.getRuntime().exec.call(this,"Image","getAsBlob",e,t)},getAsDataURL:function(e,t){if(!this.size)throw new n.DOMException(n.DOMException.INVALID_STATE_ERR);return this.getRuntime().exec.call(this,"Image","getAsDataURL",e,t)},getAsBinaryString:function(e,t){var n=this.getAsDataURL(e,t);return h.atob(n.substring(n.indexOf("base64,")+7))},embed:function(r){function g(){if(a.can("create_canvas")){var t=s.getAsCanvas();if(t){r.appendChild(t),t=null,s.destroy(),i.trigger("embedded");return}}var l=s.getAsDataURL(o,f);if(!l)throw new n.ImageError(n.ImageError.WRONG_FORMAT);if(a.can("use_data_uri_of",l.length))r.innerHTML='<img src="'+l+'" width="'+s.width+'" height="'+s.height+'" />',s.destroy(),i.trigger("embedded");else{var v=new u;v.bind("TransportingComplete",function(){m=i.connectRuntime(this.result.ruid),i.bind("Embedded",function(){e.extend(m.getShimContainer().style,{top:"0px",left:"0px",width:s.width+"px",height:s.height+"px"}),m=null},999),m.exec.call(i,"ImageView","display",this.result.uid,p,d),s.destroy()}),v.transport(h.atob(l.substring(l.indexOf("base64,")+7)),o,e.extend({},c,{required_caps:{display_media:!0},runtime_order:"flash,silverlight",container:r}))}}var i=this,s,o,f,l,c=arguments[1]||{},p=this.width,d=this.height,m;try{if(!(r=t.get(r)))throw new n.DOMException(n.DOMException.INVALID_NODE_TYPE_ERR);if(!this.size)throw new n.DOMException(n.DOMException.INVALID_STATE_ERR);if(this.width>v.MAX_RESIZE_WIDTH||this.height>v.MAX_RESIZE_HEIGHT)throw new n.ImageError(n.ImageError.MAX_RESOLUTION_ERR);o=c.type||this.type||"image/jpeg",f=c.quality||90,l=e.typeOf(c.crop)!=="undefined"?c.crop:!1;if(c.width)p=c.width,d=c.height||p;else{var y=t.getSize(r);y.w&&y.h&&(p=y.w,d=y.h)}return s=new v,s.bind("Resize",function(){g.call(i)}),s.bind("Load",function(){s.downsize(p,d,l,!1)}),s.clone(this,!1),s}catch(b){this.trigger("error",b)}},destroy:function(){this.ruid&&(this.getRuntime().exec.call(this,"Image","destroy"),this.disconnectRuntime()),this.unbindAll()}})}var d=["progress","load","error","resize","embedded"];return v.MAX_RESIZE_WIDTH=6500,v.MAX_RESIZE_HEIGHT=6500,v.prototype=f.instance,v}),i("moxie/runtime/html5/Runtime",["moxie/core/utils/Basic","moxie/core/Exceptions","moxie/runtime/Runtime","moxie/core/utils/Env"],function(e,t,n,r){function o(t){var o=this,u=n.capTest,a=n.capTrue,f=e.extend({access_binary:u(window.FileReader||window.File&&window.File.getAsDataURL),access_image_binary:function(){return o.can("access_binary")&&!!s.Image},display_media:u(r.can("create_canvas")||r.can("use_data_uri_over32kb")),do_cors:u(window.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest),drag_and_drop:u(function(){var e=document.createElement("div");return("draggable"in e||"ondragstart"in e&&"ondrop"in e)&&(r.browser!=="IE"||r.version>9)}()),filter_by_extension:u(function(){return r.browser==="Chrome"&&r.version>=28||r.browser==="IE"&&r.version>=10}()),return_response_headers:a,return_response_type:function(e){return e==="json"?!0:r.can("return_response_type",e)},report_upload_progress:u(window.XMLHttpRequest&&(new XMLHttpRequest).upload),resize_image:function(){return o.can("access_binary")&&r.can("create_canvas")},select_file:function(){return r.can("use_fileinput")&&window.File},select_folder:function(){return o.can("select_file")&&r.browser==="Chrome"&&r.version>=21},select_multiple:function(){return o.can("select_file")&&(r.browser!=="Safari"||r.OS!=="Windows")},send_binary_string:u(window.XMLHttpRequest&&((new XMLHttpRequest).sendAsBinary||window.Uint8Array&&window.ArrayBuffer)),send_custom_headers:u(window.XMLHttpRequest),send_multipart:function(){return!!(window.XMLHttpRequest&&(new XMLHttpRequest).upload&&window.FormData)||o.can("send_binary_string")},slice_blob:u(window.File&&(File.prototype.mozSlice||File.prototype.webkitSlice||File.prototype.slice)),stream_upload:function(){return o.can("slice_blob")&&o.can("send_multipart")},summon_file_dialog:u(function(){return r.browser==="Firefox"&&r.version>=4||r.browser==="Opera"&&r.version>=12||r.browser==="IE"&&r.version>=10||!!~e.inArray(r.browser,["Chrome","Safari"])}()),upload_filesize:a},arguments[2]);n.call(this,t,arguments[1]||i,f),e.extend(this,{init:function(){this.trigger("Init")},destroy:function(e){return function(){e.call(o),e=o=null}}(this.destroy)}),e.extend(this.getShim(),s)}var i="html5",s={};return n.addConstructor(i,o),s}),i("moxie/runtime/html5/file/Blob",["moxie/runtime/html5/Runtime","moxie/file/Blob"],function(e,t){function n(){function e(e,t,n){var r;if(!window.File.prototype.slice)return(r=window.File.prototype.webkitSlice||window.File.prototype.mozSlice)?r.call(e,t,n):null;try{return e.slice(),e.slice(t,n)}catch(i){return e.slice(t,n-t)}}this.slice=function(){return new t(this.getRuntime().uid,e.apply(this,arguments))}}return e.Blob=n}),i("moxie/core/utils/Events",["moxie/core/utils/Basic"],function(e){function r(){this.returnValue=!1}function i(){this.cancelBubble=!0}var t={},n="moxie_"+e.guid(),s=function(s,o,u,a){var f,l;o=o.toLowerCase(),s.addEventListener?(f=u,s.addEventListener(o,f,!1)):s.attachEvent&&(f=function(){var e=window.event;e.target||(e.target=e.srcElement),e.preventDefault=r,e.stopPropagation=i,u(e)},s.attachEvent("on"+o,f)),s[n]||(s[n]=e.guid()),t.hasOwnProperty(s[n])||(t[s[n]]={}),l=t[s[n]],l.hasOwnProperty(o)||(l[o]=[]),l[o].push({func:f,orig:u,key:a})},o=function(r,i,s){var o,u;i=i.toLowerCase();if(!(r[n]&&t[r[n]]&&t[r[n]][i]))return;o=t[r[n]][i];for(var a=o.length-1;a>=0;a--)if(o[a].orig===s||o[a].key===s){r.removeEventListener?r.removeEventListener(i,o[a].func,!1):r.detachEvent&&r.detachEvent("on"+i,o[a].func),o[a].orig=null,o[a].func=null,o.splice(a,1);if(s!==u)break}o.length||delete t[r[n]][i];if(e.isEmptyObj(t[r[n]])){delete t[r[n]];try{delete r[n]}catch(f){r[n]=u}}},u=function(r,i){if(!r||!r[n])return;e.each(t[r[n]],function(e,t){o(r,t,i)})};return{addEvent:s,removeEvent:o,removeAllEvents:u}}),i("moxie/runtime/html5/file/FileInput",["moxie/runtime/html5/Runtime","moxie/core/utils/Basic","moxie/core/utils/Dom","moxie/core/utils/Events","moxie/core/utils/Mime","moxie/core/utils/Env"],function(e,t,n,r,i,s){function o(){var e=[],o;t.extend(this,{init:function(u){var a=this,f=a.getRuntime(),l,c,h,p,d,v;o=u,e=[],h=o.accept.mimes||i.extList2mimes(o.accept,f.can("filter_by_extension")),c=f.getShimContainer(),c.innerHTML='<input id="'+f.uid+'" type="file" style="font-size:999px;opacity:0;"'+(o.multiple&&f.can("select_multiple")?"multiple":"")+(o.directory&&f.can("select_folder")?"webkitdirectory directory":"")+(h?' accept="'+h.join(",")+'"':"")+" />",l=n.get(f.uid),t.extend(l.style,{position:"absolute",top:0,left:0,width:"100%",height:"100%"}),p=n.get(o.browse_button),f.can("summon_file_dialog")&&(n.getStyle(p,"position")==="static"&&(p.style.position="relative"),d=parseInt(n.getStyle(p,"z-index"),10)||1,p.style.zIndex=d,c.style.zIndex=d-1,r.addEvent(p,"click",function(e){var t=n.get(f.uid);t&&!t.disabled&&t.click(),e.preventDefault()},a.uid)),v=f.can("summon_file_dialog")?p:c,r.addEvent(v,"mouseover",function(){a.trigger("mouseenter")},a.uid),r.addEvent(v,"mouseout",function(){a.trigger("mouseleave")},a.uid),r.addEvent(v,"mousedown",function(){a.trigger("mousedown")},a.uid),r.addEvent(n.get(o.container),"mouseup",function(){a.trigger("mouseup")},a.uid),l.onchange=function m(){e=[],o.directory?t.each(this.files,function(t){t.name!=="."&&e.push(t)}):e=[].slice.call(this.files);if(s.browser!=="IE")this.value="";else{var n=this.cloneNode(!0);this.parentNode.replaceChild(n,this),n.onchange=m}a.trigger("change")},a.trigger({type:"ready",async:!0}),c=null},getFiles:function(){return e},disable:function(e){var t=this.getRuntime(),r;if(r=n.get(t.uid))r.disabled=!!e},destroy:function(){var t=this.getRuntime(),i=t.getShimContainer();r.removeAllEvents(i,this.uid),r.removeAllEvents(o&&n.get(o.container),this.uid),r.removeAllEvents(o&&n.get(o.browse_button),this.uid),i&&(i.innerHTML=""),e=o=null}})}return e.FileInput=o}),i("moxie/runtime/html5/file/FileDrop",["moxie/runtime/html5/Runtime","moxie/core/utils/Basic","moxie/core/utils/Dom","moxie/core/utils/Events","moxie/core/utils/Mime"],function(e,t,n,r,i){function s(){function o(e){var n=s.accept.mimes||i.extList2mimes(s.accept),r=e.type||i.getFileMime(e.name)||"";return!n.length||t.inArray(r,n)!==-1?!0:!1}function u(e,n){var r=[];t.each(e,function(e){r.push(function(t){a(e,t)})}),t.inSeries(r,function(){n()})}function a(t,n){t.isFile?t.file(function(t){o(t)&&e.push(t),n()},function(){n()}):t.isDirectory?f(t,n):n()}function f(e,t){function i(e){r.readEntries(function(t){t.length?([].push.apply(n,t),i(e)):e()},e)}var n=[],r=e.createReader();i(function(){u(n,t)})}var e=[],s;t.extend(this,{init:function(n){var i=this,a;s=n,a=s.container,r.addEvent(a,"dragover",function(e){e.preventDefault(),e.stopPropagation(),e.dataTransfer.dropEffect="copy"},i.uid),r.addEvent(a,"drop",function(n){n.preventDefault(),n.stopPropagation(),e=[];if(n.dataTransfer.items&&n.dataTransfer.items[0].webkitGetAsEntry){var r=[];t.each(n.dataTransfer.items,function(e){r.push(e.webkitGetAsEntry())}),u(r,function(){i.trigger("drop")})}else t.each(n.dataTransfer.files,function(t){o(t)&&e.push(t)}),i.trigger("drop")},i.uid),r.addEvent(a,"dragenter",function(e){e.preventDefault(),e.stopPropagation(),i.trigger("dragenter")},i.uid),r.addEvent(a,"dragleave",function(e){e.preventDefault(),e.stopPropagation(),i.trigger("dragleave")},i.uid)},getFiles:function(){return e},destroy:function(){r.removeAllEvents(s&&n.get(s.container),this.uid),e=s=null}})}return e.FileDrop=s}),i("moxie/runtime/html5/file/FileReader",["moxie/runtime/html5/Runtime","moxie/core/utils/Encode","moxie/core/utils/Basic"],function(e,t,n){function r(){function i(e){return t.atob(e.substring(e.indexOf("base64,")+7))}var e,r=!1;n.extend(this,{read:function(t,i){var s=this;e=new window.FileReader,e.addEventListener("progress",function(e){s.trigger(e)}),e.addEventListener("load",function(e){s.trigger(e)}),e.addEventListener("error",function(t){s.trigger(t,e.error)}),e.addEventListener("loadend",function(){e=null}),n.typeOf(e[t])==="function"?(r=!1,e[t](i.getSource())):t==="readAsBinaryString"&&(r=!0,e.readAsDataURL(i.getSource()))},getResult:function(){return e&&e.result?r?i(e.result):e.result:null},abort:function(){e&&e.abort()},destroy:function(){e=null}})}return e.FileReader=r}),i("moxie/runtime/html5/xhr/XMLHttpRequest",["moxie/runtime/html5/Runtime","moxie/core/utils/Basic","moxie/core/utils/Url","moxie/file/File","moxie/file/Blob","moxie/xhr/FormData","moxie/core/Exceptions","moxie/core/utils/Env","moxie/core/JSON"],function(e,t,n,r,i,s,o,u,a){function f(){function c(t,n){var r=this,s,o;s=n.getBlob().getSource(),o=new window.FileReader,o.onload=function(){n.append(n.getBlobName(),new i(null,{type:s.type,data:o.result})),e.send.call(r,t,n)},o.readAsBinaryString(s)}function h(){return!window.XMLHttpRequest||u.browser==="IE"&&u.version<8?function(){var e=["Msxml2.XMLHTTP.6.0","Microsoft.XMLHTTP"];for(var t=0;t<e.length;t++)try{return new ActiveXObject(e[t])}catch(n){}}():new window.XMLHttpRequest}function p(e){var t=e.responseXML,n=e.responseText;u.browser==="IE"&&n&&t&&!t.documentElement&&/[^\/]+\/[^\+]+\+xml/.test(e.getResponseHeader("Content-Type"))&&(t=new window.ActiveXObject("Microsoft.XMLDOM"),t.async=!1,t.validateOnParse=!1,t.loadXML(n));if(t)if(u.browser==="IE"&&t.parseError!==0||!t.documentElement||t.documentElement.tagName==="parsererror")return null;return t}function d(e){var t="----moxieboundary"+(new Date).getTime(),n="--",r="\r\n",s="",u=this.getRuntime();if(!u.can("send_binary_string"))throw new o.RuntimeError(o.RuntimeError.NOT_SUPPORTED_ERR);return f.setRequestHeader("Content-Type","multipart/form-data; boundary="+t),e.each(function(e,o){e instanceof i?s+=n+t+r+'Content-Disposition: form-data; name="'+o+'"; filename="'+unescape(encodeURIComponent(e.name||"blob"))+'"'+r+"Content-Type: "+e.type+r+r+e.getSource()+r:s+=n+t+r+'Content-Disposition: form-data; name="'+o+'"'+r+r+unescape(encodeURIComponent(e))+r}),s+=n+t+n+r,s}var e=this,f,l;t.extend(this,{send:function(e,r){var o=this,a=u.browser==="Mozilla"&&u.version>=4&&u.version<7,p=u.browser==="Android Browser",v=!1;l=e.url.replace(/^.+?\/([\w\-\.]+)$/,"$1").toLowerCase(),f=h(),f.open(e.method,e.url,e.async,e.user,e.password);if(r instanceof i)r.isDetached()&&(v=!0),r=r.getSource();else if(r instanceof s){if(r.hasBlob())if(r.getBlob().isDetached())r=d.call(o,r),v=!0;else if((a||p)&&t.typeOf(r.getBlob().getSource())==="blob"&&window.FileReader){c.call(o,e,r);return}if(r instanceof s){var m=new window.FormData;r.each(function(e,t){e instanceof i?m.append(t,e.getSource()):m.append(t,e)}),r=m}}f.upload?(e.withCredentials&&(f.withCredentials=!0),f.addEventListener("load",function(e){o.trigger(e)}),f.addEventListener("error",function(e){o.trigger(e)}),f.addEventListener("progress",function(e){o.trigger(e)}),f.upload.addEventListener("progress",function(e){o.trigger({type:"UploadProgress",loaded:e.loaded,total:e.total})})):f.onreadystatechange=function(){switch(f.readyState){case 1:break;case 2:break;case 3:var r,i;try{n.hasSameOrigin(e.url)&&(r=f.getResponseHeader("Content-Length")||0),f.responseText&&(i=f.responseText.length)}catch(s){r=i=0}o.trigger({type:"progress",lengthComputable:!!r,total:parseInt(r,10),loaded:i});break;case 4:f.onreadystatechange=function(){},f.status===0?o.trigger("error"):o.trigger("load")}},t.isEmptyObj(e.headers)||t.each(e.headers,function(e,t){f.setRequestHeader(t,e)}),""!==e.responseType&&"responseType"in f&&("json"===e.responseType&&!u.can("return_response_type","json")?f.responseType="text":f.responseType=e.responseType),v?f.sendAsBinary?f.sendAsBinary(r):function(){var e=new Uint8Array(r.length);for(var t=0;t<r.length;t++)e[t]=r.charCodeAt(t)&255;f.send(e.buffer)}():f.send(r),o.trigger("loadstart")},getStatus:function(){try{if(f)return f.status}catch(e){}return 0},getResponse:function(e){var t=this.getRuntime();try{switch(e){case"blob":var n=new r(t.uid,f.response),i=f.getResponseHeader("Content-Disposition");if(i){var s=i.match(/filename=([\'\"'])([^\1]+)\1/);s&&(l=s[2])}return n.name=l,n;case"json":if(!u.can("return_response_type","json"))return f.status===200?a(f.responseText):null;return f.response;case"document":return p(f);default:return f.responseText!==""?f.responseText:null}}catch(o){return null}},getAllResponseHeaders:function(){try{return f.getAllResponseHeaders()}catch(e){}return""},abort:function(){f&&f.abort()},destroy:function(){e=l=null}})}return e.XMLHttpRequest=f}),i("moxie/runtime/html5/utils/BinaryReader",[],function(){return function(){function r(t,r){var i=e?0:-8*(r-1),s=0,o;for(o=0;o<r;o++)s|=n.charCodeAt(t+o)<<Math.abs(i+o*8);return s}function i(e,t,r){r=arguments.length===3?r:n.length-t-1,n=n.substr(0,t)+e+n.substr(r+t)}function s(t,n,r){var s="",o=e?0:-8*(r-1),u;for(u=0;u<r;u++)s+=String.fromCharCode(n>>Math.abs(o+u*8)&255);i(s,t,r)}var e=!1,n;return{II:function(n){if(n===t)return e;e=n},init:function(t){e=!1,n=t},SEGMENT:function(e,t,r){switch(arguments.length){case 1:return n.substr(e,n.length-e-1);case 2:return n.substr(e,t);case 3:i(r,e,t);break;default:return n}},BYTE:function(e){return r(e,1)},SHORT:function(e){return r(e,2)},LONG:function(e,n){if(n===t)return r(e,4);s(e,n,4)},SLONG:function(e){var t=r(e,4);return t>2147483647?t-4294967296:t},STRING:function(e,t){var n="";for(t+=e;e<t;e++)n+=String.fromCharCode(r(e,1));return n}}}}),i("moxie/runtime/html5/image/JPEGHeaders",["moxie/runtime/html5/utils/BinaryReader"],function(e){return function t(n){var r=[],i,s,o,u=0;i=new e,i.init(n);if(i.SHORT(0)!==65496)return;s=2;while(s<=n.length){o=i.SHORT(s);if(o>=65488&&o<=65495){s+=2;continue}if(o===65498||o===65497)break;u=i.SHORT(s+2)+2,o>=65505&&o<=65519&&r.push({hex:o,name:"APP"+(o&15),start:s,length:u,segment:i.SEGMENT(s,u)}),s+=u}return i.init(null),{headers:r,restore:function(e){var t,n;i.init(e),s=i.SHORT(2)==65504?4+i.SHORT(4):2;for(n=0,t=r.length;n<t;n++)i.SEGMENT(s,0,r[n].segment),s+=r[n].length;return e=i.SEGMENT(),i.init(null),e},strip:function(e){var n,r,s;r=new t(e),n=r.headers,r.purge(),i.init(e),s=n.length;while(s--)i.SEGMENT(n[s].start,n[s].length,"");return e=i.SEGMENT(),i.init(null),e},get:function(e){var t=[];for(var n=0,i=r.length;n<i;n++)r[n].name===e.toUpperCase()&&t.push(r[n].segment);return t},set:function(e,t){var n=[],i,s,o;typeof t=="string"?n.push(t):n=t;for(i=s=0,o=r.length;i<o;i++){r[i].name===e.toUpperCase()&&(r[i].segment=n[s],r[i].length=n[s].length,s++);if(s>=n.length)break}},purge:function(){r=[],i.init(null),i=null}}}}),i("moxie/runtime/html5/image/ExifParser",["moxie/core/utils/Basic","moxie/runtime/html5/utils/BinaryReader"],function(e,n){return function(){function f(e,n){var r=i.SHORT(e),s,o,f,l,c,h,p,d,v=[],m={};for(s=0;s<r;s++){p=h=e+12*s+2,f=n[i.SHORT(p)];if(f===t)continue;l=i.SHORT(p+=2),c=i.LONG(p+=2),p+=4,v=[];switch(l){case 1:case 7:c>4&&(p=i.LONG(p)+u.tiffHeader);for(o=0;o<c;o++)v[o]=i.BYTE(p+o);break;case 2:c>4&&(p=i.LONG(p)+u.tiffHeader),m[f]=i.STRING(p,c-1);continue;case 3:c>2&&(p=i.LONG(p)+u.tiffHeader);for(o=0;o<c;o++)v[o]=i.SHORT(p+o*2);break;case 4:c>1&&(p=i.LONG(p)+u.tiffHeader);for(o=0;o<c;o++)v[o]=i.LONG(p+o*4);break;case 5:p=i.LONG(p)+u.tiffHeader;for(o=0;o<c;o++)v[o]=i.LONG(p+o*4)/i.LONG(p+o*4+4);break;case 9:p=i.LONG(p)+u.tiffHeader;for(o=0;o<c;o++)v[o]=i.SLONG(p+o*4);break;case 10:p=i.LONG(p)+u.tiffHeader;for(o=0;o<c;o++)v[o]=i.SLONG(p+o*4)/i.SLONG(p+o*4+4);break;default:continue}d=c==1?v[0]:v,a.hasOwnProperty(f)&&typeof d!="object"?m[f]=a[f][d]:m[f]=d}return m}function l(){var e=u.tiffHeader;return i.II(i.SHORT(e)==18761),i.SHORT(e+=2)!==42?!1:(u.IFD0=u.tiffHeader+i.LONG(e+=2),o=f(u.IFD0,s.tiff),"ExifIFDPointer"in o&&(u.exifIFD=u.tiffHeader+o.ExifIFDPointer,delete o.ExifIFDPointer),"GPSInfoIFDPointer"in o&&(u.gpsIFD=u.tiffHeader+o.GPSInfoIFDPointer,delete o.GPSInfoIFDPointer),!0)}function c(e,t,n){var r,o,a,f=0;if(typeof t=="string"){var l=s[e.toLowerCase()];for(var c in l)if(l[c]===t){t=c;break}}r=u[e.toLowerCase()+"IFD"],o=i.SHORT(r);for(var h=0;h<o;h++){a=r+12*h+2;if(i.SHORT(a)==t){f=a+8;break}}return f?(i.LONG(f,n),!0):!1}var i,s,o,u={},a;return i=new n,s={tiff:{274:"Orientation",270:"ImageDescription",271:"Make",272:"Model",305:"Software",34665:"ExifIFDPointer",34853:"GPSInfoIFDPointer"},exif:{36864:"ExifVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",36867:"DateTimeOriginal",33434:"ExposureTime",33437:"FNumber",34855:"ISOSpeedRatings",37377:"ShutterSpeedValue",37378:"ApertureValue",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37386:"FocalLength",41986:"ExposureMode",41987:"WhiteBalance",41990:"SceneCaptureType",41988:"DigitalZoomRatio",41992:"Contrast",41993:"Saturation",41994:"Sharpness"},gps:{0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude"}},a={ColorSpace:{1:"sRGB",0:"Uncalibrated"},MeteringMode:{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{1:"Daylight",2:"Fliorescent",3:"Tungsten",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 -5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{0:"Flash did not fire.",1:"Flash fired.",5:"Strobe return light not detected.",7:"Strobe return light detected.",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},ExposureMode:{0:"Auto exposure",1:"Manual exposure",2:"Auto bracket"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{0:"Normal",1:"Soft",2:"Hard"},GPSLatitudeRef:{N:"North latitude",S:"South latitude"},GPSLongitudeRef:{E:"East longitude",W:"West longitude"}},{init:function(e){return u={tiffHeader:10},e===t||!e.length?!1:(i.init(e),i.SHORT(0)===65505&&i.STRING(4,5).toUpperCase()==="EXIF\0"?l():!1)},TIFF:function(){return o},EXIF:function(){var t;t=f(u.exifIFD,s.exif);if(t.ExifVersion&&e.typeOf(t.ExifVersion)==="array"){for(var n=0,r="";n<t.ExifVersion.length;n++)r+=String.fromCharCode(t.ExifVersion[n]);t.ExifVersion=r}return t},GPS:function(){var t;return t=f(u.gpsIFD,s.gps),t.GPSVersionID&&e.typeOf(t.GPSVersionID)==="array"&&(t.GPSVersionID=t.GPSVersionID.join(".")),t},setExif:function(e,t){return e!=="PixelXDimension"&&e!=="PixelYDimension"?!1:c("exif",e,t)},getBinary:function(){return i.SEGMENT()},purge:function(){i.init(null),i=o=null,u={}}}}}),i("moxie/runtime/html5/image/JPEG",["moxie/core/utils/Basic","moxie/core/Exceptions","moxie/runtime/html5/image/JPEGHeaders","moxie/runtime/html5/utils/BinaryReader","moxie/runtime/html5/image/ExifParser"],function(e,t,n,r,i){function s(s){function h(){var e=0,t,n;while(e<=o.length){t=u.SHORT(e+=2);if(t>=65472&&t<=65475)return e+=5,{height:u.SHORT(e),width:u.SHORT(e+=2)};n=u.SHORT(e+=2),e+=n-2}return null}function p(){if(!f||!a||!u)return;f.purge(),a.purge(),u.init(null),o=l=a=f=u=null}var o,u,a,f,l,c;o=s,u=new r,u.init(o);if(u.SHORT(0)!==65496)throw new t.ImageError(t.ImageError.WRONG_FORMAT);a=new n(s),f=new i,c=!!f.init(a.get("app1")[0]),l=h.call(this),e.extend(this,{type:"image/jpeg",size:o.length,width:l&&l.width||0,height:l&&l.height||0,setExif:function(t,n){if(!c)return!1;e.typeOf(t)==="object"?e.each(t,function(e,t){f.setExif(t,e)}):f.setExif(t,n),a.set("app1",f.getBinary())},writeHeaders:function(){return arguments.length?a.restore(arguments[0]):o=a.restore(o)},stripHeaders:function(e){return a.strip(e)},purge:function(){p.call(this)}}),c&&(this.meta={tiff:f.TIFF(),exif:f.EXIF(),gps:f.GPS()})}return s}),i("moxie/runtime/html5/image/PNG",["moxie/core/Exceptions","moxie/core/utils/Basic","moxie/runtime/html5/utils/BinaryReader"],function(e,t,n){function r(r){function f(){var e,t;return e=c.call(this,8),e.type=="IHDR"?(t=e.start,{width:s.LONG(t),height:s.LONG(t+=4)}):null}function l(){if(!s)return;s.init(null),i=a=o=u=s=null}function c(e){var t,n,r,i;return t=s.LONG(e),n=s.STRING(e+=4,4),r=e+=4,i=s.LONG(e+t),{length:t,type:n,start:r,CRC:i}}var i,s,o,u,a;i=r,s=new n,s.init(i),function(){var t=0,n=0,r=[35152,20039,3338,6666];for(n=0;n<r.length;n++,t+=2)if(r[n]!=s.SHORT(t))throw new e.ImageError(e.ImageError.WRONG_FORMAT)}(),a=f.call(this),t.extend(this,{type:"image/png",size:i.length,width:a.width,height:a.height,purge:function(){l.call(this)}}),l.call(this)}return r}),i("moxie/runtime/html5/image/ImageInfo",["moxie/core/utils/Basic","moxie/core/Exceptions","moxie/runtime/html5/image/JPEG","moxie/runtime/html5/image/PNG"],function(e,t,n,r){return function(i){var s=[n,r],o;o=function(){for(var e=0;e<s.length;e++)try{return new s[e](i)}catch(n){}throw new t.ImageError(t.ImageError.WRONG_FORMAT)}(),e.extend(this,{type:"",size:0,width:0,height:0,setExif:function(){},writeHeaders:function(e){return e},stripHeaders:function(e){return e},purge:function(){}}),e.extend(this,o),this.purge=function(){o.purge(),o=null}}}),i("moxie/runtime/html5/image/MegaPixel",[],function(){function e(e,r,i){var s=e.naturalWidth,o=e.naturalHeight,u=i.width,a=i.height,f=i.x||0,l=i.y||0,c=r.getContext("2d");t(e)&&(s/=2,o/=2);var h=1024,p=document.createElement("canvas");p.width=p.height=h;var d=p.getContext("2d"),v=n(e,s,o),m=0;while(m<o){var g=m+h>o?o-m:h,y=0;while(y<s){var b=y+h>s?s-y:h;d.clearRect(0,0,h,h),d.drawImage(e,-y,-m);var w=y*u/s+f<<0,E=Math.ceil(b*u/s),S=m*a/o/v+l<<0,x=Math.ceil(g*a/o/v);c.drawImage(p,0,0,b,g,w,S,E,x),y+=h}m+=h}p=d=null}function t(e){var t=e.naturalWidth,n=e.naturalHeight;if(t*n>1048576){var r=document.createElement("canvas");r.width=r.height=1;var i=r.getContext("2d");return i.drawImage(e,-t+1,0),i.getImageData(0,0,1,1).data[3]===0}return!1}function n(e,t,n){var r=document.createElement("canvas");r.width=1,r.height=n;var i=r.getContext("2d");i.drawImage(e,0,0);var s=i.getImageData(0,0,1,n).data,o=0,u=n,a=n;while(a>o){var f=s[(a-1)*4+3];f===0?u=a:o=a,a=u+o>>1}r=null;var l=a/n;return l===0?1:l}return{isSubsampled:t,renderTo:e}}),i("moxie/runtime/html5/image/Image",["moxie/runtime/html5/Runtime","moxie/core/utils/Basic","moxie/core/Exceptions","moxie/core/utils/Encode","moxie/file/Blob","moxie/runtime/html5/image/ImageInfo","moxie/runtime/html5/image/MegaPixel","moxie/core/utils/Mime","moxie/core/utils/Env"],function(e,t,n,r,i,s,o,u,a){function f(){function m(){if(!c&&!f)throw new n.ImageError(n.DOMException.INVALID_STATE_ERR);return c||f}function g(e){return r.atob(e.substring(e.indexOf("base64,")+7))}function y(e,t){return"data:"+(t||"")+";base64,"+r.btoa(e)}function b(e){var t=this;f=new Image,f.onerror=function(){N.call(this),t.trigger("error",new n.ImageError(n.ImageError.WRONG_FORMAT))},f.onload=function(){t.trigger("load")},f.src=/^data:[^;]*;base64,/.test(e)?e:y(e,p.type)}function w(e,t){var r=this,i;if(!window.FileReader)return t(e.getAsDataURL());i=new FileReader,i.onload=function(){t(this.result)},i.onerror=function(){r.trigger("error",new n.FileException(n.FileException.NOT_READABLE_ERR))},i.readAsDataURL(e)}function E(e,n,r,i){var s=this,o,u,a,f,l,h,p,g,y;v=i,y=this.meta&&this.meta.tiff&&this.meta.tiff.Orientation||1;if(t.inArray(y,[5,6,7,8])!==-1){var b=e;e=n,n=b}h=m(),a=r?Math.max:Math.min,u=a(e/h.width,n/h.height);if(u>1&&(!r||i)){this.trigger("Resize");return}p=Math.round(h.width*u),g=Math.round(h.height*u),c||(c=document.createElement("canvas")),o=c.getContext("2d"),r?(c.width=e,c.height=n):(c.width=p,c.height=g),f=p>c.width?Math.round((p-c.width)/2):0,l=g>c.height?Math.round((g-c.height)/2):0,v||T(c.width,c.height,y),S.call(this,h,c,-f,-l,p,g),this.width=c.width,this.height=c.height,d=!0,s.trigger("Resize")}function S(e,t,n,r,i,s){if(a.OS==="iOS")o.renderTo(e,t,{width:i,height:s,x:n,y:r});else{var u=t.getContext("2d");u.drawImage(e,n,r,i,s)}}function T(e,t,n){switch(n){case 5:case 6:case 7:case 8:c.width=t,c.height=e;break;default:c.width=e,c.height=t}var r=c.getContext("2d");switch(n){case 2:r.translate(e,0),r.scale(-1,1);break;case 3:r.translate(e,t),r.rotate(Math.PI);break;case 4:r.translate(0,t),r.scale(1,-1);break;case 5:r.rotate(.5*Math.PI),r.scale(1,-1);break;case 6:r.rotate(.5*Math.PI),r.translate(0,-t);break;case 7:r.rotate(.5*Math.PI),r.translate(e,-t),r.scale(-1,1);break;case 8:r.rotate(-0.5*Math.PI),r.translate(-e,0)}}function N(){l&&(l.purge(),l=null),h=f=c=null,d=!1}var e=this,f,l,c,h,p,d=!1,v=!0;t.extend(this,{loadFromBlob:function(e){var t=this,r=t.getRuntime(),i=arguments.length>1?arguments[1]:!0;if(!r.can("access_binary"))throw new n.RuntimeError(n.RuntimeError.NOT_SUPPORTED_ERR);if(e.isDetached()){p={name:e.name,size:e.size,type:e.type},h=e.getSource(),b.call(this,h);return}p=e.getSource(),w.call(this,p,function(e){i&&(h=g(e)),b.call(t,e)})},loadFromImage:function(e,t){this.meta=e.meta,p={name:e.name,size:e.size,type:e.type},b.call(this,t?h=e.getAsBinaryString():e.getAsDataURL())},getInfo:function(){var e=this.getRuntime(),t;return!l&&h&&e.can("access_image_binary")&&(l=new s(h)),t={width:m().width||0,height:m().height||0,type:p.type||u.getFileMime(p.name),size:h&&h.length||p.size||0,name:p.name||"",meta:l&&l.meta||this.meta||{}},t},downsize:function(){E.apply(this,arguments)},getAsCanvas:function(){return c&&(c.id=this.uid+"_canvas"),c},getAsBlob:function(t,n){return t!==this.type&&E.call(this,this.width,this.height,!1),new i(null,{type:t,data:e.getAsBinaryString.call(this,t,n)})},getAsDataURL:function(e){var t=arguments[1]||90;if(!d)return f.src;if("image/jpeg"!==e)return c.toDataURL("image/png");try{return c.toDataURL("image/jpeg",t/100)}catch(n){return c.toDataURL("image/jpeg")}},getAsBinaryString:function(t,n){if(!d)return h||(h=g(e.getAsDataURL(t,n))),h;if("image/jpeg"!==t)h=g(e.getAsDataURL(t,n));else{var r;n||(n=90);try{r=c.toDataURL("image/jpeg",n/100)}catch(i){r=c.toDataURL("image/jpeg")}h=g(r),l&&(h=l.stripHeaders(h),v&&(l.meta&&l.meta.exif&&l.setExif({PixelXDimension:this.width,PixelYDimension:this.height}),h=l.writeHeaders(h)),l.purge(),l=null)}return d=!1,h},destroy:function(){e=null,N.call(this),this.getRuntime().getShim().removeInstance(this.uid)}})}return e.Image=f}),i("moxie/runtime/flash/Runtime",["moxie/core/utils/Basic","moxie/core/utils/Env","moxie/core/utils/Dom","moxie/core/Exceptions","moxie/runtime/Runtime"],function(e,t,n,r,i){function u(){var e;try{e=navigator.plugins["Shockwave Flash"],e=e.description}catch(t){try{e=(new ActiveXObject("ShockwaveFlash.ShockwaveFlash")).GetVariable("$version")}catch(n){e="0.0"}}return e=e.match(/\d+/g),parseFloat(e[0]+"."+e[1])}function a(a){var f=this,l;a=e.extend({swf_url:t.swf_url},a),i.call(this,a,s,{access_binary:function(e){return e&&f.mode==="browser"},access_image_binary:function(e){return e&&f.mode==="browser"},display_media:i.capTrue,do_cors:i.capTrue,drag_and_drop:!1,report_upload_progress:function(){return f.mode==="client"},resize_image:i.capTrue,return_response_headers:!1,return_response_type:function(t){return!e.arrayDiff(t,["","text","json","document"])||f.mode==="browser"},return_status_code:function(t){return f.mode==="browser"||!e.arrayDiff(t,[200,404])},select_file:i.capTrue,select_multiple:i.capTrue,send_binary_string:function(e){return e&&f.mode==="browser"},send_browser_cookies:function(e){return e&&f.mode==="browser"},send_custom_headers:function(e){return e&&f.mode==="browser"},send_multipart:i.capTrue,slice_blob:i.capTrue,stream_upload:function(e){return e&&f.mode==="browser"},summon_file_dialog:!1,upload_filesize:function(t){return e.parseSizeStr(t)<=2097152||f.mode==="client"},use_http_method:function(t){return!e.arrayDiff(t,["GET","POST"])}},{access_binary:function(e){return e?"browser":"client"},access_image_binary:function(e){return e?"browser":"client"},report_upload_progress:function(e){return e?"browser":"client"},return_response_type:function(t){return e.arrayDiff(t,["","text","json","document"])?"browser":["client","browser"]},return_status_code:function(t){return e.arrayDiff(t,[200,404])?"browser":["client","browser"]},send_binary_string:function(e){return e?"browser":"client"},send_browser_cookies:function(e){return e?"browser":"client"},send_custom_headers:function(e){return e?"browser":"client"},stream_upload:function(e){return e?"client":"browser"},upload_filesize:function(t){return e.parseSizeStr(t)>=2097152?"client":"browser"}},"client"),u()<10&&(this.mode=!1),e.extend(this,{getShim:function(){return n.get(this.uid)},shimExec:function(e,t){var n=[].slice.call(arguments,2);return f.getShim().exec(this.uid,e,t,n)},init:function(){var n,i,s;s=this.getShimContainer(),e.extend(s.style,{position:"absolute",top:"-8px",left:"-8px",width:"9px",height:"9px",overflow:"hidden"}),n='<object id="'+this.uid+'" type="application/x-shockwave-flash" data="'+a.swf_url+'" ',t.browser==="IE"&&(n+='classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" '),n+='width="100%" height="100%" style="outline:0"><param name="movie" value="'+a.swf_url+'" />'+'<param name="flashvars" value="uid='+escape(this.uid)+"&target="+t.global_event_dispatcher+'" />'+'<param name="wmode" value="transparent" />'+'<param name="allowscriptaccess" value="always" />'+"</object>",t.browser==="IE"?(i=document.createElement("div"),s.appendChild(i),i.outerHTML=n,i=s=null):s.innerHTML=n,l=setTimeout(function(){f&&!f.initialized&&f.trigger("Error",new r.RuntimeError(r.RuntimeError.NOT_INIT_ERR))},5e3)},destroy:function(e){return function(){e.call(f),clearTimeout(l),a=l=e=f=null}}(this.destroy)},o)}var s="flash",o={};return i.addConstructor(s,a),o}),i("moxie/runtime/flash/file/Blob",["moxie/runtime/flash/Runtime","moxie/file/Blob"],function(e,t){var n={slice:function(e,n,r,i){var s=this.getRuntime();return n<0?n=Math.max(e.size+n,0):n>0&&(n=Math.min(n,e.size)),r<0?r=Math.max(e.size+r,0):r>0&&(r=Math.min(r,e.size)),e=s.shimExec.call(this,"Blob","slice",n,r,i||""),e&&(e=new t(s.uid,e)),e}};return e.Blob=n}),i("moxie/runtime/flash/file/FileInput",["moxie/runtime/flash/Runtime"],function(e){var t={init:function(e){this.getRuntime().shimExec.call(this,"FileInput","init",{name:e.name,accept:e.accept,multiple:e.multiple}),this.trigger("ready")}};return e.FileInput=t}),i("moxie/runtime/flash/file/FileReader",["moxie/runtime/flash/Runtime","moxie/core/utils/Encode"],function(e,t){function r(e,n){switch(n){case"readAsText":return t.atob(e,"utf8");case"readAsBinaryString":return t.atob(e);case"readAsDataURL":return e}return null}var n="",i={read:function(e,t){var i=this,s=i.getRuntime();return e==="readAsDataURL"&&(n="data:"+(t.type||"")+";base64,"),i.bind("Progress",function(t,i){i&&(n+=r(i,e))}),s.shimExec.call(this,"FileReader","readAsBase64",t.uid)},getResult:function(){return n},destroy:function(){n=null}};return e.FileReader=i}),i("moxie/runtime/flash/file/FileReaderSync",["moxie/runtime/flash/Runtime","moxie/core/utils/Encode"],function(e,t){function n(e,n){switch(n){case"readAsText":return t.atob(e,"utf8");case"readAsBinaryString":return t.atob(e);case"readAsDataURL":return e}return null}var r={read:function(e,t){var r,i=this.getRuntime();return r=i.shimExec.call(this,"FileReaderSync","readAsBase64",t.uid),r?(e==="readAsDataURL"&&(r="data:"+(t.type||"")+";base64,"+r),n(r,e,t.type)):null}};return e.FileReaderSync=r}),i("moxie/runtime/flash/xhr/XMLHttpRequest",["moxie/runtime/flash/Runtime","moxie/core/utils/Basic","moxie/file/Blob","moxie/file/File","moxie/file/FileReaderSync","moxie/xhr/FormData","moxie/runtime/Transporter","moxie/core/JSON"],function(e,t,n,r,i,s,o,u){var a={send:function(e,r){function a(){e.transport=u.mode,u.shimExec.call(i,"XMLHttpRequest","send",e,r)}function f(e,t){u.shimExec.call(i,"XMLHttpRequest","appendBlob",e,t.uid),r=null,a()}function l(e,t){var n=new o;n.bind("TransportingComplete",function(){t(this.result)}),n.transport(e.getSource(),e.type,{ruid:u.uid})}var i=this,u=i.getRuntime();t.isEmptyObj(e.headers)||t.each(e.headers,function(e,t){u.shimExec.call(i,"XMLHttpRequest","setRequestHeader",t,e.toString())});if(r instanceof s){var c;r.each(function(e,t){e instanceof n?c=t:u.shimExec.call(i,"XMLHttpRequest","append",t,e)});if(!r.hasBlob())r=null,a();else{var h=r.getBlob();h.isDetached()?l(h,function(e){h.destroy(),f(c,e)}):f(c,h)}}else r instanceof n?r.isDetached()?l(r,function(e){r.destroy(),r=e.uid,a()}):(r=r.uid,a()):a()},getResponse:function(e){var n,s,o=this.getRuntime();s=o.shimExec.call(this,"XMLHttpRequest","getResponseAsBlob");if(s){s=new r(o.uid,s);if("blob"===e)return s;if(!!~t.inArray(e,["","text"]))return n=new i,n.readAsText(s);if("arraybuffer"!==e&&"json"===e){n=new i;try{return u(n.readAsText(s))}catch(a){return null}}}return null},abort:function(e){var t=this.getRuntime();t.shimExec.call(this,"XMLHttpRequest","abort"),this.dispatchEvent("readystatechange"),this.dispatchEvent("abort"),!e}};return e.XMLHttpRequest=a}),i("moxie/runtime/flash/runtime/Transporter",["moxie/runtime/flash/Runtime","moxie/file/Blob"],function(e,t){var n={getAsBlob:function(e){var n=this.getRuntime(),r=n.shimExec.call(this,"Transporter","getAsBlob",e);return r?new t(n.uid,r):null}};return e.Transporter=n}),i("moxie/runtime/flash/image/Image",["moxie/runtime/flash/Runtime","moxie/core/utils/Basic","moxie/runtime/Transporter","moxie/file/Blob","moxie/file/FileReaderSync"],function(e,t,n,r,i){var s={loadFromBlob:function(e){function i(e){r.shimExec.call(t,"Image","loadFromBlob",e.uid),t=r=null}var t=this,r=t.getRuntime();if(e.isDetached()){var s=new n;s.bind("TransportingComplete",function(){i(s.result.getSource())}),s.transport(e.getSource(),e.type,{ruid:r.uid})}else i(e.getSource())},loadFromImage:function(e){var t=this.getRuntime();return t.shimExec.call(this,"Image","loadFromImage",e.uid)},getAsBlob:function(e,t){var n=this.getRuntime(),i=n.shimExec.call(this,"Image","getAsBlob",e,t);return i?new r(n.uid,i):null},getAsDataURL:function(){var e=this.getRuntime(),t=e.Image.getAsBlob.apply(this,arguments),n;return t?(n=new i,n.readAsDataURL(t)):null}};return e.Image=s}),i("moxie/runtime/silverlight/Runtime",["moxie/core/utils/Basic","moxie/core/utils/Env","moxie/core/utils/Dom","moxie/core/Exceptions","moxie/runtime/Runtime"],function(e,t,n,r,i){function u(e){var t=!1,n=null,r,i,s,o,u,a=0;try{try{n=new ActiveXObject("AgControl.AgControl"),n.IsVersionSupported(e)&&(t=!0),n=null}catch(f){var l=navigator.plugins["Silverlight Plug-In"];if(l){r=l.description,r==="1.0.30226.2"&&(r="2.0.30226.2"),i=r.split(".");while(i.length>3)i.pop();while(i.length<4)i.push(0);s=e.split(".");while(s.length>4)s.pop();do o=parseInt(s[a],10),u=parseInt(i[a],10),a++;while(a<s.length&&o===u);o<=u&&!isNaN(o)&&(t=!0)}}}catch(c){t=!1}return t}function a(a){var f=this,l;a=e.extend({xap_url:t.xap_url},a),i.call(this,a,s,{access_binary:i.capTrue,access_image_binary:i.capTrue,display_media:i.capTrue,do_cors:i.capTrue,drag_and_drop:!1,report_upload_progress:i.capTrue,resize_image:i.capTrue,return_response_headers:function(e){return e&&f.mode==="client"},return_response_type:i.capTrue,return_status_code:function(t){return f.mode==="client"||!e.arrayDiff(t,[200,404])},select_file:i.capTrue,select_multiple:i.capTrue,send_binary_string:i.capTrue,send_browser_cookies:function(e){return e&&f.mode==="browser"},send_custom_headers:function(e){return e&&f.mode==="client"},send_multipart:i.capTrue,slice_blob:i.capTrue,stream_upload:!0,summon_file_dialog:!1,upload_filesize:i.capTrue,use_http_method:function(t){return f.mode==="client"||!e.arrayDiff(t,["GET","POST"])}},{return_response_headers:function(e){return e?"client":"browser"},return_status_code:function(t){return e.arrayDiff(t,[200,404])?"client":["client","browser"]},send_browser_cookies:function(e){return e?"browser":"client"},send_custom_headers:function(e){return e?"client":"browser"},use_http_method:function(t){return e.arrayDiff(t,["GET","POST"])?"client":["client","browser"]}});if(!u("2.0.31005.0")||t.browser==="Opera")this.mode=!1;e.extend(this,{getShim:function(){return n.get(this.uid).content.Moxie},shimExec:function(e,t){var n=[].slice.call(arguments,2);return f.getShim().exec(this.uid,e,t,n)},init:function(){var e;e=this.getShimContainer(),e.innerHTML='<object id="'+this.uid+'" data="data:application/x-silverlight," type="application/x-silverlight-2" width="100%" height="100%" style="outline:none;">'+'<param name="source" value="'+a.xap_url+'"/>'+'<param name="background" value="Transparent"/>'+'<param name="windowless" value="true"/>'+'<param name="enablehtmlaccess" value="true"/>'+'<param name="initParams" value="uid='+this.uid+",target="+t.global_event_dispatcher+'"/>'+"</object>",l=setTimeout(function(){f&&!f.initialized&&f.trigger("Error",new r.RuntimeError(r.RuntimeError.NOT_INIT_ERR))},t.OS!=="Windows"?1e4:5e3)},destroy:function(e){return function(){e.call(f),clearTimeout(l),a=l=e=f=null}}(this.destroy)},o)}var s="silverlight",o={};return i.addConstructor(s,a),o}),i("moxie/runtime/silverlight/file/Blob",["moxie/runtime/silverlight/Runtime","moxie/core/utils/Basic","moxie/runtime/flash/file/Blob"],function(e,t,n){return e.Blob=t.extend({},n)}),i("moxie/runtime/silverlight/file/FileInput",["moxie/runtime/silverlight/Runtime"],function(e){var t={init:function(e){function t(e){var t="";for(var n=0;n<e.length;n++)t+=(t!==""?"|":"")+e[n].title+" | *."+e[n].extensions.replace(/,/g,";*.");return t}this.getRuntime().shimExec.call(this,"FileInput","init",t(e.accept),e.name,e.multiple),this.trigger("ready")}};return e.FileInput=t}),i("moxie/runtime/silverlight/file/FileDrop",["moxie/runtime/silverlight/Runtime","moxie/core/utils/Dom","moxie/core/utils/Events"],function(e,t,n){var r={init:function(){var e=this,r=e.getRuntime(),i;return i=r.getShimContainer(),n.addEvent(i,"dragover",function(e){e.preventDefault(),e.stopPropagation(),e.dataTransfer.dropEffect="copy"},e.uid),n.addEvent(i,"dragenter",function(e){e.preventDefault();var n=t.get(r.uid).dragEnter(e);n&&e.stopPropagation()},e.uid),n.addEvent(i,"drop",function(e){e.preventDefault();var n=t.get(r.uid).dragDrop(e);n&&e.stopPropagation()},e.uid),r.shimExec.call(this,"FileDrop","init")}};return e.FileDrop=r}),i("moxie/runtime/silverlight/file/FileReader",["moxie/runtime/silverlight/Runtime","moxie/core/utils/Basic","moxie/runtime/flash/file/FileReader"],function(e,t,n){return e.FileReader=t.extend({},n)}),i("moxie/runtime/silverlight/file/FileReaderSync",["moxie/runtime/silverlight/Runtime","moxie/core/utils/Basic","moxie/runtime/flash/file/FileReaderSync"],function(e,t,n){return e.FileReaderSync=t.extend({},n)}),i("moxie/runtime/silverlight/xhr/XMLHttpRequest",["moxie/runtime/silverlight/Runtime","moxie/core/utils/Basic","moxie/runtime/flash/xhr/XMLHttpRequest"],function(e,t,n){return e.XMLHttpRequest=t.extend({},n)}),i("moxie/runtime/silverlight/runtime/Transporter",["moxie/runtime/silverlight/Runtime","moxie/core/utils/Basic","moxie/runtime/flash/runtime/Transporter"],function(e,t,n){return e.Transporter=t.extend({},n)}),i("moxie/runtime/silverlight/image/Image",["moxie/runtime/silverlight/Runtime","moxie/core/utils/Basic","moxie/runtime/flash/image/Image"],function(e,t,n){return e.Image=t.extend({},n)}),i("moxie/runtime/html4/Runtime",["moxie/core/utils/Basic","moxie/core/Exceptions","moxie/runtime/Runtime","moxie/core/utils/Env"],function(e,t,n,r){function o(t){var o=this,u=n.capTest,a=n.capTrue;n.call(this,t,i,{access_binary:u(window.FileReader||window.File&&File.getAsDataURL),access_image_binary:!1,display_media:u(s.Image&&(r.can("create_canvas")||r.can("use_data_uri_over32kb"))),do_cors:!1,drag_and_drop:!1,filter_by_extension:u(function(){return r.browser==="Chrome"&&r.version>=28||r.browser==="IE"&&r.version>=10}()),resize_image:function(){return s.Image&&o.can("access_binary")&&r.can("create_canvas")},report_upload_progress:!1,return_response_headers:!1,return_response_type:function(t){return!!~e.inArray(t,["json","text","document",""])},return_status_code:function(t){return!e.arrayDiff(t,[200,404])},select_file:function(){return r.can("use_fileinput")},select_multiple:!1,send_binary_string:!1,send_custom_headers:!1,send_multipart:!0,slice_blob:!1,stream_upload:function(){return o.can("select_file")},summon_file_dialog:u(function(){return r.browser==="Firefox"&&r.version>=4||r.browser==="Opera"&&r.version>=12||r.browser==="IE"&&r.version>=10||!!~e.inArray(r.browser,["Chrome","Safari"])}()),upload_filesize:a,use_http_method:function(t){return!e.arrayDiff(t,["GET","POST"])}}),e.extend(this,{init:function(){this.trigger("Init")},destroy:function(e){return function(){e.call(o),e=o=null}}(this.destroy)}),e.extend(this.getShim(),s)}var i="html4",s={};return n.addConstructor(i,o),s}),i("moxie/runtime/html4/file/FileInput",["moxie/runtime/html4/Runtime","moxie/core/utils/Basic","moxie/core/utils/Dom","moxie/core/utils/Events","moxie/core/utils/Mime","moxie/core/utils/Env"],function(e,t,n,r,i,s){function o(){function f(){var i=this,l=i.getRuntime(),c,h,p,d,v,m;m=t.guid("uid_"),c=l.getShimContainer(),e&&(p=n.get(e+"_form"),p&&t.extend(p.style,{top:"100%"})),d=document.createElement("form"),d.setAttribute("id",m+"_form"),d.setAttribute("method","post"),d.setAttribute("enctype","multipart/form-data"),d.setAttribute("encoding","multipart/form-data"),t.extend(d.style,{overflow:"hidden",position:"absolute",top:0,left:0,width:"100%",height:"100%"}),v=document.createElement("input"),v.setAttribute("id",m),v.setAttribute("type","file"),v.setAttribute("name","Filedata"),v.setAttribute("accept",u.join(",")),t.extend(v.style,{fontSize:"999px",opacity:0}),d.appendChild(v),c.appendChild(d),t.extend(v.style,{position:"absolute",top:0,left:0,width:"100%",height:"100%"}),s.browser==="IE"&&s.version<10&&t.extend(v.style,{filter:"progid:DXImageTransform.Microsoft.Alpha(opacity=0)"}),v.onchange=function(){var e;if(!this.value)return;this.files?e=this.files[0]:e={name:this.value},o=[e],this.onchange=function(){},f.call(i),i.bind("change",function(){var e=n.get(m),t=n.get(m+"_form"),r;i.files.length&&e&&t&&(r=i.files[0],e.setAttribute("id",r.uid),t.setAttribute("id",r.uid+"_form"),t.setAttribute("target",r.uid+"_iframe")),e=t=null},998),v=d=null,i.trigger("change")},l.can("summon_file_dialog")&&(h=n.get(a.browse_button),r.removeEvent(h,"click",i.uid),r.addEvent(h,"click",function(e){v&&!v.disabled&&v.click(),e.preventDefault()},i.uid)),e=m,c=p=h=null,i.trigger({type:"ready",async:!0})}var e,o=[],u=[],a;t.extend(this,{init:function(e){var t=this,s=t.getRuntime(),o;a=e,u=e.accept.mimes||i.extList2mimes(e.accept,s.can("filter_by_extension")),o=s.getShimContainer(),function(){var i,u,a;i=n.get(e.browse_button),s.can("summon_file_dialog")&&(n.getStyle(i,"position")==="static"&&(i.style.position="relative"),u=parseInt(n.getStyle(i,"z-index"),10)||1,i.style.zIndex=u,o.style.zIndex=u-1),a=s.can("summon_file_dialog")?i:o,r.addEvent(a,"mouseover",function(){t.trigger("mouseenter")},t.uid),r.addEvent(a,"mouseout",function(){t.trigger("mouseleave")},t.uid),r.addEvent(a,"mousedown",function(){t.trigger("mousedown")},t.uid),r.addEvent(n.get(e.container),"mouseup",function(){t.trigger("mouseup")},t.uid),i=null}(),f.call(this),o=null},getFiles:function(){return o},disable:function(t){var r;if(r=n.get(e))r.disabled=!!t},destroy:function(){var t=this.getRuntime(),i=t.getShimContainer();r.removeAllEvents(i,this.uid),r.removeAllEvents(a&&n.get(a.container),this.uid),r.removeAllEvents(a&&n.get(a.browse_button),this.uid),i&&(i.innerHTML=""),e=o=u=a=null}})}return e.FileInput=o}),i("moxie/runtime/html4/file/FileReader",["moxie/runtime/html4/Runtime","moxie/runtime/html5/file/FileReader"],function(e,t){return e.FileReader=t}),i("moxie/runtime/html4/xhr/XMLHttpRequest",["moxie/runtime/html4/Runtime","moxie/core/utils/Basic","moxie/core/utils/Dom","moxie/core/utils/Url","moxie/core/Exceptions","moxie/core/utils/Events","moxie/file/Blob","moxie/xhr/FormData","moxie/core/JSON"],function(e,t,n,r,i,s,o,u,a){function f(){function c(e){var t=this,r,i,o,u,a=!1;if(!l)return;r=l.id.replace(/_iframe$/,""),i=n.get(r+"_form");if(i){o=i.getElementsByTagName("input"),u=o.length;while(u--)switch(o[u].getAttribute("type")){case"hidden":o[u].parentNode.removeChild(o[u]);break;case"file":a=!0}o=[],a||i.parentNode.removeChild(i),i=null}setTimeout(function(){s.removeEvent(l,"load",t.uid),l.parentNode&&l.parentNode.removeChild(l);var n=t.getRuntime().getShimContainer();n.children.length||n.parentNode.removeChild(n),n=l=null,e()},1)}var e,f,l;t.extend(this,{send:function(a,h){function b(){var n=d.getShimContainer()||document.body,i=document.createElement("div");i.innerHTML='<iframe id="'+v+'_iframe" name="'+v+'_iframe" src="javascript:&quot;&quot;" style="display:none"></iframe>',l=i.firstChild,n.appendChild(l),s.addEvent(l,"load",function(){var n;try{n=l.contentWindow.document||l.contentDocument||window.frames[l.id].document,/^4\d{2}\s/.test(n.title)&&n.getElementsByTagName("address").length?e=n.title.replace(/^(\d+).*$/,"$1"):(e=200,f=t.trim(n.body.innerHTML),p.trigger({type:"progress",loaded:f.length,total:f.length}),y&&p.trigger({type:"uploadprogress",loaded:y.size||1025,total:y.size||1025}))}catch(i){if(!r.hasSameOrigin(a.url)){c.call(p,function(){p.trigger("error")});return}e=404}c.call(p,function(){p.trigger("load")})},p.uid)}var p=this,d=p.getRuntime(),v,m,g,y;e=f=null;if(h instanceof u&&h.hasBlob()){y=h.getBlob(),v=y.uid,g=n.get(v),m=n.get(v+"_form");if(!m)throw new i.DOMException(i.DOMException.NOT_FOUND_ERR)}else v=t.guid("uid_"),m=document.createElement("form"),m.setAttribute("id",v+"_form"),m.setAttribute("method",a.method),m.setAttribute("enctype","multipart/form-data"),m.setAttribute("encoding","multipart/form-data"),m.setAttribute("target",v+"_iframe"),d.getShimContainer().appendChild(m);h instanceof u&&h.each(function(e,n){if(e instanceof o)g&&g.setAttribute("name",n);else{var r=document.createElement("input");t.extend(r,{type:"hidden",name:n,value:e}),m.appendChild(r)}}),m.setAttribute("action",a.url),b(),m.submit(),p.trigger("loadstart")},getStatus:function(){return e},getResponse:function(e){if("json"===e){if(t.typeOf(f)==="string")try{return a(f.replace(/^\s*<pre[^>]*>/,"").replace(/<\/pre>\s*$/,""))}catch(n){return null}}else"document"===e;return f},abort:function(){var e=this;l&&l.contentWindow&&(l.contentWindow.stop?l.contentWindow.stop():l.contentWindow.document.execCommand?l.contentWindow.document.execCommand("Stop"):l.src="about:blank"),c.call(this,function(){e.dispatchEvent("abort")})}})}return e.XMLHttpRequest=f}),i("moxie/runtime/html4/image/Image",["moxie/runtime/html4/Runtime","moxie/runtime/html5/image/Image"],function(e,t){return e.Image=t}),u(["moxie/core/utils/Basic","moxie/core/I18n","moxie/core/utils/Mime","moxie/core/utils/Env","moxie/core/utils/Dom","moxie/core/Exceptions","moxie/core/EventTarget","moxie/core/utils/Encode","moxie/runtime/Runtime","moxie/runtime/RuntimeClient","moxie/file/Blob","moxie/file/File","moxie/file/FileInput","moxie/file/FileDrop","moxie/runtime/RuntimeTarget","moxie/file/FileReader","moxie/core/utils/Url","moxie/file/FileReaderSync","moxie/xhr/FormData","moxie/xhr/XMLHttpRequest","moxie/runtime/Transporter","moxie/core/JSON","moxie/image/Image","moxie/core/utils/Events"])})(this),function(){var e={},t=moxie.core.utils.Basic.inArray;return function n(r){var i,s;for(i in r)s=typeof r[i],s==="object"&&!~t(i,["Exceptions","Env","Mime"])?n(r[i]):s==="function"&&(e[i]=r[i])}(window.moxie),e.Env=window.moxie.core.utils.Env,e.Mime=window.moxie.core.utils.Mime,e.Exceptions=window.moxie.core.Exceptions,window.mOxie=e,window.o||(window.o=e),e}();