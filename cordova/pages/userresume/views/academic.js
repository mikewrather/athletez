define(["require","text!userresume/templates/academic.html","text!userresume/templates/gpa.html","text!userresume/templates/test.html","text!userresume/templates/testtopics.html","text!userresume/templates/testlist.html","facade","views","utils","vendor","userresume/collections/gpa","userresume/collections/tests","userresume/collections/academictests","userresume/models/gpa","userresume/models/test"],function(e,t,n,r,i,s){var o,u=e("facade"),a=e("views"),f=a.SectionView,l=e("utils"),c=l.lib.Channel,h=e("vendor"),p=h.Mustache,d=u.$,v=e("userresume/collections/gpa"),m=e("userresume/collections/tests"),g=e("userresume/collections/academictests"),y=e("userresume/models/gpa"),b=e("userresume/models/test"),w=f.extend({events:{"click .edit-gpa":"EditGpa","click .edit-test":"EditTest","click .btn-Add-test":"OpenTestPopUp","change .chk-test-Standardized_h":"AddStandardTest","change .chk-test-AP_h":"AddAPTest","click .btn-finish-test-topic_h":"FinishTest","click .btn-finish-gpa_h":"FinishGpa","blur .txtGpa_h":"SaveGpa","click .btn-delete-gpa":"DeleteGpa","click .btn-Add-gpa":"AddGpa","click .btn-Save-Gpa":"SaveNewGpa","blur .txtTestScore_h":"SaveTestScore","click .btn-delete-test_h":"DeleteTestScore"},controls:{BtnFinishTestTopics:".btn-finish-test-topic_h",BtnEditTest:".edit-test",BtnFinishGpa:".btn-finish-gpa_h",BtnEditGpa:".edit-gpa",BtnSaveGpa:".btn-Save-Gpa",ContainerGpa:"#container-academic-gpa",ContainerStandard:"#container-StandardizedTest",ContainerAP:"#container-ApTest",SectionModalTests:".section-modal-academic-tests_h",SectionTestTopics:".section-test-topics_h",ItemTestTopic:".item-test-topic_h",SectionAddGpa:".section-Add-Gpa",TxtScore:".txtTestScore_h",ModalBox:".tests-modal_h",TxtGpa:".txtGpa_h",TxtGpaYear:".txtGpaYear_h",TxtGpaScore:".txtGpaScore_h",lblError:".error_h",lblSuccess:".success_h"},messages:{dataNotExistGPA:"No GPAs entered yet.",dataNotExistTests:"No Tests entered yet.",YearScoreIsRequired:"Year And Score Are Required.",MandatoryFieldsTest:"Please enter a score."},initialize:function(e){f.prototype.initialize.call(this,e),o=this,o.setOptions(e),this.init()},render:function(){f.prototype.render.call(this)},setOptions:function(e){this.user_id=e.user_id},init:function(){o.setupView()},setupView:function(){o.setUpMainView(),o.setUpGpaView(),o.setUpStandardTestView(),o.setUpAPTestView()},setUpMainView:function(){d(o.el).html(o.template)},setUpGpaView:function(){var e={user_id:o.user_id},t=new v(e);t.user_id=o.user_id,t.fetch(),d.when(t.request).done(function(){if(t.isError())return;o.gpa=t.parseAsRequired();var e=p.to_html(n,{data:o.gpa}),r=d(o.el).find(o.controls.ContainerGpa);r.html(e),parseInt(t.models.length)>0?r.find("a#edit-gpa-btn").css("visibility","visible"):r.find("a#edit-gpa-btn").css("visibility","hidden")})},EditGpa:function(e){d(e.target).parent().find(o.controls.TxtGpa).removeAttr("disabled"),d(e.target).parent().find(o.controls.BtnFinishGpa).fadeIn(),d(e.target).fadeOut()},SaveGpa:function(e){var t=d(e.target).attr("year"),n=d(e.target).val(),r={user_id:o.user_id,gpa:n,year:t},i=new y(r);i.user_id=o.user_id,i.target=d(e.target),i.save()},DeleteGpa:function(e){var t=d(e.target).attr("year"),n={user_id:o.user_id,year:t,id1:1},r=new y(n);r.user_id=o.user_id,r.id1=1,r.action="delete",r.target=d(e.target),r.idAttribute="year",r.destroy({data:{user_id:o.user_id,year:t},success:function(){o.setUpGpaView()}}),d.when(r.request).done(function(){d(e.target).parent().find(o.controls.TxtGpa).val("")})},FinishGpa:function(e){d(e.target).parent().find(o.controls.TxtGpa).attr("disabled","disabled"),d(e.target).parent().find(o.controls.BtnEditGpa).fadeIn(),d(e.target).fadeOut()},AddGpa:function(e){o.$(o.controls.SectionAddGpa).fadeIn().css("display","inline-block")},SaveNewGpa:function(e){var t=o.$(o.controls.SectionAddGpa).find(o.controls.TxtGpaYear).val(),n=o.$(o.controls.SectionAddGpa).find(o.controls.TxtGpaScore).val();if(t==""||n=="")o.$(o.controls.SectionAddGpa).find(o.controls.lblError).html(o.messages.YearScoreIsRequired).fadeIn();else{o.$(o.controls.SectionAddGpa).find(o.controls.lblError).html("").fadeOut();var r={user_id:o.user_id,gpa:n,year:t},i=new y(r);i.user_id=o.user_id,i.target=d(e.target).parent(),i.save(),d.when(i.request).done(function(){o.setUpGpaView()})}},setUpStandardTestView:function(){var e={user_id:o.user_id},t=new m(e);t.user_id=o.user_id,t.includeStandard=1,t.includeAp=0,t.fetch(),d.when(t.request).done(function(){if(t.isError())return;o.standardTests=t.parseAsRequired();var e="";d.each(o.standardTests,function(t,n){e+=n.id+","});var n=p.to_html(r,{Test_Type:"Standardized",TestIds:e});d(o.el).find(o.controls.ContainerStandard).html(n);var s=p.to_html(i,{Test_Type:"Standardized",data:o.standardTests});d(o.el).find(o.controls.ContainerStandard).find(o.controls.SectionTestTopics).html(s),o.setUpStandardTestListAllView()})},setUpStandardTestListAllView:function(){var e={user_id:o.user_id},t=new g(e);t.user_id=o.user_id,t.includeStandard=1,t.includeAp=0,t.fetch(),d.when(t.request).done(function(){if(t.isError())return;o.standardTestsListAll=t.parseAsRequired();if(o.standardTestsListAll.length>0){var e=p.to_html(s,{Test_Type:"Standardized",data:o.standardTestsListAll});d(o.el).find(o.controls.ContainerStandard).find(o.controls.SectionModalTests).html(e)}else o.$el(o.controls.ContainerStandard).find(o.controls.SectionModalTests).html(o.messages.dataNotExistTests)})},AddStandardTest:function(e){var t=d(e.target).attr("testid");if(d(e.target).is(":checked")){var n=[];d.each(o.standardTestsListAll,function(e,r){r.id==t&&n.push(r)});var r=p.to_html(i,{Test_Type:"Standardized",data:n});d(o.el).find(o.controls.ContainerStandard).find(o.controls.SectionTestTopics).append(r)}else d(o.el).find(o.controls.ContainerStandard).find(".item-test-"+t).remove()},setUpAPTestView:function(){var e={user_id:o.user_id},t=new m(e);t.user_id=o.user_id,t.includeStandard=0,t.includeAp=1,t.fetch(),d.when(t.request).done(function(){if(t.isError())return;o.apTests=t.parseAsRequired();var e="";d.each(o.apTests,function(t,n){e+=n.id+","});var n=p.to_html(r,{Test_Type:"AP",TestIds:e});d(o.el).find(o.controls.ContainerAP).html(n);var s=p.to_html(i,{Test_Type:"AP",data:o.apTests});d(o.el).find(o.controls.ContainerAP).find(o.controls.SectionTestTopics).html(s),o.setUpAPTestListAllView()})},setUpAPTestListAllView:function(){var e={user_id:o.user_id},t=new g(e);t.user_id=o.user_id,t.includeStandard=0,t.includeAp=1,t.fetch(),d.when(t.request).done(function(){if(t.isError())return;o.apTestsListAll=t.parseAsRequired();if(o.apTestsListAll.length>0){var e=p.to_html(s,{Test_Type:"AP",data:o.apTestsListAll});d(o.el).find(o.controls.ContainerAP).find(o.controls.SectionModalTests).html(e)}else d(o.el).find(o.controls.ContainerAP).find(o.controls.SectionModalTests).html(o.messages.dataNotExistTests)})},AddAPTest:function(e){var t=d(e.target).attr("testid");if(d(e.target).is(":checked")){var n=[];d.each(o.apTestsListAll,function(e,r){r.id==t&&n.push(r)});var r=p.to_html(i,{Test_Type:"Standardized",data:n});d(o.el).find(o.controls.ContainerAP).find(o.controls.SectionTestTopics).append(r)}else d(o.el).find(o.controls.ContainerAP).find(".item-test-"+t).remove()},EditTest:function(e){d(e.target).parents(o.controls.ItemTestTopic).find(o.controls.TxtScore).removeAttr("disabled"),d(e.target).parents(o.controls.ItemTestTopic).find(o.controls.BtnFinishTestTopics).fadeIn(),d(e.target).fadeOut()},FinishTest:function(e){d(e.target).parents(o.controls.ItemTestTopic).find(o.controls.TxtScore).attr("disabled","disabled"),d(e.target).parents(o.controls.ItemTestTopic).find(o.controls.BtnEditTest).fadeIn(),d(e.target).fadeOut()},OpenTestPopUp:function(e){var t=d(e.target).attr("testids"),n=t.split(",");d.each(n,function(t,n){o.$(e.target).parent().find(o.controls.ModalBox).find(".chk-"+n).attr("checked","checked")}),o.$(e.target).parent().find(o.controls.ModalBox).modal("show")},SaveTestScore:function(e){var t=d(e.target).attr("topicId"),n=d(e.target).val(),r=d(e.target).attr("initial"),i="save";if(d.trim(n)==""){d(e.target).parent().find(o.controls.lblError).html(o.messages.MandatoryFieldsTest).fadeIn();return}d(e.target).parent().find(o.controls.lblError).html("").fadeOut();var s={id1:o.user_id,academics_topics_id:t,score:n,users_id:o.user_id};r!=""&&(i="update",s.academics_tests_topics_id=t);var u=d(e.target).attr("testscoreid"),a=new b(s);a.users_id=o.user_id,a.action=i,a.target=d(e.target),a.save({success:function(){}}),d.when(a.request).done(function(){d(e.target).attr("initial",n)})},DeleteTestScore:function(e){var t=d(e.target).attr("topicid"),n={users_id:o.user_id,id1:1,academics_tests_topics_id:t},r=new b(n);r.users_id=o.user_id,r.id1=o.user_id,r.academics_tests_topics_id=t,r.action="delete",r.target=d(e.target),r.destroy({data:{users_id:o.user_id,academics_tests_topics_id:t},success:function(){d(e.target).val("").attr("initial","")}}),d.when(r.request).done(function(){d(e.target).parent().find(o.controls.TxtScore).val("")})}});return w});