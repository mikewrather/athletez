define(["require","text!registration/templates/find_my_club.html","facade","views","utils","models/base","jqueryui","registration/collections/states","registration/collections/sports","registration/collections/clubs"],function(e,t){var n,r=e("facade"),i=e("views"),s=e("utils"),o=e("models/base");return BaseView=i.BaseView,_=r._,$=r.$,Channel=s.lib.Channel,RegistrationStatesCollection=e("registration/collections/states"),RegistrationSportsCollection=e("registration/collections/sports"),RegistrationClubsCollection=e("registration/collections/clubs"),n=BaseView.extend({id:"find-my-club",tagName:"div",className:"find-my-club",template:t,events:{"click .back":"closeView","click .not-find":"notFind","click .continue":"highSchoolView","keyup #states_id":"keyupState","keyup #sports_id":"keyupSport","keyup #orgs_id":"keyupClub","blur #states_id":"changeState","blur #sports_id":"changeSport","change #orgs_id":"changeClub"},states:[],states_id:"",sports:[],sports_id:"",clubs:[],clubs_id:"",setOptions:function(e){if(!this.model)throw new Error("RegistrationFindMyClubView expected options.model.")},initialize:function(e){BaseView.prototype.initialize.call(this,e)},render:function(){var e=this;BaseView.prototype.render.call(this)},closeView:function(e){e.preventDefault(),Channel("registration-close-clubview").publish()},notFind:function(e){e.preventDefault()},highSchoolView:function(e){e.preventDefault()},keyUp:function(e){switch(this.$(e.target).attr("id")){case"state":this.keyupState(e);break;case"sport":this.keyupSport(e);break;case"club":this.keyupClub(e)}},keyupState:function(e){var t=this,n=this.$("#states_id").val(),r=[];if(n!=""){var i=new RegistrationStatesCollection;i.state_name=n,$(e.target).addClass("ui-autocomplete-loading"),i.fetch(),$.when(i.request).done(function(){if(i.isError())return;var e=i.toJSON();(e==null||e.length<1)&&t.$("#states_id").parent().find(".field-message").html("Couldn't find any matches").stop().fadeIn(),t.states=[];for(var n in e)t.states.push(e[n].payload);debug.log("self.states",t.states),t.states.forEach(function(e,t){r.push(e.name)}),debug.log("stateArr",r),t.$("#states_id").autocomplete({source:r})})}},changeState:function(e){var t=this.$("#states_id").val(),n=this;n.states_id="",n.states.forEach(function(e,r){e["name"]==t&&(n.states_id=e.id)}),this.keyupClub()},keyupSport:function(e){var t=this,n=t.model,r="all";n.get("payload").gender&&(r=n.get("payload").gender);var i=this.$("#sports_id").val(),s=[];if(i!=""){var o=new RegistrationSportsCollection;o.sport_name=i,o.gender=r,$(e.target).addClass("ui-autocomplete-loading"),o.fetch(),$.when(o.request).done(function(){if(o.isError())return;var e=o.toJSON();console.log("Sports Model",e),(e==null||e.length<1)&&t.$("#sports_id").parent().find(".field-message").html("Couldn't find any matches").stop().fadeIn(),t.sports=[];for(var n in e)t.sports.push(e[n].payload);console.log("sports",t.sports),t.sports.forEach(function(e,t){s.push(e.sport_name)}),console.log("sportArr",s),t.$("#sports_id").autocomplete({source:s})})}},changeSport:function(e){var t=this.$("#sports_id").val(),n=this;n.sports_id="",n.sports.forEach(function(e,r){e["sport_name"]==t&&(n.sports_id=e.sport_id)}),this.keyupClub()},keyupClub:function(e){var t=this,n=this.$("#orgs_id").val(),r=[];if(n!=""){var i=new RegistrationClubsCollection;console.log(t.states_id,t.sports_id,n),i.states_id=t.states_id,i.sports_id=t.sports_id,i.club_name=n,$(e.target).addClass("ui-autocomplete-loading"),i.fetch(),$.when(i.request).done(function(){if(i.isError())return;var e=i.toJSON();console.log("models",e),(e==null||e.length<1)&&t.$("#orgs_id").parent().find(".field-message").html("Couldn't find any matches").stop().fadeIn(),t.clubs=[];for(var n in e)t.clubs.push(e[n].payload);t.clubs.forEach(function(e,t){r.push(e.org_name)}),console.log("clubArr",r),t.$("#orgs_id").autocomplete({source:r})})}},changeClub:function(e){var t=this.$("#orgs_id").val(),n=this;n.clubs_id=0,n.clubs.forEach(function(e,r){e["name"]==t&&(n.clubs_id=e.id)})}}),n});