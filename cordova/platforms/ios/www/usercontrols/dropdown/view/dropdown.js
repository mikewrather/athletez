define(["require","text!usercontrol/dropdown/template/layout.html","text!usercontrol/dropdown/template/layout-mobile.html","facade","views","utils","vendor"],function(e,t,n){var r,i=e("facade"),s=e("views"),o=s.SectionView,u=e("utils"),a=u.lib.Channel,f=e("vendor"),l=f.Mustache,c=i.$,h=s.BaseView,p=i.Backbone,d,v;return d=p.View.extend({template:t,multiple:!1,selectedOptions:[],className:"dropdown-wrapper",events:{"click .up-down-arrow-h":"showDropdown","click li a":"selectOptions"},selectOptions:function(e){var t=c(e.target).data("id");this.multiple?this.setMultipleOptions(t,e):this.setSingleOption(t,e),this.showSelectedValue(),this.callback&&this.callback(this.selectedOptions)},showSelectedValue:function(){var e=this.$el.find(".common-dropdown li.selected").text()||this.title;this.$el.find(".dropdown-header-box").html(e)},setMultipleOptions:function(e,t){var n=this.checkifExists(e);n==-1?(c(t.target).parent().addClass("selected"),this.selectedOptions.push(e)):(c(t.target).parent().removeClass("selected"),this.selectedOptions.splice(n,1))},setSingleOption:function(e,t){var n=this.checkifExists(e);n==-1&&(this.selectedOptions=[],console.log(this.$el.find(".common-dropdown li")),this.$el.find(".common-dropdown li").removeClass("selected"),c(t.target).parent().addClass("selected"),this.selectedOptions.push(e),this.$el.find(".hidden-input-dropdown-h").val(e),this.hideDropdown())},checkifExists:function(e){var t=-1;for(var n in this.selectedOptions)if(this.selectedOptions[n]==e){t=n;break}return t},initialize:function(e){v=this,r=this,this.template=routing.mobile?n:t,this.selectedOptions=[],r.setOptions(e),this.render(),this.$el.find(".hidden-input-dropdown-h").attr("id",this.elementId)},hideDropdown:function(e){if(!e||!this.$el.find(c(e.target)).parents(".dropdown-container").length)this.$el.find(".dropdown-container").removeClass("increase-dropown-zindex"),this.$el.find(".up-down-arrow-h span").removeClass("icon-chevron-up").addClass("icon-chevron-down"),this.$el.find(".common-dropdown").slideUp()},showDropdown:function(e){e.preventDefault();var t=this;c(e.currentTarget).find("span").hasClass("icon-chevron-down")?(c(e.currentTarget).find("span").removeClass("icon-chevron-down").addClass("icon-chevron-up"),c(".dropdown-container").removeClass("increase-dropown-zindex"),t.$el.find(".dropdown-container").addClass("increase-dropown-zindex"),c("html").bind("click",function(e){t.hideDropdown(e)})):(t.$el.find(".dropdown-container").removeClass("increase-dropown-zindex"),c(e.currentTarget).find("span").removeClass("icon-chevron-up").addClass("icon-chevron-down")),c(e.currentTarget).parents(".dropdown-container").find(".common-dropdown").slideToggle()},getRecordId:function(){return this.payload[v.data.recordId]},defaultSelected:function(e){if(v.multiple){if(_.isArray(v.selectedValue))for(var t in v.selectedValue)if(v.selectedValue[t]==this.payload[v.data.recordId])return"selected"}else if(v.selectedValue&&v.selectedValue==this.payload[v.data.recordId])return"selected"},getRecordValue:function(){return this.payload[v.data.recordValue]},render:function(){this.data.dropView=this;if(!this.selectedValue){if(this.data.records.length)var e=this.data.records[0].payload[this.data.recordId];this.multiple?(this.selectedValue=[],this.selectedValue.push(e)):this.selectedValue=e}var t=this,n=l.to_html(t.template,this.data);return c(t.el).html(n),this.targetView.$el.find(this.destination).html(this.el),routing.mobile||(this.$el.find(".hidden-input-dropdown-h").val(this.selectedValue),this.selectedOptions.push(this.selectedValue),this.showSelectedValue(),c("#"+this.elementId).length?t.callback&&t.callback(this.selectedOptions):setTimeout(function(){if(!t.$el.find("li.selected").length){var e=t.$el.find(".common-dropdown li:first-child");e.addClass("selected"),t.$el.find("#"+t.elementId).val(e.find("a").data("id")),t.showSelectedValue()}t.callback&&t.callback(t.selectedOptions)},200)),!0},setOptions:function(e){for(var t in e)this[t]=e[t]}}),d});