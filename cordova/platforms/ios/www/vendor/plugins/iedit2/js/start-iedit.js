$(function(){function r(e,t){$(".display-main").empty(),$(".extra-tools").hide(),$("#page-title").empty(),$("#page-title").append(e),$(".nav").find("a").removeClass("selected"),$(document).find("#"+t).addClass("selected")}var e=!1,t="",n="";$("#show-iedit").click(function(){var i='<div id="image-editor"><div class="main"><table cellspacing="0" cellpadding="0"><tr><td><div class="content"><div id="menu-frame"><div class="header"><h1 id="page-title"></h1><a id="iedit-close" class="x" title="close"></a></div><div class="sub"><div class="nav"><a id="view-link"><p>View Image</p></a><a id="edit-link"><p>Edit Image</p></a><a id="upload-link"><p>Upload Image</p></a><a id="library-link"><p>Choose From Library</p></a></div><div class="extra-tools"></div></div><div class="display-main"></div></div></div></td></tr></table></div><div class="mask"></div></div>';$("body").html(i),r("View Image","view-link");var i='<table cellspacing="0" cellpadding="0" class="image-display show"><tr><td class="displayzone"><div class="container"><div class="head"><h1>Banner Image</h1></div><img id="displayonly" src="'+n+'">'+'<div class="nav"><a id="goEdit">Edit Image</a></div>'+"</div>"+"</td></tr>"+"</table>";$(".display-main").append(i),$(".nav").find("#goEdit").bind("click",function(){r("Edit Image","edit-link"),$("#image-editor").iedit("start",{viewportWidth:700,viewportHeight:300,startX:0,startY:0,startZoom:100,title:"Banner Image",original:t,edited:n}),$(".extra-tools").show()}),$("#view-link").click(function(){r("View Image","view-link");var e='<table cellspacing="0" cellpadding="0" class="image-display show"><tr><td class="displayzone"><div class="container"><div class="head"><h1>Banner Image</h1></div><img id="displayonly" src="'+n+'">'+'<div class="nav"><a id="goEdit">Edit Image</a></div>'+"</div>"+"</td></tr>"+"</table>";$(".display-main").append(e),$(".nav").find("#goEdit").bind("click",function(){r("Edit Image","edit-link"),$("#image-editor").iedit("start",{viewportWidth:700,viewportHeight:300,startX:0,startY:0,startZoom:100,title:"Banner Image",original:t,edited:n}),$(".extra-tools").show()})}),$("#upload-link").click(function(){r("Upload Image","upload-link"),$(".fileupload-buttonbar").show(),$("#dragtext").show();var i='<table cellspacing="0" cellpadding="0" class="image-edit show"><tr><td class="panzone"><div class="dropzone"><p id="dragtext">Drag an image here<br /><br />Or<br /><br /></p><form id="fileupload" action="server/upload.php" method="POST" enctype="multipart/form-data"><div class="fileupload-buttonbar"><span class="btn btn-success fileinput-button"><span>Choose an image...</span><input type="file" name="files[]"></span></div></form><div class="progress-container"><div id="progress"><div class="bar"></div></div></div></div></td></tr></table>';$(".display-main").append(i),$("#fileupload").fileupload({dataType:"json",autoUpload:"true",progressall:function(e,t){$("#upload-error").remove(),$(".fileupload-buttonbar").hide(),$("#dragtext").hide(),$("#progress").show();var n=parseInt(t.loaded/t.total*100,10);$("#progress .bar").css("width",n+"%")}}),$("#fileupload").fileupload("option","redirect",window.location.href.replace(/\/[^\/]*$/,"/server/result.html?%s")),$("#fileupload").bind("fileuploadalways",function(i,s){var o=$.parseJSON(s.jqXHR.responseText);if(o==null)var o=s.result;if(o!=null)if(typeof o.error!="undefined"){$("#progress").hide();var u='<div id="upload-error">There was an error during the upload. Please try again.</div>';$(".panzone").append(u)}else{var a=o.url;r("Edit Image","edit-link"),t=a,e===!0&&$("#image-editor").iedit("destroy"),$("#image-editor").iedit("start",{viewportWidth:700,viewportHeight:300,startX:0,startY:0,startZoom:100,title:"Banner Image",original:a,edited:n}),$(".extra-tools").show()}}),$(document).bind("dragover",function(e){var t=$(".dropzone"),n=window.dropZoneTimeout;n?clearTimeout(n):t.addClass("in"),e.target===t[0]?t.addClass("hover"):t.removeClass("hover"),window.dropZoneTimeout=setTimeout(function(){window.dropZoneTimeout=null,t.removeClass("in hover")},100)})}),$("#edit-link").click(function(){r("Edit Image","edit-link"),$("#image-editor").iedit("start",{viewportWidth:700,viewportHeight:300,startX:0,startY:0,startZoom:100,title:"Banner Image",original:t,edited:n}),$(".extra-tools").show();var e=!0}),$("#library-link").click(function(){r("Choose From Library","library-link")}),$(document).find("#iedit-close").click(function(){$("#image-editor").remove()})})});