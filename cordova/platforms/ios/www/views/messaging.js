define(["facade","views/base","utils"],function(e,t,n){var r,i=e.$,s=e._,o=n.debug;return r=t.extend({initialize:function(e){s.bindAll(this),e=e||{},this.display=e.display&&s.isFunction(e.display)?e.display:alert;if(!e.collection)throw new Error("MessageView expected collection option");this.collection.on("add",this.checkNew),this.checkNew()},render:function(){var e=this.model.get("message"),t=this.model.get("buttons");this.display(e,t),this.model.set({state:"displayed"},{silent:!0})},wrapCallback:function(){var e=this.model,t=e.get("buttons");s.each(t,function(t){var n=s.wrap(t.callback,function(t){return e.set({state:"done"}),t(),t});t.callback=n}),e.set({buttons:t},{silent:!0})},checkNew:function(){var e=this.collection.find(function(e){return e.get("state")==="new"});e&&(this.model=e,this.wrapCallback(),this.render())}}),r});