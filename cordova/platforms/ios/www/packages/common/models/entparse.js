define(["models","facade"],function(e,t){var n=e.BaseModel,r=t.Backbone,i=t.$,s=t._;return n.extend({mpay:{},thumb_size:220,display_width:220,display_height:220,parsedData:{},initialize:function(e){e.mpay&&(this.mpay=e.mpay),e.thumb_size&&(this.thumb_size=e.thumb_size),e.display_width&&(this.display_width=e.display_width),e.display_height&&(this.display_height=e.display_height),this.parseResult()},ucwords:function(e){return e=e.toLowerCase(),e.replace(/(^([a-zA-Z\p{M}]))|([ -][a-zA-Z\p{M}])/g,function(e){return e.toUpperCase()})},findCorrectType:function(e){var t=!1,n=this;s.each(e,function(e){t=t||e,e.height>=n.display_height&&e.width>=n.display_width&&(t.height<n.display_height&&t.width<n.display_width?t=e:t.height>e.height&&t.width>e.width&&(t=e))}),this.closest_image_format=t},parseResult:function(){var e=this,t=this.mpay,n={_enttypes_id:t.enttypes_id,_id:t.id,_has_voted:t.has_voted,_is_following:t.is_following,_can_follow:t.can_follow,show_play:!1,show_delete:!1,show_edit:!1};switch(t.enttypes_id){case"23":n=e.parse_video(t,n);break;case"21":n=e.parse_image(t,n);break;case"1":n=e.parse_user(t,n);break;case"8":n=e.parse_game(t,n);break;case"2":n=e.parse_org(t,n);break;case"5":n=e.parse_team(t,n)}e.closest_image_format!="undefined"&&e.closest_image_format!=null?n=e.imageFormat(n):n.imgData="",e.parsedData=n},get_selected_icon:function(e,t){if(!t)var t="large";if(t=="large")var n=e.large_icon;if(t=="small")var n=e.small_icon;return n.split(".png")[0]+"_selected.png"},parse_team:function(e,t){return typeof e.picture_obj=="object"&&e.picture_obj!=null&&typeof e.picture_obj.types=="object"&&this.findCorrectType(e.picture_obj.types),t._noicon_text=e.org_name,t._color="#928add",t._sports_icon=this.get_selected_icon(e.org_sport_link_obj.sport),t._label=e.complevels_obj.abbr+" "+e.org_sport_link_obj.sport.sport_name+" "+e.year,t._sublabel="Votes: "+e.num_votes+", Followers: "+e.num_followers,t._link="/#!team/"+e.id,t._has_link=!0,e.hasOwnProperty("is_owner")&&(t.show_delete=e.is_owner),t.itemtype="http://schema.org/Organization",t.meta=[{itemprop:"name",content:e.team_name},{itemprop:"address",content:e.team_location},{itemprop:"url",content:t._link}],t},parse_org:function(e,t){return t._noicon_text="org",t._color="#928add",t._label=e.name,t._sublabel="Votes: "+e.num_votes+", Followers: "+e.num_followers,t._link="/#!team/"+e.id,t._has_link=!0,e.hasOwnProperty("is_owner")&&(t.show_delete=e.is_owner),t.itemtype="http://schema.org/Organization",t.meta=[{itemprop:"name",content:e.org_name},{itemprop:"address",content:e.org_location},{itemprop:"url",content:t._link}],t},parse_user:function(e,t){return typeof e.user_picture_obj=="object"&&typeof e.user_picture_obj.types=="object"&&this.findCorrectType(e.user_picture_obj.types),parseInt(e.usl_game_link_id)>0&&(t.usl_game_link_id=e.usl_game_link_id,t.usl_enttype_id=e.usl_enttype_id),e.can_edit==1&&(t.show_edit=!0),e.result_time&&e.result_time!="00:00:00:00"?t._sublabel="Result Time: "+e.result_time:t._sublabel="Votes: "+e.num_votes+", Followers: "+e.num_followers,t._noicon_text="hi",t._color="#c4df89",t._label=e.label,t._link="/#!profile/"+e.id,t._has_link=!0,e.hasOwnProperty("is_owner")&&(t.show_delete=e.is_owner),t.itemtype="http://schema.org/Person",t.meta=[{itemprop:"name",content:e.name},{itemprop:"url",content:t._link}],t},parse_video:function(e,t){return typeof e.standard_thumb=="object"?(this.closest_image_format=e.standard_thumb,t._thumbnail=this.closest_image_format.url):t._thumbnail=e.thumbs,t.show_play=!0,t._enttypes_id=typeof (e.media=="object")?e.media.enttypes_id:0,t._id=typeof (e.media=="object")?e.media.id:0,t._label=e.media.name,t._link="javascript: void(0);",t._has_link=!1,e.media.hasOwnProperty("is_owner")&&(t.show_delete=e.media.is_owner),t._noicon_text="play",t._color="#e27171",t},parse_image:function(e,t){t._enttypes_id=typeof (e.media_obj=="object")?e.media_obj.enttypes_id:0,t._id=typeof (e.media_obj=="object")?e.media_obj.id:0,typeof e.types=="object"&&this.findCorrectType(e.types);var n=!s.isUndefined(e.media_obj.users_obj)&&!s.isUndefined(e.media_obj.users_obj.label)?e.media_obj.users_obj.label:!1;if(typeof e.media_obj.sports_obj=="object"){var r;parseInt(e.media_obj.sports_obj.male)==1&&parseInt(e.media_obj.sports_obj.female)==0?r="Men's ":parseInt(e.media_obj.sports_obj.female)==1&&parseInt(e.media_obj.sports_obj.male)==0?r="Women's ":parseInt(e.media_obj.sports_obj.male)==1&&parseInt(e.media_obj.sports_obj.female)==1&&(r="Coed "),r+=this.ucwords(e.media_obj.sports_obj.sport_name)}return t._sublabel=[],n&&t._sublabel.push({label:"Uploaded by "+n}),r&&t._sublabel.push({label:"Sport: "+r}),t.itemtype="http://schema.org/Person",t.meta=[{itemprop:"name",content:n||""}],t._link="javascript: void(0);",t._has_link=!1,e.media_obj.hasOwnProperty("is_owner")&&(t.show_delete=e.media_obj.is_owner),t._noicon_text="look",t._color="#dfe271",t},parse_game:function(e,t){return t._detailclass="game",typeof e.game_picture=="object"&&e.game_picture!=null&&typeof e.game_picture.types=="object"&&(this.findCorrectType(e.game_picture.types),t._thumbnail=this.closest_image_format.url),e.sports_obj&&(t._sports_icon=this.get_selected_icon(e.sports_obj)),t._label=e.game_name,t._link="/#!game/"+e.id,t._has_link=!0,e.hasOwnProperty("is_owner")&&(t.show_delete=e.is_owner),t._sublabel=e.full_date,t._noicon_text="vs",t._color="#e49f6f",t},imageFormat:function(e){var t=this;e._thumbnail=this.closest_image_format.url;var n=t.closest_image_format,r=n.width/this.display_width,i=n.height/this.display_height;n.width=parseInt(n.width),n.height=parseInt(n.height);var s=n.width>n.height?-(n.width/i-this.display_width)/2:-(n.height/r-this.display_height)/2;return s>0&&(s=0),n.width>n.height?(n.maxwidth=n.width/i,n.left=s):(n.maxheight=n.height/r,n.top=s),e.imgData=n,e}})});