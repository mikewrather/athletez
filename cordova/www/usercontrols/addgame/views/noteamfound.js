define(["require","facade","views","utils","vendor","usercontrol/addgame/collections/orgs","usercontrol/addgame/views/neworg","usercontrol/addgame/views/orgchoose","usercontrol/addgame/models/opponent","vendor/plugins/spin.min","component/forms"],function(e){var t,n=e("facade"),r=e("views"),i=r.SectionView,s=e("utils"),o=s.lib.Channel,u=e("vendor"),a=u.Mustache,f=n.$,l=e("vendor/plugins/spin.min"),c=e("usercontrol/addgame/collections/orgs"),h=e("usercontrol/addgame/views/neworg"),p=e("usercontrol/addgame/views/orgchoose"),d=e("usercontrol/addgame/models/opponent"),v=e("component/forms"),m=r.BaseView,g=n.Backbone,y;return g.View.extend({template:"",events:{"click #add_team_2-h":"addTeamToNewOrg"},initialize:function(e){y=this,y.setOptions(e);var t=new c;t.org_name=y.search_text,t.states_id=y.states_id,t.sports_club=y.sports_club,t.single_sport_id=y.teamOneModel.get("payload").org_sport_link_obj.org.single_sport_id,t.fetch(),f.when(t.request).done(function(e){e.payload&&e.payload.length?(y.destination.find("div#dynamic_add_org").length||y.destination.append('<div id="dynamic_add_org"></div>'),y.destination.find("div#dynamic_add_team_2").remove(),y.orgChoose=new p({el:f("div#dynamic_add_org"),user_text:y.search_text,data:e.payload,seasoninfo:{complevel:y.teamOneModel.get("payload").complevels_obj.complevel_name,complevels_id:y.teamOneModel.get("payload").complevels_id,seasons_id:y.teamOneModel.get("payload").seasons_id,season:y.teamOneModel.get("payload").seasons_obj.season_name,year:y.teamOneModel.get("payload").year,sports_id:y.sports_id},parentView:y})):(y.destination.find("div#dynamic_add_org").remove(),y.destination.find("div#dynamic_add_team_2").length||y.destination.append('<div id="dynamic_add_team_2"></div>'),y.newOrgView=new h({el:y.destination.find("#dynamic_add_team_2"),search_text:y.search_text,parentView:y}))})},render:function(){var e=_.template(this.template,{});this.$el.html(e)},setOptions:function(e){for(var t in e)this[t]=e[t];console.log(this.teamOneModel)},destroy_view:function(){this.undelegateEvents(),this.$el.removeData().unbind(),_.isUndefined(this.newOrgView)||this.newOrgView.destroy_view(),_.isUndefined(this.orgChoose)||this.orgChoose.destroy_view(),this.remove(),g.View.prototype.remove.call(this)},setTeamTwoToNewTeam:function(e){y.destination.find("div#dynamic_add_team_2").remove(),y.destination.find("div#dynamic_add_org").remove(),y.destination.find("span.indicator-h").removeClass("invalid").addClass("valid"),f('input[name="Select_Team_2"]').val(e.get("payload").team_name),f('input[name="Select_Team_2"]').attr("data-id",e.get("payload").id),this.formval_this.callback(e.get("payload").id),this.formval_this.afterSetValue("show")},setupOrgLocationForm:function(e){var t=this,n=f(e).parent().html('<div id="neworg-location-form"></div>'),r=new v({Location:{tooltip:"Enter the location of the opponent organization.  You can enter an address, or, if you don't know it, just a city or state.",form_values:{serverKey:"locations_id",post_to_server:!0,serverDbField:"locations_id"},type:"Location",label:'Enter the location of "'+this.search_text+'"',validators:[{type:"required",message:"Please select location."}]},submit:{type:"Submit",fieldClass:"button-field",attr:{value:"Add New Club"},showLable:!1,onSubmit:function(e){var n=i.commit();if(n)for(var r in n){var s=f("*[name="+r+"]"),o=s.position();s.parents(".common-modal #modalBody").animate({scrollTop:o.top},"500",function(){s.addClass("focus-error-animation"),setTimeout(function(){s.removeClass("focus-error-animation")},2e3)});break}else{var u={lines:15,length:5,width:2,radius:3,corners:1,rotate:0,direction:1,color:"#000",speed:.6,trail:60,shadow:!1,hwaccel:!0,className:"spinner",zIndex:2e9},a=(new l(u)).spin();f(e.currentTarget).append(a.el);if(!confirm("This will add "+t.search_text+" "+t.teamOneModel.get("payload").complevels_obj.complevel_name+" "+t.teamOneModel.get("payload").org_sport_link_obj.sport.sport_name+" "+t.teamOneModel.get("payload").seasons_obj.season_name+" "+t.teamOneModel.get("payload").year+".  Continue?"))return a.stop(),f(e.currentTarget).removeClass("region-loader").on("click",addTeamToNewOrg),!1;var c=t.formValues.getFormValues(),h=t.teamOneModel.get("payload").id,p=new d({id:h,name:t.search_text,locations_id:c.locations_id});p.save(),f.when(p.request).done(function(e){return t.setTeamTwoToNewTeam(p),!0})}}}},n.find("#neworg-location-form")),i=r.form;this.formValues=r.formValues},addTeamToNewOrg:function(e){var t=this,n=f(e.currentTarget).html();f(e.currentTarget).addClass("region-loader").off("click"),console.error(e),this.setupOrgLocationForm(e.currentTarget)}})});