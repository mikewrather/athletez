(function(e){var t,n,r,i,s,o,u,a,f,l,c=151,h=0,p="ffffff",d=function(){return t=0,n=0,r=0,i=0,s=0,o=0,!0},v=function(e){var t=parseInt(e.parent().css("min-height")),n=e.height(),r=0;return n<t&&(r=(t-n)/2),e.css("margin-top",r+"px"),!0},m,g;g={init:function(c){function w(t,n){m.slider.slider("enable"),n.width()>m.min_width?(m.fit_percent=E(n),m.fit_percent!=0&&e(".fit-description").text("Image in "+m.fit_percent+"% of actual resolution to fit screen").removeClass("none")):(e(".fit-description").addClass("none"),console.log(E(n)));var r=n.width(),i=n.height();f=t[0].naturalWidth,l=t[0].naturalHeight;if(f<r||l<i)a.hide(),u.zoompan("color","ffffff");u.data("size_w",f),u.data("size_h",l);var s=r/f*100,o=i/l*100,c,h,p;return f<=l?(p=Math.round(100-s),c=r,h=Math.round(l*c/f)):f>l&&(p=Math.round(100-o),h=i,c=Math.round(h*f/l)),v(u),a.width(c),a.height(h),a.css("left","0px"),a.css("top","0px"),u.data("size_w",c),u.data("size_h",h),p}function E(e){var t=e.width(),n=Math.round(m.min_width/t*100),r=Math.round(m.height*m.min_width/m.width);return e.width(m.min_width),e.height(r),x(m.min_width),n}function S(e){var f=parseInt(u.data("size_w")),l=parseInt(u.data("size_h")),c=e.clientX-r,d=e.clientY-i;if(b){var v=!0,y=!0;t+c>=0&&(v=!1),-(t+c)>f-h&&(v=!1,s=(f-h)*-1),v&&(s=t+c),n+d>=0&&(y=!1),-(n+d)>l-p&&(y=!1,o=(l-p)*-1),y&&(o=n+d);if(v||y){var w={};m.freeze_x||(a.css("left",s+"px"),w.left=s),m.freeze_y||(a.css("top",o+"px"),w.top=o),g.navigator("move",w)}}}function x(t){t=parseInt(t);var n=t+55,r=n>700?n:725,i=t>=700?t:700;e("div.imageEditor div.header").width(t),e("div.imageEditor div.image").width(i),e("div.imageEditor div.action").width(i),e("div.imageEditor div.navigator").css("left",r)}function T(){d(),a.show(),u.css("width",h+"px").css("height",p+"px"),x(h);if(y)return;var f=w(a,u);h=u.width(),p=u.height(),g.navigator("init",{img:a[0],viewport:u[0]}),m.callback&&m.callback(f,m,g.navigator),u.mousedown(function(e){e.preventDefault(),b=!0,r=e.clientX,i=e.clientY}),e(document).bind("mousemove.zoompan",S),e(document).bind("mouseup.zoompan",function(e){S(e),b=!1,t=s,n=o})}m=e.extend({width:null,height:null,min_width:null,fit_percent:null,overzoom:!1,freeze_x:!1,freeze_y:!1,callback:function(){}},c);var h,p,y,b;return this.each(function(){b=!1;if(e(this).is("img"))a=e(this);else{if(!e(this).is("div.pan"))throw"Not an image! panFullSize can only be used with images.";a=e(this).prev("img")}u=a.find("div.pan"),y=u.is("*");var t,n;y?(t=m.width||u.width(),n=m.height||u.height()):(t=m.width||a.width(),n=m.height||a.height()),h=t,p=n,y?T():(a.wrap('<div id="pan'+a.attr("id")+'" class="pan"></div>'),u=a.parent("div.pan"),a.get(0).complete?T():a.load(T))})},rotate:function(t,n,r){var i=e('<img id="preloader" src="/he_beta/www3/inc/preloader.gif">');i.load(function(){var e=Math.round((u.width()-i.width())/2),t=Math.round((u.height()-i.height())/2);i.css("top",t+"px"),i.css("left",e+"px"),u.append(i),a.hide()}),e.ajax({url:"rotateimage.php",async:!0,dataType:"json",data:{img:n,angle:t,width:m.width,height:m.height,color:p},success:function(t){var n=t.url;a.attr("src",n),e("#preview").attr("src",t.preview),f=t.width,l=t.height,e("#image_name").val(n),a.load(function(){a.show(),e("#preloader").remove(),a.zoompan("zoom",h),r()})}})},destroy:function(){e(window).trigger("reset.zoompan"),u.unbind(),e(document).unbind(".zoompan"),a.unwrap()},zoom:function(r){var i=0;h=r,this.each(function(){var s=this,o=u.width(),f=u.height(),l=s.naturalWidth,c=s.naturalHeight,h=l/100,p=c/100,d=o/l*100,m=f/c*100,y=d+r,b=m+r,w=y*h,E=Math.round(b*p),S,x;l<c?(S=w,E=Math.round(c*S/l)):l>=c&&(x=E,w=Math.round(x*l/c));var T=a.css("left"),N=a.css("top"),C=u.data("size_w");C||(C=o);var k=u.data("size_h");k||(k=f);var L,A;r>i?(L=Math.round((w-C)/2),A=Math.round((E-k)/2)):(L=Math.round((C-w)/2),A=Math.round((k-E)/2)),T&&N&&(L-=parseInt(T),A-=parseInt(N)),t=L*-1,n=A*-1,w<=L+o&&(L=w-o),E<=A+f&&(A=E-f),L==0&&(L=1),y=Math.round(y),a.width(Math.round(w)),a.height(Math.round(E)),a.css("left","-"+L+"px"),a.css("top","-"+A+"px"),u.data("size_w",w),u.data("size_h",E),v(u),g.navigator("zoom",{width:w,height:E,top:-A,left:-L,zoom:r}),e("#zoom-level").text(y+"%"),i=r})},dimensions:function(){var e=parseInt(a.css("top")),t=parseInt(a.css("left")),n=a.width(),r=a.height();if(m.fit_percent){var i=(100-m.fit_percent)*.01;t+=t*i,e+=e*i,n+=n*i,r+=r*i}return{size:[n,r],coords:[t,e],box:[m.width,m.height],zoom:h}},navigator:function(r,i){function l(e){var t=0,n=0;if(e.offsetParent)do n+=e.offsetLeft,t+=e.offsetTop;while(e=e.offsetParent);return[n,t]}function h(){function i(r,i){if(e("div.viewport").width()==e("#preview").width()||e("div.viewport").height()==e("#preview").height())return!1;var f=a.width()/m.navigator.width(),l=a.height()/m.navigator.height(),c=Math.round(r*f),h=Math.round(i*l);return a.width()-c<u.width()&&(c=a.width()-u.width()),a.height()-h<u.height()&&(h=a.height()-u.height()),c*=-1,h*=-1,m.freeze_x||a.css("left",c+"px"),m.freeze_y||a.css("top",h+"px"),t=s=c,n=o=h,!0}var r=m.navigator.parent("div");m.viewport_node.draggable({drag:function(e,t){return i(t.position.left,t.position.top)},containment:r}),p.bind("click",function(t){var n=e(this).parent(),r=l(n[0]),s=t.pageX-this.offsetLeft-r[0],o=t.pageY-this.offsetTop-r[1],u=m.viewport_node.width(),a=m.viewport_node.height(),f=Math.round(u/2),c=Math.round(a/2),h=s-f;h+u>n.width()?h=n.width()-u:h<0&&(h=0);var p=o-c;p+a>n.height()?p=n.height()-a:p<0&&(p=0),h=h==0?h:h-4,p=p==0?p:p-4,m.viewport_node.css("left",h),m.viewport_node.css("top",p),i(h,p)})}var f=e(".navigator");switch(r){case"init":f.show();var p=e("#preview"),d=e("#theNavigator");m.navigator=p,m.viewport_node=e("div.viewport");var v=i.img,g=Math.round(v.naturalHeight*c/v.naturalWidth);p.attr("src")||p.attr("src","upload/thumbs/"+m.thumb_name),p.width(c),p.height(g),d.removeClass("none");var y=i.viewport;m.original_viewport=y,m.viewport_width=c,m.viewport_height=null,m.navigator_ratio_w=y.clientWidth/m.viewport_width,a.width()<a.height()?m.viewport_height=Math.round(y.clientHeight*m.viewport_width/y.clientWidth):(m.viewport_height=g,m.viewport_width=Math.round(m.viewport_height*y.clientWidth/y.clientHeight)),m.navigator_ratio_h=y.clientHeight/m.viewport_height,m.viewport_node.width(m.viewport_width),m.viewport_node.height(m.viewport_height),m.viewport_node.css("top",0),m.viewport_node.css("left",0),h();break;case"hide":f.hide();break;case"move":var b=m.viewport_node.width(),w=m.original_viewport.clientWidth/b,E=Math.round(i.top/w)*-1,S=Math.round(i.left/w)*-1;m.freeze_y||m.viewport_node.css("top",E-3+"px"),m.freeze_x||m.viewport_node.css("left",S+3+"px");break;case"refresh":m.viewport_node.css("top",0),m.viewport_node.css("left",0),e("#mypic").css({top:0,left:0}),console.log("refreshed");break;case"zoom":var x=a.width()/u.width(),T=a.height()/u.height(),N=Math.round(m.navigator.width()/x),C=Math.round(m.navigator.height()/T);m.viewport_node.width(N),m.viewport_node.height(C),this.navigator("move",i);break;case"destroy":}},color:function(t){p=t,e.ajax({url:"resizetoframe.php",async:!1,dataType:"json",data:{img:e("#img_original").val(),width:m.width,height:m.height,color:t},success:function(n){var r=n.url;a.attr("src",r),e("#preview").attr("src",n.preview),f=m.width,l=u.height(),e("#preview").removeAttr("style"),a.load(function(){window.setTimeout(function(){a.zoompan("zoom",h),a.zoompan("zoom",h)},650),u.css("background-color","#"+t)}),e("#image_name").val(r),a.show()}})}},e.fn.zoompan=function(t){if(g[t])return g[t].apply(this,Array.prototype.slice.call(arguments,1));if(typeof t=="object"||!t)return g.init.apply(this,arguments);e.error("Method "+t+" does not exist on jQuery.zoompan")}})(jQuery);