define(["require","text!profile/templates/layout.html","application","votes/views/vote-section","facade","controller","models","views","utils","profile/models/basics","profile/models/addmedia","profile/collections/orgs","profile/collections/relateds","profile/collections/fitnessbasics","profile/collections/videos","profile/collections/image-videos","profile/collections/commentsof","profile/collections/commentson","schedules/collections/user-games","profile/collections/fans","profile/views/header","profile/views/add-media","schedules/views/schedule-list","user/views/related-list","user/views/fitnessbasic-list","profile/views/video-list","profile/views/image-video-list","profile/views/commentof-list","profile/views/commenton-list","profile/views/fans-image-list","common/views/add-media-buttons","text!common/templates/add-media-buttons.html","text!common/templates/add-fans-buttons.html","text!common/templates/add-games-buttons.html","application"],function(e,t,n,r){var i,s=e("facade"),o=e("controller"),u=e("models"),a=e("views"),f=e("utils"),l=e("profile/models/basics"),c=e("profile/models/addmedia"),h=e("profile/collections/orgs"),p=e("profile/collections/relateds"),d=e("profile/collections/fitnessbasics"),v=e("profile/collections/image-videos"),m=e("profile/collections/commentsof"),g=e("profile/collections/commentson"),y=e("schedules/collections/user-games"),b=e("profile/collections/fans"),w=e("profile/views/header"),E=e("profile/views/add-media"),S=e("schedules/views/schedule-list"),x=e("user/views/related-list"),T=e("user/views/fitnessbasic-list"),N=e("profile/views/image-video-list"),C=e("profile/views/commentof-list"),k=e("profile/views/commenton-list"),L=e("profile/views/fans-image-list"),A=e("common/views/add-media-buttons"),O=e("text!common/templates/add-media-buttons.html"),M=e("text!common/templates/add-fans-buttons.html"),_=e("text!common/templates/add-games-buttons.html"),D=e("media/models/image"),P=a.LayoutView,H=s.$,B=s._,j=f.debug,F=f.lib.Channel,I=[base_url+"pages/profile/profile.css"];return i=o.extend({initialize:function(e){this.callbackcount=1;var t=this;return F("load:css").publish(I),B.bindAll(t),t.handleOptions(e),t.scheme=[],e.params&&this.setParamsArray(e.params),e.userId?(t.id=e.userId,t.init()):t.init(),t},init:function(){this.setupLayout().render(),this.createData(),this.handleDeferreds(),this.handleClickEvents()},handleClickEvents:function(){H(document).off("click",".green-left-heading"),H(document).on("click",".green-left-heading",function(){H(this).hasClass("down-arrow-heading")?(H(this).removeClass("down-arrow-heading"),H(this).next().slideUp(),H(this).next().attr("id")=="commenton-wrap"&&H(this).next().next().slideUp(),H(this).parent().parent().next().slideUp()):(H(this).addClass("down-arrow-heading"),H(this).next().slideDown(),H(this).next().attr("id")=="commenton-wrap"&&H(this).next().next().slideDown(),H(this).parent().parent().next().slideDown())})},createData:function(){function t(t){if(e.ajaxCalls&&e.ajaxCalls.length){for(var r in e.ajaxCalls)e.ajaxCalls[r].abort();e.ajaxCalls=[]}delete e.orgViewname,e.refreshPage(),e.sports_id=t,e.orgs=new h,e.orgs.id=e.id,e.orgs.sport_id=t,e.orgs.targetElement="#games_div",e.ajaxCalls.push(e.orgs.fetch()),e.fitnessbasics=new d,e.fitnessbasics.id=e.id,e.fitnessbasics.sport_id=t,e.ajaxCalls.push(e.fitnessbasics.fetch()),e.images=new v,e.images.id=e.id,e.images.sport_id=t,e.images.targetElement="#image-wrap",e.ajaxCalls.push(e.images.fetch()),e.handleDeferredsDynamic(),n(t)}function n(t){e.fans=new b,e.fans.id=e.id,e.fans.sport_id=t,e.fans.targetElement="#fans-div",e.fans.fetch(),H.when(e.fans.request).done(function(t){if(e.fansListView){var n;H(e.fansListView.destination).html(""),n=H.inArray(e.fansListView,e.scheme),~n&&e.scheme.splice(n,1)}e.setupFansListView()})}this.basics=new l({id:this.id}),this.basics.id=this.id,this.basics.targetElement="#main",this.basics.fetch(),this.addmedia=new c,this.addmedia.id=this.id,this.fans=new b,this.fans.id=this.id,this.fans.targetElement="#fans-div",this.fans.fetch();var e=this;e.ajaxCalls=[],F("new-fan","nomemory unique").subscribe(n),F("refresh-profilepage","unique").subscribe(t)},setupOGTags:function(){},handleDeferreds:function(){var e=this;H.when(this.basics.request).done(function(){e.setupHeaderView(),e.setupOGTags(),e.initVoteView();var t=e.basics.get("payload").enttypes_id;e.commentson=new g,e.commentson.subject_entity_type=t,e.commentson.id=e.id,e.commentson.targetElement="#commenton-wrap",e.commentson.fetch(),H.when(e.commentson.request).done(function(){e.setupCommentOnListView()})})},initVoteView:function(){var e=new r({name:"vote View",destination:"#votes-area-h",model:this.basics,userId:this.id});this.scheme.push(e),this.layout.render()},handleDeferredsDynamic:function(){var e=this;H.when(this.orgs.request).done(function(){e.setupOrgListView()}),H.when(this.fitnessbasics.request).done(function(){e.setupFitnessBasicListView()}),H.when(this.fans.request).done(function(t){e.setupFansListView()}),H.when(this.images.request).done(function(t){e.setupImageListView()})},refreshPage:function(){var e;this.orgListView&&(H(this.orgListView.destination).html(""),e=H.inArray(this.orgListView,this.scheme),~e&&this.scheme.splice(e,1)),this.relatedListView&&(H(this.relatedListView.destination).html(""),e=H.inArray(this.relatedListView,this.scheme),~e&&this.scheme.splice(e,1)),this.fitnessBasicListView&&(H(this.fitnessBasicListView.destination).html(""),e=H.inArray(this.fitnessBasicListView,this.scheme),~e&&this.scheme.splice(e,1)),this.imageListView&&(H(this.imageListView.destination).html(""),e=H.inArray(this.imageListView,this.scheme),~e&&this.scheme.splice(e,1)),this.fansListView&&(H(this.fansListView.destination).html(""),e=H.inArray(this.fansListView,this.scheme),~e&&this.scheme.splice(e,1))},setupHeaderView:function(){var e;e=new w({model:this.basics,sports_id:this.sports_id>0?this.sports_id:null,name:"Header",sports_id:this.sport_id,destination:"#main-header"}),this.scheme.push(e),this.layout.render()},setupAddMediaView:function(e){},getOrgData:function(){var e;this.orgListView&&(H(this.orgListView.destination).html(""),e=H.inArray(this.orgListView,this.scheme),~e&&this.scheme.splice(e,1));var t=this;t.orgs.fetch(),H.when(t.orgs.request).done(function(){t.setupOrgListView()})},setupOrgListView:function(){var e;H(".selected-sport-h").data("sporttype")==1?this.setUpOrgView():this.setUpUserSportView()},setUpUserSportView:function(){var e=this;this.orgViewname="sport",this.orgs=new y,this.orgs.userId=e.id,this.orgs.sports_id=H(".selected-sport-h").data("id"),this.orgs.fetch(),H.when(this.orgs.request).done(function(){e.orgListView&&(H(e.orgListView.destination).html(""),position=H.inArray(e.orgListView,e.scheme),~position&&e.scheme.splice(position,1)),e.orgListView=new S({collection:e.orgs,controller:e,destination:"#games_div",eventPage:H(".selected-sport-h").data("name"),teamName:e.basics.get("payload").first_name}),e.scheme.push(e.orgListView),e.layout.render()}),H.when(this.orgs.request).fail(function(){e.orgListView&&(H(e.orgListView.destination).html(""),position=H.inArray(e.orgListView,e.scheme),~position&&e.scheme.splice(position,1)),e.orgListView=new S({collection:e.orgs,controller:e,destination:"#games_div",eventPage:H(".selected-sport-h").data("name"),teamName:e.basics.get("payload").first_name}),e.scheme.push(e.orgListView),e.layout.render()})},setUpOrgView:function(){var e;this.orgListView&&(H(this.orgListView.destination).html(""),e=H.inArray(this.orgListView,this.scheme),~e&&this.scheme.splice(e,1)),this.orgViewname="org",this.orgListView=new S({collection:this.orgs,controller:this,destination:"#games_div"}),this.scheme.push(this.orgListView),this.layout.render()},setupRelatedListView:function(){var e;this.relatedListView=new x({collection:this.relateds,destination:"#related-wrap"}),this.scheme.push(this.relatedListView),this.layout.render()},setupFitnessBasicListView:function(){var e;this.fitnessBasicListView=new T({collection:this.fitnessbasics,destination:"#fitnessbasic-wrap"}),this.scheme.push(this.fitnessBasicListView),this.layout.render()},setupVideoListView:function(){var e;this.videoListView=new ProfileVideoListView({collection:this.videos,destination:"#video-wrap"}),this.scheme.push(this.videoListView),this.layout.render()},setupImageListView:function(){var e=this;this.addmedia.sportName=H(".selected-sport-h").data("name"),this.addmedia.firstName=this.basics.get("payload").first_name,this.addmedia.setData();var t=new A({target:".media-add-icons-h",heading:"PHOTO/VIDEO",template:O,controllerObject:e,page_base:"user",ent_id:e.id,sports_id:H(".selected-sport-h").data("id"),model:e.addmedia,message:{photo:"Add "+this.addmedia.sportName+" pics of "+this.addmedia.firstName,video:"Add "+this.addmedia.sportName+" videos of "+this.addmedia.firstName}});routing.off("image-upload-success"),routing.on("image-upload-success",function(t){e.updateImages(t)}),routing.off("setup-add-icons"),routing.on("setup-add-icons",function(t){e.setupAddMediaView(t)}),this.imageListView=new N({collection:this.images,destination:"#image-wrap",target_id:this.id,target_url:"/api/user/addimage/",sport_id:H(".selected-sport-h").data("id"),media_id:this.media_id,user_id:this.id,name:"images View 2",pageName:"profile",triggerItem:"setup-add-icons",teamName:this.basics.get("payload").first_name}),this.scheme.push(this.imageListView),this.layout.render()},reloadFans:function(){var e=this,t;this.fansListView&&(H(this.fansListView.destination).html(""),t=H.inArray(this.fansListView,this.scheme),~t&&this.scheme.splice(t,1)),e.fans.fetch(),H.when(e.fans.request).done(function(){e.setupFansListView()})},setupFansListView:function(){var e=new A({target:".fans-add-icons-h",heading:"FANS",template:M,controllerObject:this,collection:this.fans,inviteData:{invite_type:"follow",subject_id:this.basics.get("payload").id,enttypes_id:this.basics.get("payload").enttypes_id},message:{addMe:"Keep me notified of "+this.basics.get("payload").first_name+"'s activity",fb:"Invite a friend to receive notifications about  "+this.basics.get("payload").first_name+"'s activity"}});this.fansListView&&(H(this.fansListView.destination).html(""),position=H.inArray(this.fansListView,this.scheme),~position&&this.scheme.splice(position,1)),this.fansListView=new L({collection:this.fans,destination:"#fans-div",target_id:this.id,controllerObject:this,pageName:"profile",data:this.basics.toJSON(),name:"fansView",teamName:this.basics.get("payload").first_name}),this.scheme.push(this.fansListView),this.layout.render()},reloadImages:function(){var e=this,t;this.imageListView&&(H(this.imageListView.destination).html(""),t=H.inArray(this.imageListView,this.scheme),~t&&this.scheme.splice(t,1)),e.images.fetch(),H.when(e.images.request).done(function(){e.setupImageListView()})},updateImages:function(e){var t=new D;t.processItemFromPayload(e),t.selectImageType(this.imageListView.imagetype),this.imageListView.collection.add(t),this.imageListView.allData&&this.imageListView.allData.push(t.toJSON()),console.log(this.imageListView.collection),this.imageListView.collection.length==1&&this.reloadImages()},setupCommentOfListView:function(){var e;e=new C({collection:this.commentsof,destination:"#commentof-wrap"})},setupCommentOnListView:function(){var e;this.commentOnListView=new k({collection:this.commentson,destination:"#commenton-wrap"}),this.scheme.push(this.commentOnListView),this.layout.render()},setupLayout:function(){var e;return e=new P({scheme:this.scheme,destination:"#main",template:t,displayWhen:"ready"}),this.layout=e,this.layout}}),i});