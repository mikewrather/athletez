define(["vendor","views","utils","text!team/templates/complevel-item.html","text!team/templates/seasonteam-select.html","team/collections/seasons","team/collections/seasonteams","team/views/season-list"],function(e,t,n,r,s){var o,u=e.$,a=t.BaseView,f=e.Mustache,l=n.lib.Channel,c=require("team/views/season-list"),h=require("team/collections/seasons");return SeasonTeamList=require("team/collections/seasonteams"),o=a.extend({tagName:"li",className:"complevel",rendered:!1,events:{"change #select-season":"selectSeason"},initialize:function(e){function n(){if(t.rendered){t.selectSeason();return}t.rendered=!0,t.initList()}this.template=r,this.selectSeasonTemplate=s;var t=this;this.id=e.model.collection.id;var i=this.model.collection.sport_id;l("teamcomplevels:select"+i+"-"+this.model.get("payload").complevel_id).subscribe(n)},initList:function(){var e=this;this.seasons=new SeasonTeamList,this.seasons.id=this.id,this.seasons.sport_id=this.model.collection.sport_id,this.seasons.complevel_id=this.model.get("payload").complevel_id,this.seasons.fetch();var t=this.seasons.sport_id,n=this.seasons.complevel_id;u.when(this.seasons.request).done(function(){e.setupSeasonListView(t,n),l("teamseasons"+t+"-"+n+":fetch").publish(),e.select_season=e.$("#select-season"),e.selectSeason()})},setupSeasonListView:function(e,t){function s(){r.render(),n.$el.find(".seasons").html(r.el);var e={payload:[]},t=r.collection;if(t.length){for(i=0;i<t.length;i++)e.payload[i]=t.at(i).get("payload");var s=f.to_html(n.selectSeasonTemplate,e);n.$el.find(".seasons").prepend(s)}else n.$el.find(".seasons").html("")}var n=this,r=new c({collection:this.seasons});l("teamseasons"+e+"-"+t+":fetch").subscribe(s)},render:function(){var e=this.model.collection.sport_id,t=this.model.get("payload");t.sport_id=e,this.model.set("payload",t);var n=f.to_html(this.template,this.model.toJSON());return this.$el.html(n),this},selectSeason:function(){var e=this.select_season.val(),t=this.model.collection.sport_id,n=this.model.get("payload").complevel_id;this.$(".season-info").stop().slideUp(),this.$(".season-info-"+t+"-"+n+"-"+e).stop().slideDown(),l("teamseasons:select"+t+"-"+n+"-"+e).publish()}}),o});