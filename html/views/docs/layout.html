<!DOCTYPE html>  <html> <head>   <title>layout.js</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="base.html">                 base.js               </a>                                           <a class="source" href="collection.html">                 collection.js               </a>                                           <a class="source" href="layout.html">                 layout.js               </a>                                           <a class="source" href="messaging.html">                 messaging.js               </a>                                           <a class="source" href="section.html">                 section.js               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               layout.js             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <h2>Layout Manager View</h2>

<p>Presents, arranges, transitions and clears views</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>The layout manager has one or many views as well as document (DOM) 
destinations for each (rendered) view. A page may transition between 
many views, so the layout manager keeps track of view states, e.g. 
'not-rendered', 'rendered', 'not-displayed', 'displayed'. </p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>The layout manager can lazy load and render (detached) views that 
a member is very likely to request, e.g. tab changes on events page. 
The transition between view states is managed by this object. 
An entire layout may be cleared so that view objects and their bindings 
are removed, preparing these objects for garbage collection (preventing 
memory leaks). The layout manager also communicates view state 
with controller(s).</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>Requires <code>define</code>
Return {LayoutView} object as constructor</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">define</span><span class="p">([</span><span class="s1">&#39;facade&#39;</span><span class="p">,</span><span class="s1">&#39;views/base&#39;</span><span class="p">,</span><span class="s1">&#39;utils&#39;</span><span class="p">],</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">facade</span><span class="p">,</span> <span class="nx">BaseView</span><span class="p">,</span> <span class="nx">utils</span><span class="p">)</span> <span class="p">{</span>

    <span class="kd">var</span> <span class="nx">LayoutView</span><span class="p">,</span>
        <span class="nx">$</span> <span class="o">=</span> <span class="nx">facade</span><span class="p">.</span><span class="nx">$</span><span class="p">,</span>
        <span class="nx">_</span> <span class="o">=</span> <span class="nx">facade</span><span class="p">.</span><span class="nx">_</span><span class="p">,</span>
        <span class="nx">lib</span> <span class="o">=</span> <span class="nx">utils</span><span class="p">.</span><span class="nx">lib</span><span class="p">,</span>
        <span class="nx">Backbone</span> <span class="o">=</span> <span class="nx">facade</span><span class="p">.</span><span class="nx">Backbone</span><span class="p">,</span>
        <span class="nx">Channel</span> <span class="o">=</span> <span class="nx">lib</span><span class="p">.</span><span class="nx">Channel</span><span class="p">,</span>
        <span class="nx">debug</span> <span class="o">=</span> <span class="nx">utils</span><span class="p">.</span><span class="nx">debug</span><span class="p">,</span>
        <span class="nx">slice</span> <span class="o">=</span> <span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">slice</span><span class="p">;</span>

    <span class="nx">debug</span> <span class="o">=</span> <span class="nx">utils</span><span class="p">.</span><span class="nx">debug</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p><strong>Constructor</strong> <code>{LayoutView}</code> extends the BaseView.prototype
object literal argument to extend is the prototype for the LayoutView constructor</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">LayoutView</span> <span class="o">=</span> <span class="nx">BaseView</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p><strong>Property:</strong> {Array} <code>scheme</code> - a list of {SectionView} sections </p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">scheme</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span> </pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p><strong>Property:</strong> {Array} <code>schemeViewNames</code> - a list of the {string} names for each section</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">schemeViewNames</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span> </pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p><strong>Method:</strong> <code>initialize</code> <br />
First calls method to setup options and also add a controller when arg is present
no need to call ...BaseView.prototype.initialize.apply(this, slice.call(arguments));</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">initialize</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">options</span><span class="p">,</span> <span class="nx">controller</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">debug</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;LayoutView initialize&#39;</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">setOptions</span><span class="p">(</span><span class="nx">options</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">controller</span> <span class="o">&amp;&amp;</span> <span class="nx">controller</span><span class="p">.</span><span class="nx">route</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">addController</span><span class="p">(</span><span class="nx">controller</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p><strong>Method:</strong> <code>setOptions</code> <br />
Param {Object} <code>controller</code> - used to add this layout as a property of the controller <br />
When controller has a data property the state data is set with this.handleStateData
Some coupling exists between controller, layout and app states collection
the controller is added as a proptery to the layout and vise versa 
the layout property is set on the controller</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">addController</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">controller</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">controller</span><span class="p">.</span><span class="nx">layout</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">controller</span><span class="p">.</span><span class="nx">layout</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">controller</span><span class="p">.</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">handleStateData</span><span class="p">(</span><span class="nx">controller</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">controller</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">controller</span> <span class="o">=</span> <span class="nx">controller</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="nx">_</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">schemeViewNames</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">name</span> <span class="o">&amp;&amp;</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isString</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isFunction</span><span class="p">(</span><span class="nx">controller</span><span class="p">.</span><span class="nx">addStateChangeSubscriber</span><span class="p">))</span> <span class="p">{</span>
                    <span class="nx">controller</span><span class="p">.</span><span class="nx">addStateChangeSubscriber</span><span class="p">(</span><span class="nx">name</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">});</span>
        <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p><strong>Method:</strong> <code>setOptions</code> <br />
Param {Object} <code>options</code> with required properties: <br />
 {String} <code>template</code> - HTML string as dom fragment for the layout. <br />
 {Sting} <code>destination</code> - selector to place section views on the layout template</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">setOptions</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">msg</span><span class="p">;</span>
            <span class="nx">BaseView</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">setOptions</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">));</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">template</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">_</span><span class="p">.</span><span class="nx">isString</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">template</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">destination</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">msg</span> <span class="o">=</span> <span class="s2">&quot;LayoutView expected template and destination options for initialization.&quot;</span><span class="p">;</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="nx">msg</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">setSchemeOption</span><span class="p">(</span><span class="nx">options</span><span class="p">);</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">setDisplayWhenOption</span><span class="p">(</span><span class="nx">options</span><span class="p">);</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">setTransitionMethodOption</span><span class="p">(</span><span class="nx">options</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p><strong>Method:</strong> <code>setSchemeOption</code> <br />
Param {Object} <code>options</code> with {Array} 'scheme' property of views in the layout</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">setSchemeOption</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">msg</span><span class="p">,</span> <span class="nx">names</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">options</span><span class="p">.</span><span class="nx">scheme</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">_</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">scheme</span><span class="p">))</span> <span class="p">{</span>
                <span class="nx">msg</span> <span class="o">=</span> <span class="s2">&quot;LayoutView expected a scheme array for initialization.&quot;</span><span class="p">;</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="nx">msg</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">scheme</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">scheme</span><span class="p">;</span>
                <span class="nx">names</span> <span class="o">=</span> <span class="p">[];</span>
                <span class="nx">_</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">scheme</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">view</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">names</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">view</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>
                <span class="p">});</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">schemeViewNames</span> <span class="o">=</span> <span class="nx">names</span><span class="p">;</span>
                <span class="nx">debug</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;LayoutView scheme views: &#39;</span> <span class="o">+</span> <span class="nx">names</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">));</span>
            <span class="p">}</span>
            <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">destination</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">template</span><span class="p">);</span>
        <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p><strong>Method:</strong> <code>setDisplayWhenOption</code> <br />
Param {Object} <code>options</code> with propery named displayWhen
  which only has two options 'resolved' or 'ready'</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">setDisplayWhenOption</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">displayWhen</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">displayWhen</span> <span class="o">===</span> <span class="s1">&#39;ready&#39;</span> <span class="o">||</span> <span class="nx">options</span><span class="p">.</span><span class="nx">displayWhen</span> <span class="o">===</span> <span class="s1">&#39;resolved&#39;</span><span class="p">))</span> <span class="p">{</span>
                    <span class="nx">msg</span> <span class="o">=</span> <span class="s2">&quot;LayoutView option for displayWhen value must be &#39;resolved&#39; or &#39;ready&#39;&quot;</span><span class="p">;</span>
                    <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="nx">msg</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="nx">options</span><span class="p">.</span><span class="nx">displayWhen</span> <span class="o">=</span> <span class="s1">&#39;resolved&#39;</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="nx">debug</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;LayoutView setDisplayWhenOption: &#39;</span> <span class="o">+</span> <span class="nx">options</span><span class="p">.</span><span class="nx">displayWhen</span><span class="p">);</span>
        <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p><strong>Method:</strong> <code>setTransitionMethodOption</code> <br />
There is only one transition method 'showHide'
This method should be extended to provide other transitions between views e.g. fade</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">setTransitionMethodOption</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">msg</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">transitionMethod</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>only one option currently</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">transitionMethod</span> <span class="o">!==</span> <span class="s1">&#39;showHide&#39;</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">msg</span> <span class="o">=</span> <span class="s2">&quot;LayoutView option for transitionMethod is not valid, expected &#39;showHide&#39;.&quot;</span><span class="p">;</span>
                    <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="nx">msg</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="nx">options</span><span class="p">.</span><span class="nx">transitionMethod</span> <span class="o">=</span> <span class="s1">&#39;showHide&#39;</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="nx">debug</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;LayoutView transitionMethod: &#39;</span> <span class="o">+</span> <span class="nx">options</span><span class="p">.</span><span class="nx">transitionMethod</span><span class="p">);</span>
        <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p><strong>Method:</strong> <code>section</code> <br />
Utility to find a view instance by name rely's on the Section view's name property</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">section</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">section</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">scheme</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">view</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="nx">view</span><span class="p">.</span><span class="nx">name</span> <span class="o">===</span> <span class="nx">name</span><span class="p">;</span>
            <span class="p">});</span>
            <span class="k">return</span> <span class="nx">section</span><span class="p">;</span>
        <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p><strong>Method:</strong> <code>render</code> <br />
Calls the strategy for rendering the layout: deferred or ready</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">render</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">options</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">;</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">displayWhen</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">displayWhen</span> <span class="o">===</span> <span class="s1">&#39;ready&#39;</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">this</span><span class="p">.</span><span class="nx">displayWhenReady</span><span class="p">(</span><span class="nx">callback</span><span class="p">);</span>
                <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">displayWhen</span> <span class="o">===</span> <span class="s1">&#39;resolved&#39;</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">this</span><span class="p">.</span><span class="nx">displayWhenResolved</span><span class="p">(</span><span class="nx">callback</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="nx">debug</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;LayoutView render&#39;</span><span class="p">);</span>
        <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p><strong>Method:</strong> <code>displayViews</code> <br />
Iterates over the views in the layout's this.scheme array then uses the name
property to retrive the view with this.section method and display</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">displayViews</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">views</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">scheme</span><span class="p">,</span>
                <span class="nx">layout</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>

            <span class="nx">_</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">views</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">view</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">debug</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;LayoutView displayViews &#39;</span> <span class="o">+</span> <span class="nx">view</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>
                <span class="nx">layout</span><span class="p">.</span><span class="nx">section</span><span class="p">(</span><span class="nx">view</span><span class="p">.</span><span class="nx">name</span><span class="p">).</span><span class="nx">display</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
            <span class="p">});</span>
        <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p><strong>Method:</strong> <code>displayWhenResolved</code> <br />
Param {Function} <code>callback</code> is called when deferreds are all passed. <br />
The strategy to display when all sections' deferreds are resolved successfully</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">displayWhenResolved</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">layout</span> <span class="o">=</span> <span class="k">this</span><span class="p">,</span>
                <span class="nx">deferreds</span> <span class="o">=</span> <span class="p">[];</span>

            <span class="nx">_</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">scheme</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">view</span><span class="p">)</span> <span class="p">{</span>
                <span class="kd">var</span> <span class="nx">msg</span><span class="p">;</span>
                <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">view</span><span class="p">.</span><span class="nx">deferred</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">msg</span> <span class="o">=</span> <span class="s2">&quot;LayoutView displayWhenResolved expected &quot;</span><span class="p">;</span>
                    <span class="nx">msg</span> <span class="o">+=</span> <span class="nx">view</span><span class="p">.</span><span class="nx">name</span><span class="p">;</span>
                    <span class="nx">msg</span> <span class="o">+=</span> <span class="s2">&quot; view to have a deferred property&quot;</span><span class="p">;</span>
                    <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="nx">msg</span><span class="p">);</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="nx">deferreds</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">view</span><span class="p">.</span><span class="nx">deferred</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">});</span>
            <span class="nx">$</span><span class="p">.</span><span class="nx">when</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">$</span><span class="p">,</span> <span class="nx">deferreds</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span>
                <span class="kd">function</span> <span class="nx">passed</span><span class="p">()</span> <span class="p">{</span>
                    <span class="nx">layout</span><span class="p">.</span><span class="nx">displayViews</span><span class="p">();</span>
                    <span class="nx">debug</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;LayoutView scheme views all rendered.&quot;</span><span class="p">);</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">callback</span> <span class="o">&amp;&amp;</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isFunction</span><span class="p">(</span><span class="nx">callback</span><span class="p">))</span> <span class="p">{</span>
                        <span class="nx">callback</span><span class="p">();</span>
                    <span class="p">}</span>
                    <span class="nx">Channel</span><span class="p">(</span><span class="s1">&#39;layout:ready&#39;</span><span class="p">).</span><span class="nx">publish</span><span class="p">();</span>
                <span class="p">},</span>
                <span class="kd">function</span> <span class="nx">failed</span><span class="p">()</span> <span class="p">{</span>
                    <span class="kd">var</span> <span class="nx">msg</span><span class="p">;</span>
                    <span class="nx">msg</span> <span class="o">=</span> <span class="s2">&quot;LayoutView render could not complete all of the scheme&#39;s views.&quot;</span><span class="p">;</span>
                    <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="nx">msg</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">);</span>
        <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p><strong>Method:</strong> <code>displayWhenReady</code> <br />
Param {Function} <code>callback</code> is called following the setting of done callbacks <br />
The strategy to rely on each Section's own deferred resolution and then display</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">displayWhenReady</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">views</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">scheme</span><span class="p">,</span>
                <span class="nx">layout</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>

            <span class="nx">_</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">views</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">view</span><span class="p">)</span> <span class="p">{</span>
                <span class="kd">var</span> <span class="nx">childView</span> <span class="o">=</span> <span class="nx">layout</span><span class="p">.</span><span class="nx">section</span><span class="p">(</span><span class="nx">view</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">childView</span><span class="p">.</span><span class="nx">isRendered</span><span class="p">())</span> <span class="p">{</span>
                    <span class="nx">childView</span><span class="p">.</span><span class="nx">display</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
                <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">childView</span><span class="p">.</span><span class="nx">isNotRendered</span><span class="p">())</span> <span class="p">{</span>
                    <span class="nx">childView</span><span class="p">.</span><span class="nx">render</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">childView</span><span class="p">);</span>
                    <span class="nx">childView</span><span class="p">.</span><span class="nx">deferred</span><span class="p">.</span><span class="nx">done</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
                        <span class="nx">childView</span><span class="p">.</span><span class="nx">display</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
                    <span class="p">});</span>
                <span class="p">}</span>
                <span class="nx">debug</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;LayoutView displayWhenReady: &quot;</span> <span class="o">+</span> <span class="nx">view</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>
            <span class="p">});</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">callback</span> <span class="o">&amp;&amp;</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isFunction</span><span class="p">(</span><span class="nx">callback</span><span class="p">))</span> <span class="p">{</span>
                <span class="nx">callback</span><span class="p">();</span>
            <span class="p">}</span>
        <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p><strong>Method:</strong> <code>transition</code> <br />
Param {String} <code>sectionName</code> is the targeted area for the change to happen <br />
Param {SectionView} <code>sectionView</code> replaces the current view in this section <br />
Each section is named and acts as a zone in the layout, this method
is called to change between two views in a single section (zone).</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">transition</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">sectionName</span><span class="p">,</span> <span class="nx">sectionView</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">msg</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">_</span><span class="p">.</span><span class="nx">contains</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">schemeViewNames</span><span class="p">,</span> <span class="nx">sectionName</span><span class="p">))</span> <span class="p">{</span>
                <span class="nx">debug</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;LayoutView transition has no view named: &#39;</span> <span class="o">+</span> <span class="nx">sectionName</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">sectionView</span> <span class="o">||</span> <span class="p">(</span><span class="nx">sectionView</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="o">!</span><span class="nx">sectionView</span><span class="p">.</span><span class="nx">state</span> <span class="o">||</span> <span class="o">!</span><span class="nx">sectionView</span><span class="p">.</span><span class="nx">display</span><span class="p">)))</span> <span class="p">{</span>
                    <span class="nx">msg</span> <span class="o">=</span> <span class="s2">&quot;LayoutView transition for &quot;</span> <span class="o">+</span> <span class="nx">sectionName</span><span class="p">;</span>
                    <span class="nx">msg</span> <span class="o">+=</span> <span class="s2">&quot; requires a SectionView with methods for state and display&quot;</span><span class="p">;</span>
                    <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="nx">msg</span><span class="p">);</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="k">this</span><span class="p">.</span><span class="nx">section</span><span class="p">(</span><span class="nx">sectionName</span><span class="p">).</span><span class="nx">display</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">sectionView</span><span class="p">.</span><span class="nx">isNotRendered</span><span class="p">())</span> <span class="p">{</span>
                        <span class="nx">sectionView</span><span class="p">.</span><span class="nx">render</span><span class="p">();</span>
                        <span class="nx">sectionView</span><span class="p">.</span><span class="nx">deferred</span><span class="p">.</span><span class="nx">done</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
                            <span class="nx">sectionView</span><span class="p">.</span><span class="nx">display</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
                        <span class="p">});</span>
                    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                        <span class="nx">sectionView</span><span class="p">.</span><span class="nx">display</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <p><strong>Method:</strong> <code>clearLayoutScheme</code> <br />
this is called by this.remove to destroy each method in the layout scheme.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">clearLayoutScheme</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">i</span><span class="p">;</span>

            <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">scheme</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">scheme</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">destroy</span><span class="p">();</span>
                <span class="k">delete</span> <span class="k">this</span><span class="p">.</span><span class="nx">scheme</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
            <span class="p">}</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">scheme</span> <span class="o">=</span> <span class="p">[];</span>
        <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <p><strong>Method:</strong> <code>remove</code> <br />
Utility to prevew memory leaks calling the clearLayoutScheme and prototype remove methods</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">remove</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">clearLayoutScheme</span><span class="p">();</span>
            <span class="nx">BaseView</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">remove</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
        <span class="p">},</span>

        </pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <p><strong>Method:</strong> <code>state</code> (of all sections' views) <br />
e.g. {"Top": "not-displayed", "Bottom": "displayed"} <br />
When no arg is given the method is a getter, 
with expected state arg the method sets state for views</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <p>Param {Object} <code>state</code> properties are section names with values as the <br />
Param {Function} <code>changeHandlerCallback</code> passed to state to <br />
  - handle state change in section views
  - should accept two args (lastState, state)</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">state</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">state</span><span class="p">,</span> <span class="nx">changeHandlerCallback</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">layout</span> <span class="o">=</span> <span class="k">this</span><span class="p">,</span> <span class="nx">section</span><span class="p">,</span> <span class="nx">layoutRoute</span><span class="p">;</span>

            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">layout</span><span class="p">.</span><span class="nx">meta</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">layout</span><span class="p">.</span><span class="nx">meta</span> <span class="o">=</span> <span class="p">{};</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">state</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">layout</span><span class="p">.</span><span class="nx">controller</span> <span class="o">&amp;&amp;</span> <span class="nx">layout</span><span class="p">.</span><span class="nx">controller</span><span class="p">.</span><span class="nx">route</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">layoutRoute</span> <span class="o">=</span> <span class="nx">layout</span><span class="p">.</span><span class="nx">controller</span><span class="p">.</span><span class="nx">route</span><span class="p">;</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="nx">layoutRoute</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">pathname</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="nx">state</span> <span class="o">=</span> <span class="p">{</span> <span class="s2">&quot;route&quot;</span><span class="o">:</span> <span class="nx">layoutRoute</span> <span class="p">};</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">layout</span><span class="p">.</span><span class="nx">controller</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">state</span><span class="p">.</span><span class="nx">meta</span> <span class="o">=</span> <span class="nx">layout</span><span class="p">.</span><span class="nx">controller</span><span class="p">.</span><span class="nx">meta</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="nx">_</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">layout</span><span class="p">.</span><span class="nx">scheme</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">section</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">state</span><span class="p">[</span><span class="nx">section</span><span class="p">.</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="nx">state</span><span class="o">:</span> <span class="nx">section</span><span class="p">.</span><span class="nx">state</span><span class="p">(),</span>
                        <span class="nx">meta</span><span class="o">:</span> <span class="nx">section</span><span class="p">.</span><span class="nx">meta</span><span class="p">()</span>
                    <span class="p">};</span>
                <span class="p">});</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">isObject</span><span class="p">(</span><span class="nx">state</span><span class="p">))</span> <span class="p">{</span>
                <span class="nx">_</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">state</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="cm">/*value*/</span> <span class="nx">val</span><span class="p">,</span> <span class="cm">/*key*/</span> <span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">contains</span><span class="p">(</span><span class="nx">layout</span><span class="p">.</span><span class="nx">schemeViewNames</span><span class="p">,</span> <span class="nx">name</span><span class="p">))</span> <span class="p">{</span>
                        <span class="nx">section</span> <span class="o">=</span> <span class="nx">layout</span><span class="p">.</span><span class="nx">section</span><span class="p">(</span><span class="nx">name</span><span class="p">);</span>
                        <span class="k">try</span> <span class="p">{</span>
                            <span class="nx">section</span><span class="p">.</span><span class="nx">state</span><span class="p">(</span><span class="nx">val</span><span class="p">.</span><span class="nx">state</span><span class="p">,</span> <span class="nx">changeHandlerCallback</span><span class="p">,</span> <span class="nx">section</span><span class="p">);</span>
                        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
                            <span class="nx">debug</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">e</span><span class="p">);</span>
                        <span class="p">}</span>
                    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                        <span class="nx">layout</span><span class="p">.</span><span class="nx">meta</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="nx">val</span><span class="p">;</span>
                    <span class="p">}</span>
                <span class="p">});</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="nx">state</span><span class="p">;</span>
        <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <p><strong>Method:</strong> <code>displayChangeHandler</code> <br />
Use as a callback when calling state, toggles between a sections state between
'not-displayed' and 'displayed' (and vice-versa) also rendering when needed.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">displayChangeHandler</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">lastState</span><span class="p">,</span> <span class="nx">state</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">bool</span><span class="p">,</span> <span class="nx">msg</span><span class="p">;</span>

            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">lastState</span> <span class="o">||</span> <span class="o">!</span><span class="nx">state</span> <span class="o">||</span> <span class="nx">lastState</span> <span class="o">===</span> <span class="nx">state</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">&quot;SectionView stateChangeHandler expected lastState and state arguemnts to be different&quot;</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">lastState</span> <span class="o">===</span> <span class="s1">&#39;not-displayed&#39;</span> <span class="o">||</span> <span class="nx">lastState</span> <span class="o">===</span> <span class="s1">&#39;displayed&#39;</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">state</span> <span class="o">===</span> <span class="s1">&#39;not-displayed&#39;</span> <span class="o">||</span> <span class="nx">state</span> <span class="o">===</span> <span class="s1">&#39;displayed&#39;</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">bool</span> <span class="o">=</span> <span class="o">!</span><span class="p">(</span><span class="nx">state</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39;not-&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">===</span> <span class="mi">0</span><span class="p">);</span> <span class="c1">// don&#39;t display if state begins with &#39;not-&#39;</span>
                    <span class="k">this</span><span class="p">.</span><span class="nx">display</span><span class="p">(</span><span class="nx">bool</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">lastState</span> <span class="o">===</span> <span class="s1">&#39;not-rendered&#39;</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">render</span><span class="p">();</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">state</span> <span class="o">===</span> <span class="s1">&#39;displayed&#39;</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">this</span><span class="p">.</span><span class="nx">display</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
                <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">state</span> <span class="o">===</span> <span class="s1">&#39;not-displayed&#39;</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">this</span><span class="p">.</span><span class="nx">display</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>               <p><strong>Method:</strong> <code>handleStateData</code> <br />
There is some coupling with the layout and controller which can be passed 
as the 2nd arg to the layout's initialize method. When a controller.data 
property is present this method sets the appropriate state using the
this.displayChangeHandler method to change state for each section</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">handleStateData</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">state</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">layout</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
            <span class="nx">_</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">state</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">viewName</span><span class="p">,</span> <span class="nx">state</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">_</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">layout</span><span class="p">.</span><span class="nx">schemeViewNames</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">idx</span><span class="p">,</span> <span class="nx">views</span><span class="p">)</span> <span class="p">{</span>
                    <span class="kd">var</span> <span class="nx">viewState</span> <span class="o">=</span> <span class="p">{};</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">name</span> <span class="o">===</span> <span class="nx">viewName</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">viewState</span><span class="p">[</span><span class="nx">viewName</span><span class="p">]</span> <span class="o">=</span> <span class="nx">data</span><span class="p">;</span>
                        <span class="nx">layout</span><span class="p">.</span><span class="nx">state</span><span class="p">(</span><span class="nx">viewState</span><span class="p">,</span> <span class="nx">layout</span><span class="p">.</span><span class="nx">displayChangeHandler</span><span class="p">);</span>
                    <span class="p">}</span>
                <span class="p">});</span>
            <span class="p">});</span>
        <span class="p">}</span>

    <span class="p">});</span>

    <span class="k">return</span> <span class="nx">LayoutView</span><span class="p">;</span>
<span class="p">});</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 